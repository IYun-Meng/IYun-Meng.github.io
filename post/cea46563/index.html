<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Grandstander:300,300italic,400,400italic,700,700italic|Noto+Serif+SC:300,300italic,400,400italic,700,700italic|Architects+Daughter:300,300italic,400,400italic,700,700italic|Dosis:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.mengyun.club","root":"/","scheme":"Mist","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="使用ssh服务管理远程主机配置网卡服务配置网卡参数使用nmtui命令来配置网络, 执行nmtui命令运行网络配置工具. 选中Edit a connection并按下回车键">
<meta property="og:type" content="article">
<meta property="og:title" content="使用各种服务和部署">
<meta property="og:url" content="http://www.mengyun.club/post/cea46563/index.html">
<meta property="og:site_name" content="爱梦的博客">
<meta property="og:description" content="使用ssh服务管理远程主机配置网卡服务配置网卡参数使用nmtui命令来配置网络, 执行nmtui命令运行网络配置工具. 选中Edit a connection并按下回车键">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC1%E6%AD%A5-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E2%80%9Cnmtui%E2%80%9D.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC2%E6%AD%A5-%E9%80%89%E6%8B%A9%E8%A6%81%E7%BC%96%E8%BE%91%E7%9A%84%E7%BD%91%E5%8D%A1.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC3%E6%AD%A5-%E7%BC%96%E8%BE%91%E7%BD%91%E5%8D%A1%E4%BF%A1%E6%81%AF.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC4%E6%AD%A5-%E5%B0%86%E7%BD%91%E5%8D%A1%E7%9A%84IPv4%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%AE%BE%E7%BD%AE%E6%88%90%E6%89%8B%E5%8A%A8.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC5%E6%AD%A5-%E6%95%B2%E5%87%BBIpv4%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%8F%B3%E4%BE%A7%E7%9A%84Show.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC6%E6%AD%A5-%E5%A1%AB%E5%85%A5IP%E5%9C%B0%E5%9D%80%E4%BF%A1%E6%81%AF.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC7%E6%AD%A5-%E6%95%B2%E5%87%BB%E6%9C%80%E4%B8%8B%E9%9D%A2%E7%9A%84OK.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC8%E6%AD%A5-%E7%A1%AE%E8%AE%A4%E4%BF%A1%E6%81%AF%E5%A1%AB%E5%86%99%E6%AD%A3%E7%A1%AE%E5%90%8E%E9%80%80%E5%87%BA.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E8%AE%BE%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E5%8D%A1%E7%9A%84%E6%A8%A1%E5%BC%8F.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%BC%96%E8%BE%91%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AE%BE%E7%BD%AE,%E6%B7%BB%E5%8A%A0%E7%BD%91%E7%BB%9C%E9%80%82%E9%85%8D%E5%99%A8.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E4%BF%9D%E8%AF%81%E4%B8%A4%E5%9D%97%E7%BD%91%E5%8D%A1%E7%9A%84%E8%BF%9E%E6%8E%A5%E7%B1%BB%E5%9E%8B%E9%83%BD%E6%98%AF%E7%9B%B8%E5%90%8C%E7%9A%84.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E9%87%8D%E5%90%AF%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%90%8E%E6%8F%90%E7%A4%BA.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%A1%AE%E8%AE%A4%E5%85%89%E7%9B%98%E5%B7%B2%E8%A2%AB%E9%80%89%E4%B8%AD.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/screen%E4%BC%9A%E8%AF%9D%E5%85%B1%E4%BA%AB.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/FTP%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/PAM%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E7%9A%84%E4%BD%93%E7%B3%BB%E5%9B%BE.jpg">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/DNS%E7%BB%93%E6%9E%84%E6%A8%A1%E5%9E%8B.jpg">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/DNS%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E7%BD%91%E5%8D%A1%E4%BF%A1%E6%81%AF.jpg">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/DNS%E5%88%86%E7%A6%BB%E8%A7%A3%E6%9E%90%E6%8B%93%E6%89%91%E5%9B%BE.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/DHCP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/dhcp%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E4%B8%8D%E4%BD%BF%E7%94%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84DHCP%E5%8A%9F%E8%83%BD.jpg">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%BD%91%E5%8D%A1MAC%E5%9C%B0%E5%9D%80.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E9%82%AE%E4%BB%B6%E6%8A%95%E9%80%92%E5%B7%A5%E7%A8%8B.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E9%82%AE%E5%B1%80%E7%B3%BB%E7%BB%9F%E6%B5%81%E7%A8%8B%E5%9B%BE.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E6%9C%BAIP%E5%9C%B0%E5%9D%80-1.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC1%E6%AD%A5%EF%BC%9A%E5%BC%80%E5%90%AFOutLook%E7%A8%8B%E5%BA%8F.jpg">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC2%E6%AD%A5%EF%BC%9A%E9%80%89%E6%8B%A9%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E5%B8%90%E6%88%B7.jpg">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC3%E6%AD%A5%EF%BC%9A%E9%80%89%E6%8B%A9%E9%BB%98%E8%AE%A4%E7%9A%84%E9%82%AE%E5%B1%80%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B1%BB%E5%9E%8B.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC4%E6%AD%A5%EF%BC%9A%E5%A1%AB%E5%86%99%E5%88%9B%E5%BB%BA%E7%9A%84%E9%82%AE%E7%AE%B1%E5%B8%90%E5%8F%B7%E5%92%8C%E5%AF%86%E7%A0%81.jpg">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC5%E6%AD%A5%EF%BC%9A%E7%AD%89%E5%BE%85%E8%BF%9E%E6%8E%A5%E9%82%AE%E5%B1%80%E6%9C%8D%E5%8A%A1%E5%99%A8.jpg">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC6%E6%AD%A5%EF%BC%9A%E9%80%89%E6%8B%A9%E9%9D%9E%E5%8A%A0%E5%AF%86%E7%9A%84%E9%93%BE%E6%8E%A5%E6%96%B9%E5%BC%8F.jpg">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC7%E6%AD%A5%EF%BC%9A%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%8A%E9%82%AE%E4%BB%B6%EF%BC%8C%E9%80%89%E6%8B%A9%E2%80%9C%E6%96%B0%E9%82%AE%E4%BB%B6%E2%80%9D%E3%80%82.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC8%E6%AD%A5%EF%BC%9A%E5%A1%AB%E5%86%99%E6%94%B6%E4%BB%B6%E4%BA%BA%E4%B8%8E%E9%82%AE%E4%BB%B6%E5%86%85%E5%AE%B9%E5%90%8E%E5%8F%91%E9%80%81%E3%80%82.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E5%90%91%E7%94%A8%E6%88%B7bin%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E5%90%91%E7%94%A8%E6%88%B7xxoo%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B-1.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC1%E6%AD%A5%EF%BC%9A%E5%BC%80%E6%9C%BA%E5%90%8E%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%8A%E6%95%B2%E5%87%BB%E2%80%9Ce%E2%80%9D.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%B8%80.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%BA%8C.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%BA%8C.%E4%BA%94.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%BA%8C.%E5%85%AD.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%B8%89.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E5%9B%9B.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%BA%94.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E5%85%AD.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%89%E8%A3%85%E5%8A%A0%E8%BD%BD%E4%B8%AD.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%89%E8%A3%85%E5%8A%A0%E8%BD%BD%E4%B8%AD2.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Discuz%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC1.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Discuz%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC2.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Discuz%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC3.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Discuz%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC4.png">
<meta property="og:image" content="http://www.mengyun.club/post/cea46563/Discuz%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC5.png">
<meta property="article:published_time" content="2020-06-27T03:44:05.000Z">
<meta property="article:modified_time" content="2020-10-23T11:29:55.545Z">
<meta property="article:author" content="云">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Apache">
<meta property="article:tag" content="NFS">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="Nginx">
<meta property="article:tag" content="SSH">
<meta property="article:tag" content="SELinux">
<meta property="article:tag" content="FTP">
<meta property="article:tag" content="TFTP">
<meta property="article:tag" content="Samba">
<meta property="article:tag" content="AutoFs">
<meta property="article:tag" content="Bind">
<meta property="article:tag" content="DHCP">
<meta property="article:tag" content="Postfix">
<meta property="article:tag" content="Dovecot">
<meta property="article:tag" content="SYSLinux">
<meta property="article:tag" content="KickStart">
<meta property="article:tag" content="PXE">
<meta property="article:tag" content="PHP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.mengyun.club/post/cea46563/%E7%AC%AC1%E6%AD%A5-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E2%80%9Cnmtui%E2%80%9D.png">


<link rel="canonical" href="http://www.mengyun.club/post/cea46563/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>使用各种服务和部署 | 爱梦的博客</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="爱梦的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="/js/src/clickLove.js"></script>

<script type="text/javascript"
color="0,187,255" opacity='0.7' zIndex="-2" count="180" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>
  
  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">爱梦的博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">常常与我陪伴的就是梦</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">38</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">4</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">27</span></a>

  </li>
        <li class="menu-item menu-item-playlist">

    <a href="/playlist/" rel="section"><i class="fa fa-music fa-fw"></i>网易云歌单</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">	
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#使用ssh服务管理远程主机"><span class="nav-text">使用ssh服务管理远程主机</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置网卡服务"><span class="nav-text">配置网卡服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置网卡参数"><span class="nav-text">配置网卡参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建网络会话"><span class="nav-text">创建网络会话</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#绑定两块网卡"><span class="nav-text">绑定两块网卡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#远程控制服务"><span class="nav-text">远程控制服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置sshd服务"><span class="nav-text">配置sshd服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安全密钥验证"><span class="nav-text">安全密钥验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#远程传输命令"><span class="nav-text">远程传输命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不间断会话服务"><span class="nav-text">不间断会话服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#管理远程会话"><span class="nav-text">管理远程会话</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#会话共享功能"><span class="nav-text">会话共享功能</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Apache服务部署静态网站"><span class="nav-text">使用Apache服务部署静态网站</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#网站服务程序"><span class="nav-text">网站服务程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置服务文件参数"><span class="nav-text">配置服务文件参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SELinux安全子系统"><span class="nav-text">SELinux安全子系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#个人用户主页功能"><span class="nav-text">个人用户主页功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#虚拟网站主机功能"><span class="nav-text">虚拟网站主机功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基于IP地址"><span class="nav-text">基于IP地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于主机域名"><span class="nav-text">基于主机域名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于端口号"><span class="nav-text">基于端口号</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Apache的访问控制"><span class="nav-text">Apache的访问控制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Vsftpd服务传输文件"><span class="nav-text">使用Vsftpd服务传输文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#文件传输协议"><span class="nav-text">文件传输协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Vsftpd服务程序"><span class="nav-text">Vsftpd服务程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#匿名访问模式"><span class="nav-text">匿名访问模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#本地用户模式"><span class="nav-text">本地用户模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟用户模式"><span class="nav-text">虚拟用户模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TFTP简单文件传输协议"><span class="nav-text">TFTP简单文件传输协议</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Samba或NFS实现文件共享"><span class="nav-text">使用Samba或NFS实现文件共享</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SAMBA文件共享服务"><span class="nav-text">SAMBA文件共享服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置共享资源"><span class="nav-text">配置共享资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows挂载共享"><span class="nav-text">Windows挂载共享</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux挂载共享"><span class="nav-text">Linux挂载共享</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NFS网络文件系统"><span class="nav-text">NFS网络文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AutoFs自动挂载服务"><span class="nav-text">AutoFs自动挂载服务</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Bind提供域名解析服务"><span class="nav-text">使用Bind提供域名解析服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DNS域名解析服务"><span class="nav-text">DNS域名解析服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装Bind服务程序"><span class="nav-text">安装Bind服务程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#正向解析实验"><span class="nav-text">正向解析实验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#反向解析实验"><span class="nav-text">反向解析实验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#部署从服务器"><span class="nav-text">部署从服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安全的加密传输"><span class="nav-text">安全的加密传输</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#部署缓存服务器"><span class="nav-text">部署缓存服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分离解析技术"><span class="nav-text">分离解析技术</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用DHCP动态管理主机地址"><span class="nav-text">使用DHCP动态管理主机地址</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#动态主机地址管理协议"><span class="nav-text">动态主机地址管理协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#部署dhcpd服务程序"><span class="nav-text">部署dhcpd服务程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自动管理IP地址"><span class="nav-text">自动管理IP地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分配固定IP地址"><span class="nav-text">分配固定IP地址</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用Postfix与Dovecot部署邮件系统"><span class="nav-text">使用Postfix与Dovecot部署邮件系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#电子邮件系统"><span class="nav-text">电子邮件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#部署基础的电子邮件系统"><span class="nav-text">部署基础的电子邮件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置Postfix服务程序"><span class="nav-text">配置Postfix服务程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置Dovecot服务程序"><span class="nav-text">配置Dovecot服务程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#客户使用电子邮件系统"><span class="nav-text">客户使用电子邮件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置用户别名邮箱"><span class="nav-text">设置用户别名邮箱</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用PXE-Kickstart无人值守安装服务"><span class="nav-text">使用PXE+Kickstart无人值守安装服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#无人值守系统"><span class="nav-text">无人值守系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#部署相关服务程序"><span class="nav-text">部署相关服务程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置DHCP服务程序"><span class="nav-text">配置DHCP服务程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置TFTP服务程序"><span class="nav-text">配置TFTP服务程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置SYSLinux服务程序"><span class="nav-text">配置SYSLinux服务程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置VSFtpd服务程序"><span class="nav-text">配置VSFtpd服务程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建KickStart应答文件"><span class="nav-text">创建KickStart应答文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自动部署客户机"><span class="nav-text">自动部署客户机</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用LNMP架构部署动态网站环境"><span class="nav-text">使用LNMP架构部署动态网站环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#源码包程序"><span class="nav-text">源码包程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LNMP动态网站架构"><span class="nav-text">LNMP动态网站架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置Mysql服务"><span class="nav-text">配置Mysql服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置Nginx服务"><span class="nav-text">配置Nginx服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置php服务"><span class="nav-text">配置php服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#搭建Discuz论坛"><span class="nav-text">搭建Discuz论坛</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="云"
      src="/images/head_Picture/Yu_Me5.jpg">
  <p class="site-author-name" itemprop="name">云</p>
  <div class="site-description" itemprop="description">我一直一直往前走, 从未回过头. 也不记得有多少人从我身边经过, 也不记得我走了多久. 就这样一直走... 一直走...</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/IYun-Meng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;IYun-Meng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:kili3kili1miyukeno4@foxmail.co" title="E-Mail → mailto:kili3kili1miyukeno4@foxmail.co" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.baidu.com/" title="https:&#x2F;&#x2F;www.baidu.com&#x2F;" rel="noopener" target="_blank">百度</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.google.com/?hl=zh_CN" title="https:&#x2F;&#x2F;www.google.com&#x2F;?hl&#x3D;zh_CN" rel="noopener" target="_blank">谷歌</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.zhihu.com/" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;" rel="noopener" target="_blank">知乎</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.github.com/" title="https:&#x2F;&#x2F;www.github.com&#x2F;" rel="noopener" target="_blank">GitHub</a>
        </li>
    </ul>
  </div>

<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
<div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div id="myCanvasContainer" class="widget tagcloud">
        <canvas width="250" height="250" id="resCanvas" style="width=100%">
            <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/" rel="tag">Apache</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Atlas/" rel="tag">Atlas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AutoFs/" rel="tag">AutoFs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bind/" rel="tag">Bind</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CentOS/" rel="tag">CentOS</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DHCP/" rel="tag">DHCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Deepin/" rel="tag">Deepin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dovecot/" rel="tag">Dovecot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FTP/" rel="tag">FTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KVM/" rel="tag">KVM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Keepalived/" rel="tag">Keepalived</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KickStart/" rel="tag">KickStart</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/" rel="tag">MongoDB</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NFS/" rel="tag">NFS</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NTP/" rel="tag">NTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nagios/" rel="tag">Nagios</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PXE/" rel="tag">PXE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Physics2D/" rel="tag">Physics2D</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postfix/" rel="tag">Postfix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pycharm/" rel="tag">Pycharm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SELinux/" rel="tag">SELinux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/" rel="tag">SSH</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SYSLinux/" rel="tag">SYSLinux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Samba/" rel="tag">Samba</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sprite/" rel="tag">Sprite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TFTP/" rel="tag">TFTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/" rel="tag">Tomcat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/" rel="tag">Unity</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zabbix/" rel="tag">Zabbix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/root/" rel="tag">root</a><span class="tag-list-count">1</span></li></ul>
        </canvas>
    </div>
</div>

      </section>
	  
	</div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.mengyun.club/post/cea46563/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head_Picture/Yu_Me5.jpg">
      <meta itemprop="name" content="云">
      <meta itemprop="description" content="我一直一直往前走, 从未回过头. 也不记得有多少人从我身边经过, 也不记得我走了多久. 就这样一直走... 一直走...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="爱梦的博客">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          使用各种服务和部署
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-27 11:44:05" itemprop="dateCreated datePublished" datetime="2020-06-27T11:44:05+08:00">2020-06-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-23 19:29:55" itemprop="dateModified" datetime="2020-10-23T19:29:55+08:00">2020-10-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>65k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>59 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <hr>
<h1 id="使用ssh服务管理远程主机"><a href="#使用ssh服务管理远程主机" class="headerlink" title="使用ssh服务管理远程主机"></a>使用ssh服务管理远程主机</h1><h2 id="配置网卡服务"><a href="#配置网卡服务" class="headerlink" title="配置网卡服务"></a>配置网卡服务</h2><h3 id="配置网卡参数"><a href="#配置网卡参数" class="headerlink" title="配置网卡参数"></a>配置网卡参数</h3><p>使用nmtui命令来配置网络, 执行nmtui命令运行网络配置工具.<br><img src="/post/cea46563/%E7%AC%AC1%E6%AD%A5-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E2%80%9Cnmtui%E2%80%9D.png" alt="第1步:执行命令“nmtui&quot;"></p>
<p>选中Edit a connection并按下回车键<br><img src="/post/cea46563/%E7%AC%AC2%E6%AD%A5-%E9%80%89%E6%8B%A9%E8%A6%81%E7%BC%96%E8%BE%91%E7%9A%84%E7%BD%91%E5%8D%A1.png" alt="第2步:选择要编辑的网卡"></p>
<a id="more"></a>

<p>选中要编辑的网卡名称, 然后按下Edit(编辑)按钮.<br><img src="/post/cea46563/%E7%AC%AC3%E6%AD%A5-%E7%BC%96%E8%BE%91%E7%BD%91%E5%8D%A1%E4%BF%A1%E6%81%AF.png" alt="第3步:编辑网卡信息"></p>
<p>把网络IPv4的配置方式改成Manual(手动)<br><img src="/post/cea46563/%E7%AC%AC4%E6%AD%A5-%E5%B0%86%E7%BD%91%E5%8D%A1%E7%9A%84IPv4%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%AE%BE%E7%BD%AE%E6%88%90%E6%89%8B%E5%8A%A8.png" alt="第4步:将网卡的IPv4配置项设置成手动"></p>
<p>按下Show(显示)按钮, 显示信息配置框.<br><img src="/post/cea46563/%E7%AC%AC5%E6%AD%A5-%E6%95%B2%E5%87%BBIpv4%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%8F%B3%E4%BE%A7%E7%9A%84Show.png" alt="第5步:敲击Ipv4配置项右侧的Show"></p>
<p>在服务器主机的网络配置信息中填写IP地址192.168.10.10/24<br><img src="/post/cea46563/%E7%AC%AC6%E6%AD%A5-%E5%A1%AB%E5%85%A5IP%E5%9C%B0%E5%9D%80%E4%BF%A1%E6%81%AF.png" alt="第6步:填入IP地址信息"></p>
<p>单击OK按钮保存配置<br><img src="/post/cea46563/%E7%AC%AC7%E6%AD%A5-%E6%95%B2%E5%87%BB%E6%9C%80%E4%B8%8B%E9%9D%A2%E7%9A%84OK.png" alt="第7步:敲击最下面的OK"></p>
<p>单击Quit按钮退出<br><img src="/post/cea46563/%E7%AC%AC8%E6%AD%A5-%E7%A1%AE%E8%AE%A4%E4%BF%A1%E6%81%AF%E5%A1%AB%E5%86%99%E6%AD%A3%E7%A1%AE%E5%90%8E%E9%80%80%E5%87%BA.png" alt="第8步:确认信息填写正确后退出"></p>
<p>用Vim编辑器将网卡配置文件中的ONBOOT参数修改成yes, 没有激活的网卡会在系统重启后就被激活.<br><code>vim /etc/sysconfig/network-scripts/ifcfg-eno16777736</code><br><code>systemctl restart network</code></p>
<h3 id="创建网络会话"><a href="#创建网络会话" class="headerlink" title="创建网络会话"></a>创建网络会话</h3><p>RHEL和CentOS系统默认使用NetworkManager来提供网络服务, 这是一种动态管理网络配置的守护进程, 能够让网络设备保持连接状态. 可以使用nmcli命令来管理Network Manager服务.<br>nmcli是一款基于命令行的网络配置工具, 功能丰富, 参数众多. 它可以轻松地查看网络信息或网络状态:<br><code>nmcli connection show</code><br><code>nmcli con show eno16777736</code></p>
<p>RHEL7系统支持网络会话功能, 允许用户在多个配置文件中快速切换(非常类似于firewalld防火墙服务中的区域技术).<br>使用nmcli命令并按照”connection add con-name type ifname”的格式来创建网络会话.</p>
<p>假设将公司网络中的网络会话称之为company, 将家庭网络中的网络会话称之为house, 现在依次创建各自的网络会话:</p>
<pre>
使用con-name参数指定公司所使用的网络会话名称company, 然后依次用ifname参数指定本机的网卡名称, 用autoconnect no参数设置该网络会话默认不被自动激活, 以及用ip4及gw4参数手动指定网络的IP地址:
nmcli connection add con-name company ifname eno16777736 autoconnect no type ethernet ip4 192.168.10.10/24 gw4 192.168.10.1

使用con-name参数指定家庭所使用的网络会话名称house. 因为我们想从外部DHCP服务器自动获得IP地址, 因此这里不需要进行手动指定.
nmcli connection add con-name house type ethernet ifname eno16777736

使用nmcli命令查看创建的所有网络会话:
nmcli connection show

使用nmcli命令配置过的网络会话是永久生效的, 启用house网络会话, 网卡就能自动通过DHCP获取到IP地址.
nmcli connection up house
</pre>

<p>把虚拟机系统的网卡(网络适配器)切换成桥接模式, 然后重启虚拟机系统.<br><img src="/post/cea46563/%E8%AE%BE%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E5%8D%A1%E7%9A%84%E6%A8%A1%E5%BC%8F.png" alt="设置虚拟机网卡的模式"></p>
<h3 id="绑定两块网卡"><a href="#绑定两块网卡" class="headerlink" title="绑定两块网卡"></a>绑定两块网卡</h3><p>一般来讲, 生产环境必须提供7×24小时的网络传服务. 借助于网卡绑定技术, 不仅可以提高网络传输速度, 更重要的是, 还可以确保在其中一块网卡出现故障时, 依然可以正常提供网络服务.</p>
<p>第1步: 在虚拟机系统中再添加一块网卡设备, 请确保两块网卡都处在同一个网络连接中(即网卡模式相同), 处于相同模式的网卡设备才可以进行网卡绑定, 否则这两块网卡无法互相传送数据.<br><img src="/post/cea46563/%E7%BC%96%E8%BE%91%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AE%BE%E7%BD%AE,%E6%B7%BB%E5%8A%A0%E7%BD%91%E7%BB%9C%E9%80%82%E9%85%8D%E5%99%A8.png" alt="编辑虚拟机设置,添加网络适配器"><br><img src="/post/cea46563/%E4%BF%9D%E8%AF%81%E4%B8%A4%E5%9D%97%E7%BD%91%E5%8D%A1%E7%9A%84%E8%BF%9E%E6%8E%A5%E7%B1%BB%E5%9E%8B%E9%83%BD%E6%98%AF%E7%9B%B8%E5%90%8C%E7%9A%84.png" alt="保证两块网卡的连接类型都是相同的"></p>
<p>第2步: 使用Vim文本编辑器来配置网卡设备的绑定参数, 需要注意的是, 这些原本独立的网卡设备此时需要被配置成为一块”从属”网卡, 服务于”主”网卡, 不应该再有自己的IP地址等信息. 在进行了初始设置之后, 它们就可以支持网卡绑定.<br><code>vim /etc/sysconfig/network-scripts/ifcfg-eno</code></p>
<pre>
 TYPE=Ethernet
 BOOTPROTO=none
 ONBOOT=yes
 USERCTL=no
 DEVICE=eno
 MASTER=bond0
 SLAVE=yes
</pre>

<p>还需要将绑定后的设备命名为bond0并把IP地址等信息填写进去, 这样当用户访问相应服务的时候, 实际上就是由这两块网卡设备在共同提供服务.<br><code>vim /etc/sysconfig/network-scripts/ifcfg-bond0</code></p>
<pre>
 TYPE=Ethernet
 BOOTPROTO=none
 ONBOOT=yes
 USERCTL=no
 DEVICE=bond0
 IPADDR=192.168.10.10
 PREFIX=24
 DNS=192.168.10.1
 NM_CONTROLLED=no
</pre>

<p>第3步: 让Linux内核支持网卡绑定驱动. 常见的网卡绑定驱动有三种模式—mode0、mode1和mode6.</p>
<pre>
 mode0(平衡负载模式): 平时两块网卡均工作, 且自动备援, 但需要在与服务器本地网卡相连的交换机设备上进行端口聚合来支持绑定技术.
 mode1(自动备援模式): 平时只有一块网卡工作, 在它故障后自动替换为另外的网卡.
 mode6(平衡负载模式): 平时两块网卡均工作, 且自动备援, 无须交换机设备提供辅助支持.
</pre>

<p>使用Vim文本编辑器创建一个用于网卡绑定的驱动文件, 使得绑定后的bond0网卡设备能够支持绑定技术(bonding); 同时定义网卡以mode6模式进行绑定, 且出现故障时自动切换的时间为100毫秒.<br><code>vim /etc/modprobe.d/bond.conf</code></p>
<pre>
 alias bond0 bonding
 options bond0 miimon=100 mode=6 
</pre>

<p>第4步: 重启网络服务后网卡绑定操作即可成功. 正常情况下只有bond0网卡设备才会有IP地址等信息:<br><code>systemctl restart network</code></p>
<p>注: 出现该信息时, 无视即可.<br><img align="left" src="/post/cea46563/重启网络服务后提示.png" title="重启网络服务后的提示" alt="重启网络服务后的提示"><br><br></p>
<p>可以在本地主机执行ping 192.168.10.10命令检查网络的连通性. 为了检验网卡绑定技术的自动备援功能, 在虚拟机硬件配置中随机移除一块网卡设备, 可以非常清晰地看到网卡切换的过程(一般只有1个数据丢包). 然后另外一块网卡会继续为用户提供服务.<br><code>ping -t 192.168.10.10</code></p>
<h2 id="远程控制服务"><a href="#远程控制服务" class="headerlink" title="远程控制服务"></a>远程控制服务</h2><h3 id="配置sshd服务"><a href="#配置sshd服务" class="headerlink" title="配置sshd服务"></a>配置sshd服务</h3><p>SSH(Secure Shell)是一种能够以安全的方式提供远程登录的协议, 也是目前远程管理Linux系统的首选方式. 想要使用SSH协议来远程管理Linux系统, 则需要部署配置sshd服务程序.<br>sshd是基于SSH协议开发的一款远程管理服务程序, 不仅使用起来方便快捷, 而且能够提供两种安全验证的方法:</p>
<pre>
 基于口令的验证—用账户和密码来验证登录
 基于密钥的验证—需要在本地生成密钥对, 然后把密钥对中的公钥上传至服务器并与服务器中的公钥进行比较. 该方式相较来说更安全.
</pre>

<p>sshd服务的配置信息保存在/etc/ssh/sshd_config文件中. 运维人员一般会把保存着最主要配置信息的文件称为主配置文件, 而配置文件中有许多以井号开头的注释行, 要想让这些配置参数生效, 需要在修改参数后再去掉前面的井号.</p>
<table>
<tr><td>Port 22</td><td>默认的sshd服务端口</td></tr>
<tr><td>ListenAddress 0.0.0.0</td><td>设定sshd服务器监听的IP地址</td></tr>
<tr><td>Protocol 2</td><td>SSH协议的版本号</td></tr>
<tr><td>HostKey /tc/ssh/ssh_host_key</td><td>SSH协议版本为1时, DES私钥存放的位置.</td></tr>
<tr><td>HostKey /etc/ssh/ssh_host_rsa_key</td><td>SSH协议版本为2时, RSA私钥存放的位置.</td></tr>
<tr><td>HostKey /etc/ssh/ssh_host_dsa_key</td><td>SSH协议版本为2时, DSA私钥存放的位置.</td></tr>
<tr><td>PermitRootLogin yes</td><td>设定是否允许root管理员直接登录</td></tr>
<tr><td>StrictModes yes</td><td>当远程用户的私钥改变时直接拒绝连接</td></tr>
<tr><td>MaxAuthTries 6</td><td>最大密码尝试次数</td></tr>
<tr><td>MaxSessions 10</td><td>最大终端数</td></tr>
<tr><td>PasswordAuthentication yes</td><td>是否允许密码验证</td></tr>
<tr><td>PermitEmptyPasswords no</td><td>是否允许空密码登录(很不安全)</td></tr>
</table>

<p>使用ssh命令进行远程连接, 其格式为<code>ssh [参数] 主机IP地址</code>. 要退出登录则执行exit命令.</p>
<p>想让新配置文件生效, 则需要手动重启相应的服务程序. 最好也将这个服务程序加入到开机启动项中, 这样系统在下一次启动时, 该服务程序便会自动运行, 继续为用户提供服务.<br><code>systemctl restart sshd</code>&nbsp;&nbsp;<code>systemctl enable sshd</code></p>
<h3 id="安全密钥验证"><a href="#安全密钥验证" class="headerlink" title="安全密钥验证"></a>安全密钥验证</h3><p>加密是对信息进行编码和解码的技术, 它通过一定的算法(密钥)将原本可以直接阅读的明文信息转换成密文形式. 密钥即是密文的钥匙, 有私钥和公钥之分. 在传输数据时, 如果担心被他人监听或截获, 就可以在传输前先使用公钥对数据加密处理, 然后再行传送.</p>
<p>第1步: 在客户端主机中生成”密钥对”</p>
<pre>
 ssh-keygen
 按回车键或设置密钥的存储路径
 再次按回车键或设置密钥的密码
</pre>

<p>第2步: 把客户端主机中生成的公钥文件传送至远程主机</p>
<pre>
 ssh-copy-id 192.168.10.10
 yes
 输入远程服务器密码
</pre>

<p>第3步: 对服务器进行设置, 使其只允许密钥验证, 拒绝传统的口令验证方式. 记得在修改配置文件后保存并重启sshd服务程序.</p>
<pre>
 vim /etc/ssh/sshd_config
 PasswordAuthentication no
 systemctl restart sshd
</pre>

<p>第4步: 在客户端尝试登录到服务器, 此时无须输入密码也可成功登录.<br><code>ssh 192.168.10.10</code></p>
<h3 id="远程传输命令"><a href="#远程传输命令" class="headerlink" title="远程传输命令"></a>远程传输命令</h3><p>scp(secure copy)是一个基于SSH协议在网络之间进行安全传输的命令, 其格式为<code>scp [参数] 本地文件 远程帐户@远程IP地址:远程目录</code>. 与cp命令不同, cp命令只能在本地硬盘中进行文件复制, 而scp不仅能够通过网络传送数据, 而且所有的数据都将进行加密处理.</p>
<table>
<tr><td>参数</td><td>作用</td></tr>
<tr><td>-v</td><td>显示详细的连接进度</td></tr>
<tr><td>-P</td><td>指定远程主机的sshd端口号</td></tr>
<tr><td>-r</td><td>用于传送文件夹</td></tr>
<tr><td>-6</td><td>使用IPv6协议</td></tr>
</table>

<p>使用scp命令把文件从本地复制到远程主机时, 首先需要以绝对路径的形式写清本地文件的存放位置.</p>
<pre>
 echo "Welcome to LinuxProbe.Com" > readme.txt
 scp /root/readme.txt 192.168.10.20:/home
 输入远程服务器中root管理员的密码
</pre>

<p>使用scp命令把远程主机上的文件下载到本地主机, 其命令格式为<code>scp [参数] 远程用户@远程IP地址:远程文件 本地目录</code>. </p>
<pre>
 scp 192.168.10.20:/etc/redhat-release /root
 输入远程服务器中root管理员的密码
</pre>

<h2 id="不间断会话服务"><a href="#不间断会话服务" class="headerlink" title="不间断会话服务"></a>不间断会话服务</h2><p>screen是一款能够实现多窗口远程控制的开源服务程序, 简单来说就是为了解决网络异常中断或为了同时控制多个远程终端窗口而设计的程序. 用户还可以使用screen服务程序同时在多个远程会话中自由切换, 能够做到实现如下功能:</p>
<pre>
 会话恢复: 即便网络中断, 也可让会话随时恢复, 确保用户不会失去对远程会话的控制.
 多窗口: 每个会话都是独立运行的, 拥有各自独立的输入输出终端窗口, 终端窗口内显示过的信息也将被分开隔离保存, 以便下次使用时依然能看到之前的操作记录.
 会话共享: 当多个用户同时登录到远程服务器时, 便可以使用会话共享功能让用户之间的输入输出信息共享.
</pre>

<p>在RHEL 7系统中, 没有默认安装screen服务程序, 因此需要配置Yum仓库来安装它. 首先将虚拟机的CD/DVD光盘选项设置为”使用ISO镜像文件”, 并选择已经下载好的系统镜像.<br><img src="/post/cea46563/%E7%A1%AE%E8%AE%A4%E5%85%89%E7%9B%98%E5%B7%B2%E8%A2%AB%E9%80%89%E4%B8%AD.png" alt="确认光盘已被选中"></p>
<p>然后, 把光盘设备中的系统镜像挂载到/media/cdrom目录.</p>
<pre>
 mkdir -p /media/cdrom
 mount /dev/cdrom /media/cdrom
</pre>

<p>最后, 使用Vim文本编辑器创建Yum仓库的配置文件.</p>
<pre>
 vim /etc/yum.repos.d/rhel7.repo
 [rhel7]
 name=rhel7
 baseurl=file:///media/cdrom
 enabled=1
 gpgcheck=0
</pre>

<p>使用Yum仓库来安装screen服务程序<br><code>yum install screen</code></p>
<h3 id="管理远程会话"><a href="#管理远程会话" class="headerlink" title="管理远程会话"></a>管理远程会话</h3><p>screen命令可以用-S参数创建会话窗口; 用-d参数将指定会话进行离线处理; 用-r参数恢复指定会话; 用-x参数一次性恢复所有的会话; 用-ls参数显示当前已有的会话; 以及用-wipe参数把目前无法使用的会话删除, 等等.</p>
<p>创建一个名称为backup的会话窗口<br><code>screen -S backup</code></p>
<p>可以查看到当前的会话正在工作中<br><code>screen -ls</code></p>
<p>退出一个会话<br><code>exit</code></p>
<p>可以直接使用screen命令执行要运行的命令, 这样在命令中的一切操作也都会被记录下来, 当命令执行结束后screen会话也会自动结束.<br><code>screen vim memo.txt</code></p>
<p>来创建一个名为linux的会话, 然后强行把窗口关闭掉(这与进行远程连接时突然断网具有相同的效果):</p>
<pre>
 screen -S linux
 tail -f /var/log/messages
</pre>

<p>查看一下刚刚离线的会话名称, 然后尝试恢复回来就可以继续工作了:</p>
<pre>
 screen -ls
 screen -r linux
</pre>

<p>可以多创建几个会话窗口放在一起使用. 如果这段时间内不再使用某个会话窗口, 可以把它设置为临时断开(detach)模式, 随后在需要时再重新连接(attach)回来即可.</p>
<h3 id="会话共享功能"><a href="#会话共享功能" class="headerlink" title="会话共享功能"></a>会话共享功能</h3><p>screen命令不仅可以确保用户在极端情况下也不丢失对系统的远程控制, 保证了生产环境中远程工作的不间断性, 而且它还具有会话共享、分屏切割、会话锁定等实用的功能.</p>
<p><img src="/post/cea46563/screen%E4%BC%9A%E8%AF%9D%E5%85%B1%E4%BA%AB.png" alt="screen会话共享"><br>首先, 使用ssh服务程序将终端A远程连接到服务器, 并创建一个会话窗口.</p>
<pre>
 ssh 192.168.10.10
 screen -S linuxprobe
</pre>

<p>然后, 使用ssh服务程序将终端B远程连接到服务器, 并执行获取远程会话的命令.</p>
<pre>
 ssh 192.168.10.10
 screen -x
</pre>

<h1 id="使用Apache服务部署静态网站"><a href="#使用Apache服务部署静态网站" class="headerlink" title="使用Apache服务部署静态网站"></a>使用Apache服务部署静态网站</h1><h2 id="网站服务程序"><a href="#网站服务程序" class="headerlink" title="网站服务程序"></a>网站服务程序</h2><p>Web网络服务是一种被动访问的服务程序, 即只有接收到互联网中其他主机发出的请求后才会响应, 最终用于提供服务程序的Web服务器会通过HTTP(超文本传输协议)或HTTPS(安全超文本传输协议)把请求的内容传送给用户.<br><img src="/post/cea46563/%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B.png" alt="页面请求过程"></p>
<p>第1步: 把光盘设备中的系统镜像挂载到/media/cdrom目录</p>
<pre>
 mkdir -p /media/cdrom
 mount /dev/cdrom /media/cdrom
</pre>

<p>第2步: 使用Vim文本编辑器创建Yum仓库的配置文件</p>
<pre>
 vim /etc/yum.repos.d/rhel7.repo
 [rhel7]
 name=rhel7
 baseurl=file:///media/cdrom
 enabled=1
 gpgcheck=0
</pre>

<p>第3步: 动手安装Apache服务程序, 注意: Apache服务的软件包名称为httpd.<br><code>yum install httpd</code></p>
<p>第4步: 启用httpd服务程序并将其加入到开机启动项中, 使其能够随系统开机而运行, 从而持续为用户提供Web服务:</p>
<pre>
 systemctl start httpd
 systemctl enable httpd

 firefox
 输入网址: 127.0.0.1
</pre>

<h2 id="配置服务文件参数"><a href="#配置服务文件参数" class="headerlink" title="配置服务文件参数"></a>配置服务文件参数</h2><table>
httpd服务程序的主要配置文件及存放位置
<tr><td>服务目录</td><td>/etc/httpd</td></tr>
<tr><td>主配置文件</td><td>/etc/httpd/conf/httpd.conf</td></tr>
<tr><td>网站数据目录</td><td>/var/www/html</td></tr>
<tr><td>访问日志</td><td>/var/log/httpd/access_log</td></tr>
<tr><td>错误日志</td><td>/var/log/httpd/error_log</td></tr>
</table>

<p>httpd服务程序的主配置文件中, 存在三种类型的信息:注释行信息、全局配置、区域配置.</p>
<pre>
 注释行信息
 # ----------

 全局配置
 ServerRoot "/etc/httpd"
 ServerName www.linuxprobe.com

 区域配置
 &lt;Directory /&gt;
 &lt;/Directory&gt;
</pre>

<p>全局配置参数就是一种全局性的配置参数, 可作用于对所有的子站点, 既保证了子站点的正常访问, 也有效减少了频繁写入重复参数的工作量. 区域配置参数则是单独针对于每个独立的子站点进行设置的.</p>
<table>
在httpd服务程序主配置文件中, 最为常用的参数:
<tr><td>ServerRoot</td><td>服务目录</td></tr>
<tr><td>ServerAdmin</td><td>管理员邮箱</td></tr>
<tr><td>User</td><td>运行服务的用户</td></tr>
<tr><td>Group</td><td>运行服务的用户组</td></tr>
<tr><td>ServerName</td><td>网站服务器的域名</td></tr>
<tr><td>DocumentRoot</td><td>网站数据目录</td></tr>
<tr><td>Listen</td><td>监听的IP地址与端口号</td></tr>
<tr><td>DirectoryIndex</td><td>默认的索引页页面</td></tr>
<tr><td>ErrorLog</td><td>错误日志文件</td></tr>
<tr><td>CustomLog</td><td>访问日志文件</td></tr>
<tr><td>Timeout</td><td>网页超时时间, 默认为300秒.</td></tr>
</table>

<p>在默认情况下, 网站数据是保存在/var/www/html目录中, 把保存网站数据的目录修改为/home/wwwroot目录:<br>第1步: 建立网站数据的保存目录, 并创建首页文件.</p>
<pre>
 mkdir /home/wwwroot
 echo "The New Web Directory" > /home/wwwroot/index.html
</pre>

<p>第2步: 打开httpd服务程序的主配置文件, 将用于定义网站数据保存路径的参数DocumentRoot修改为/home/wwwroot, 同时还需要将用于定义目录权限的参数Directory后面的路径也修改为/home/wwwroot. 配置文件修改完毕后即可保存并退出.</p>
<pre>
 vim /etc/httpd/conf/httpd.conf

 DocumentRoot "/home/wwwroot"
 &lt;Directory "/home/wwwroot"&gt;
</pre>

<p>第3步: 重新启动httpd服务程序并验证效果</p>
<pre>
 systemctl restart httpd

 firefox
 输入网址: 127.0.0.1
</pre>
<p>只有在网站的首页面文件不存在或者用户权限不足时, 才显示httpd服务程序的默认首页面. 这时则要配置SELinux安全子系统:<code>setenforce 0</code>.</p>
<h2 id="SELinux安全子系统"><a href="#SELinux安全子系统" class="headerlink" title="SELinux安全子系统"></a>SELinux安全子系统</h2><p>SELinux(Security-Enhanced Linux)是美国国家安全局在Linux开源社区的帮助下开发的一个强制访问控制(MAC, Mandatory Access Control)的安全子系统. RHEL 7系统使用SELinux技术的目的是为了让各个服务进程都受到约束, 使其仅获取到本应获取的资源.</p>
<table>
SELinux服务有三种配置模式:
<tr><td>enforcing</td><td>强制启用安全策略模式, 将拦截服务的不合法请求.</td></tr>
<tr><td>permissive</td><td>遇到服务越权访问时, 只发出警告而不强制拦截.</td></tr>
<tr><td>disabled</td><td>对于越权的行为不警告也不拦截</td></tr>
</table>

<p>在生产环境中相当不推荐, 查看SELinux服务主配置文件中定义的默认状态. 如果是permissive或disabled, 建议赶紧修改为enforcing.</p>
<pre>
 vim /etc/selinux/config
 SELINUX=enforcing
</pre>

<p>SELinux服务的主配置文件中, 定义的是SELinux的默认运行状态, 可以将其理解为系统重启后的状态, 因此它不会在更改后立即生效. 可以用setenforce [0|1]命令修改SELinux当前的运行模式(0为禁用, 1为启用), 使用getenforce命令获得当前SELinux服务的运行模式. 注意, 这种修改只是临时的, 在系统重启后就会失效. </p>
<pre>
 setenforce 0
 getenforce
</pre>

<p>把SELinux服务恢复到强制启用安全策略模式, 然后分别查看原始网站数据的保存目录与当前网站数据的保存目录是否拥有不同的SELinux安全上下文值:</p>
<pre>
 setenforce 1
 ls -Zd /var/www/html
 ls -Zd /home/wwwroot

 drwxr-xr-x. root root <font color="#FF8C00">system_u</font>:<font color="#9932CC">object_r</font>:<font color="#8FBC8F">httpd_sys_content_t</font>:s0 /var/www/html
 drwxrwxrwx. root root unconfined_u:object_r:home_root_t:s0 /home/wwwroot
</pre>
<p>在文件上设置的SELinux安全上下文是由用户段、角色段以及类型段等多个信息项共同组成的. 其中,<br>用户段<font color="#FF8C00">system_u</font>代表系统进程的身份,<br>角色段<font color="#9932CC">object_r</font>代表文件目录的角色,<br>类型段<font color="#8FBC8F">httpd_sys_content_t</font>代表网站服务的系统文件.</p>
<p>semanage命令用于管理SELinux的策略, 不仅能够像传统chcon命令那样—设置文件、目录的策略, 还可以管理网络端口、消息接口. 使用时, 经常用到的几个参数及其功能:</p>
<pre>
 semanage [选项] [文件]
 |__ -l --用于查询
 |__ -a --用于添加
 |__ -m --用于修改
 |__ -d --用于删除
</pre>

<p>例: 可以向新的网站数据目录中新添加一条SELinux安全上下文, 让这个目录以及里面的所有文件能够被httpd服务程序所访问到:</p>
<pre>
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/*
</pre>

<p>使用restorecon命令将设置好的SELinux安全上下文立即生效. 在使用restorecon命令时, 可以加上-Rv参数对指定的目录进行递归操作, 以及显示SELinux安全上下文的修改过程.<br><code>restorecon -Rv /home/wwwroot/</code></p>
<h2 id="个人用户主页功能"><a href="#个人用户主页功能" class="headerlink" title="个人用户主页功能"></a>个人用户主页功能</h2><p>该功能可以让系统内所有的用户在自己的家目录中管理个人的网站, 而且访问起来也非常容易.</p>
<p>第1步: 在httpd服务程序中, 默认没有开启个人用户主页功能. 编辑配置文件, 然后在UserDir disabled参数前面加上井号(#), 表示让httpd服务程序开启个人用户主页功能; 同时再把UserDir public_html参数前面的井号(#)去掉. 最后, 在修改完毕后保存并退出.<br>(UserDir参数表示网站数据在用户家目录中的保存目录名称, 即public_html目录)</p>
<pre>
 vim /etc/httpd/conf.d/userdir.conf

 # UserDir disabled
 UserDir public_html
</pre>

<p>第2步: 在用户家目录中建立用于保存网站数据的目录及首页面文件. 另外, 还需要把家目录的权限修改为755, 保证其他人也有权限读取里面的内容.</p>
<pre>
 su - linuxprobe
 mkdir public_html
 echo "This is linuxprobe's website" > public_html/index.html
 chmod -Rf 755 /home/linuxprobe
</pre>

<p>第3步: SELinux域确保服务程序不能执行违规的操作, 只能本本分分地为用户提供服务, 使用getsebool命令查询并过滤出所有与HTTP协议相关的安全策略. 其中, off为禁止状态, on为允许状态.</p>
<pre>
 getsebool -a | grep http

 httpd_enable_homedirs --> off
</pre>

<p>使用setsebool命令来修改SELinux策略中各条规则的布尔值. 在setsebool命令后面加上-P参数, 让修改后的SELinux策略规则永久生效且立即生效.<br><code>setsebool -P httpd_enable_homedirs=on</code></p>
<p>第4步: 重新启动httpd服务程序, 在浏览器的地址栏中输入网址, 其格式为”网址/~用户名”(其中的波浪号是必需的, 而且网址、波浪号、用户名之间没有空格)</p>
<pre>
 systemctl restart httpd

 左上角的Applications中打开firefox
 输入网址: 127.0.0.1/~用户名
</pre>

<p>在网站中添加口令功能, 使用户访客通过身份验证的方式查看网页里面的内容:</p>
<p>第1步: 先使用htpasswd命令生成密码数据库. -c参数表示第一次生成; 后面再分别添加密码数据库的存放文件, 以及验证要用到的用户名称(该用户不必是系统中已有的本地账户).</p>
<pre>
 htpasswd -c /etc/httpd/passwd linuxprobe
 输入用于网页验证的密码
 再次输入密码进行确认
</pre>

<p>第2步: 编辑个人用户主页功能的配置文件. 把第31～35行的参数信息修改成下列内容, 随后保存并退出配置文件, 重启httpd服务程序即可生效.</p>
<pre>
 vim /etc/httpd/conf.d/userdir.conf
 <figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">&lt;Directory "/home/*/public_html"&gt;</span></span><br><span class="line">   AllowOverride <span class="literal">all</span></span><br><span class="line">   authuserfile <span class="string">"/etc/httpd/passwd"</span> <span class="comment">#刚刚生成出来的密码验证文件保存路径</span></span><br><span class="line">   authname <span class="string">"My privately website"</span> <span class="comment">#当用户尝试访问个人用户网站时的提示信息</span></span><br><span class="line">   authtype <span class="keyword">basic</span></span><br><span class="line">   require <span class="keyword">user</span> linuxprobe <span class="comment">#用户进行账户密码登录时需要验证的用户名称</span></span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>
 systemctl restart httpd
</pre>

<h2 id="虚拟网站主机功能"><a href="#虚拟网站主机功能" class="headerlink" title="虚拟网站主机功能"></a>虚拟网站主机功能</h2><p>利用虚拟主机功能, 可以把一台处于运行状态的物理服务器分割成多个”虚拟的服务器”. 但是, 该技术无法实现目前云主机技术的硬件资源隔离, 让这些虚拟的服务器共同使用物理服务器的硬件资源, 供应商只能限制硬盘的使用空间大小. 出于各种考虑的因素(主要是价格低廉), 目前依然有很多企业或个人站长在使用虚拟主机的形式来部署网站.<br>Apache的虚拟主机功能是服务器基于用户请求的不同IP地址、主机域名或端口号, 实现提供多个网站同时为外部提供访问服务的技术.</p>
<h3 id="基于IP地址"><a href="#基于IP地址" class="headerlink" title="基于IP地址"></a>基于IP地址</h3><p>如果一台服务器有多个IP地址, 而且每个IP地址与服务器上部署的每个网站一一对应, 这样当用户请求访问不同的IP地址时, 会访问到不同网站的页面资源. 而且, 每个网站都有一个独立的IP地址, 对搜索引擎优化也大有裨益.</p>
<p>配置三个IP地址, 测试连通性.</p>
<pre>
 nmtui

 192.168.10.10./24
 192.168.10.20./24
 192.168.10.30./24

 systemctl restart network
</pre>

<p>第1步: 分别在/home/wwwroot中创建用于保存不同网站数据的3个目录, 并向其中分别写入网站的首页文件. 每个首页文件中应有明确区分不同网站内容的信息, 方便我们稍后能更直观地检查效果.</p>
<pre>
 mkdir -p /home/wwwroot/10
 mkdir -p /home/wwwroot/20
 mkdir -p /home/wwwroot/30
 echo "IP:192.168.10.10" > /home/wwwroot/10/index.html
 echo "IP:192.168.10.20" > /home/wwwroot/20/index.html
 echo "IP:192.168.10.30" > /home/wwwroot/30/index.html
</pre>

<p>第2步: 在httpd服务的配置文件中大约113行处开始, 分别追加写入三个基于IP地址的虚拟主机网站参数, 然后保存并退出, 重启httpd服务. 或者将Include conf/extra/httpd-vhosts.conf的注释取消, 将以下写入该配置文件中.</p>
<pre>
 vim /etc/httpd/conf/httpd.conf
 <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;VirtualHost 192.168.10.10&gt;</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> /home/wwwroot/10</span><br><span class="line">   <span class="attribute"><span class="nomarkup">ServerName</span></span> www.linuxprobe.com</span><br><span class="line">   <span class="section">&lt;Directory /home/wwwroot/10 &gt;</span></span><br><span class="line">   <span class="attribute">AllowOverride</span> None</span><br><span class="line">   <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line">   <span class="section">&lt;/Directory&gt;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;VirtualHost 192.168.10.20&gt;</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> /home/wwwroot/20</span><br><span class="line">   <span class="attribute"><span class="nomarkup">ServerName</span></span> bbs.linuxprobe.com</span><br><span class="line">   <span class="section">&lt;Directory /home/wwwroot/20 &gt;</span></span><br><span class="line">   <span class="attribute">AllowOverride</span> None</span><br><span class="line">   <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line">   <span class="section">&lt;/Directory&gt;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;VirtualHost 192.168.10.30&gt;</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> /home/wwwroot/30</span><br><span class="line">   <span class="attribute"><span class="nomarkup">ServerName</span></span> tech.linuxprobe.com</span><br><span class="line">   <span class="section">&lt;Directory /home/wwwroot/30 &gt;</span></span><br><span class="line">   <span class="attribute">AllowOverride</span> None</span><br><span class="line">   <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line">   <span class="section">&lt;/Directory&gt;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br></pre></td></tr></table></figure>
 systemctl restart httpd
</pre>

<p>第3步:向新的网站数据目录中新添加一条SELinux安全上下文, 让这个目录以及里面的所有文件能够被httpd服务程序所访问到, 并使用restorecon命令让新设置的SELinux安全上下文立即生效.</p>
<pre>
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/10
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/10/*
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/20
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/20/*
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/30
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/30/*
 restorecon -Rv /home/wwwroot

 左上角的Applications中打开firefox
 分别输入ip地址进行查看
</pre>

<h3 id="基于主机域名"><a href="#基于主机域名" class="headerlink" title="基于主机域名"></a>基于主机域名</h3><p>当服务器无法为每个网站都分配一个独立IP地址的时候, 可以尝试让Apache自动识别用户请求的域名, 从而根据不同的域名请求来传输不同的内容. 在这种情况下的配置更加简单, 只需要保证位于生产环境中的服务器上有一个可用的IP地址(这里以192.168.10.10为例)就可以了. </p>
<p>由于当前还没有介绍如何配置DNS解析服务, 因此需要手工定义IP地址与域名之间的对应关系. /etc/hosts是Linux系统中用于强制把某个主机域名解析到指定IP地址的配置文件.</p>
<p>第1步: 手工定义IP地址与域名之间对应关系的配置文件, 保存并退出后会立即生效. 可以通过分别ping这些域名来验证域名是否已经成功解析为IP地址.</p>
<pre>
 vim /etc/hosts
 192.168.10.10 www.linuxprobe.com bbs.linuxprobe.com tech.linuxprobe.com

 ping -c 4 www.linuxprobe.com
 ping -c 4 bbs.linuxprobe.com
 ping -c 4 tech.linuxprobe.com
</pre>

<p>第2步: 分别在/home/wwwroot中创建用于保存不同网站数据的三个目录, 并向其中分别写入网站的首页文件. 每个首页文件中应有明确区分不同网站内容的信息, 方便我们稍后能更直观地检查效果.</p>
<pre>
mkdir -p /home/wwwroot/www
mkdir -p /home/wwwroot/bbs
mkdir -p /home/wwwroot/tech
echo "WWW.linuxprobe.com" > /home/wwwroot/www/index.html
echo "BBS.linuxprobe.com" > /home/wwwroot/bbs/index.html
echo "TECH.linuxprobe.com" > /home/wwwroot/tech/index.html
</pre>

<p>第3步: 在httpd服务的配置文件中大约113行处开始, 分别追加写入三个基于主机名的虚拟主机网站参数, 然后保存并退出. 记得需要重启httpd服务, 这些配置才生效.</p>
<pre>
 vim /etc/httpd/conf/httpd.conf
 <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;VirtualHost 192.168.10.10&gt;</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> <span class="string">"/home/wwwroot/www"</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">ServerName</span></span> <span class="string">"www.linuxprobe.com"</span></span><br><span class="line">   <span class="section">&lt;Directory "/home/wwwroot/www"&gt;</span></span><br><span class="line">   <span class="attribute">AllowOverride</span> None</span><br><span class="line">   <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line">   <span class="section">&lt;/directory&gt;</span> </span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;VirtualHost 192.168.10.10&gt;</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> <span class="string">"/home/wwwroot/bbs"</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">ServerName</span></span> <span class="string">"bbs.linuxprobe.com"</span></span><br><span class="line">   <span class="section">&lt;Directory "/home/wwwroot/bbs"&gt;</span></span><br><span class="line">   <span class="attribute">AllowOverride</span> None</span><br><span class="line">   <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line">   <span class="section">&lt;/Directory&gt;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;VirtualHost 192.168.10.10&gt;</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> <span class="string">"/home/wwwroot/tech"</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">ServerName</span></span> <span class="string">"tech.linuxprobe.com"</span></span><br><span class="line">   <span class="section">&lt;Directory "/home/wwwroot/tech"&gt;</span></span><br><span class="line">   <span class="attribute">AllowOverride</span> None</span><br><span class="line">   <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line">   <span class="section">&lt;/directory&gt;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br></pre></td></tr></table></figure>
 systemctl restart httpd
</pre>

<p>第4步:向新的网站数据目录中新添加一条SELinux安全上下文, 让这个目录以及里面的所有文件能够被httpd服务程序所访问到, 并使用restorecon命令让新设置的SELinux安全上下文立即生效.</p>
<pre>
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/www
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/www/*
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/bbs
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/bbs/*
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/tech
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/tech/*
 restorecon -Rv /home/wwwroot

 左上角的Applications中打开firefox
 分别输入域名进行查看
</pre>

<h3 id="基于端口号"><a href="#基于端口号" class="headerlink" title="基于端口号"></a>基于端口号</h3><p>基于端口号的虚拟主机功能可以让用户通过指定的端口号来访问服务器上的网站资源. 在使用Apache配置虚拟网站主机功能时, 基于端口号的配置方式是最复杂的. 因此我们不仅要考虑httpd服务程序的配置因素, 还需要考虑到SELinux服务对新开设端口的监控. </p>
<p>一般来说, 使用80、443、8080等端口号来提供网站访问服务是比较合理的, 如果使用其他端口号则会受到SELinux服务的限制.</p>
<p>第1步: 分别在/home/wwwroot中创建用于保存不同网站数据的两个目录, 并向其中分别写入网站的首页文件. 每个首页文件中应有明确区分不同网站内容的信息, 方便我们稍后能更直观地检查效果.</p>
<pre>
 mkdir -p /home/wwwroot/6111
 mkdir -p /home/wwwroot/6222
 echo "port:6111" > /home/wwwroot/6111/index.html
 echo "port:6222" > /home/wwwroot/6222/index.html
</pre>

<p>第2步: 在httpd服务配置文件的第43行和第44行分别添加用于监听6111和6222端口的参数</p>
<pre>
 vim /etc/httpd/conf/httpd.conf

 Listen 80
 Listen 6111
 Listen 6222
</pre>

<p>第3步: 在httpd服务的配置文件中大约113行处开始, 分别追加写入两个基于端口号的虚拟主机网站参数, 然后保存并退出. 重启httpd服务.</p>
<pre>
 vim /etc/httpd/conf/httpd.conf
 <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;VirtualHost 192.168.10.10:6111&gt;</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> <span class="string">"/home/wwwroot/6111"</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">ServerName</span></span> www.linuxprobe.com</span><br><span class="line">   <span class="section">&lt;Directory "/home/wwwroot/6111"&gt;</span></span><br><span class="line">   <span class="attribute">AllowOverride</span> None</span><br><span class="line">   <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line">   <span class="section">&lt;/Directory&gt;</span> </span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;VirtualHost 192.168.10.10:6222&gt;</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">DocumentRoot</span></span> <span class="string">"/home/wwwroot/6222"</span></span><br><span class="line">   <span class="attribute"><span class="nomarkup">ServerName</span></span> bbs.linuxprobe.com</span><br><span class="line">   <span class="section">&lt;Directory "/home/wwwroot/6222"&gt;</span></span><br><span class="line">   <span class="attribute">AllowOverride</span> None</span><br><span class="line">   <span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line">   <span class="section">&lt;/Directory&gt;</span></span><br><span class="line"><span class="section">&lt;/VirtualHost&gt;</span></span><br></pre></td></tr></table></figure>
</pre>

<p>第4步: 向新的网站数据目录中新添加一条SELinux安全上下文, 让这个目录以及里面的所有文件能够被httpd服务程序所访问到, 并使用restorecon命令让新设置的SELinux安全上下文立即生效.</p>
<pre>
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6111
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6111/*
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6222
 semanage fcontext -a -t httpd_sys_content_t /home/wwwroot/6222/*
 restorecon -Rv /home/wwwroot/
</pre>

<p>使用semanage命令查询并过滤出所有与HTTP协议相关且SELinux服务允许的端口列表<br><code>semanage port -l | grep http</code></p>
<p>第5步: SELinux允许的与HTTP协议相关的端口号中默认没有包含6111和6222, 因此需要将这两个端口号手动添加进去. 该操作会立即生效, 而且在系统重启过后依然有效. 设置好后再重启httpd服务程序.</p>
<pre>
 semanage port -a -t http_port_t -p tcp 6111
 semanage port -a -t http_port_t -p tcp 6222
 semanage port -l| grep http
 systemctl restart httpd

 左上角的Applications中打开firefox
 分别输入ip地址:端口号进行查看
</pre>

<h2 id="Apache的访问控制"><a href="#Apache的访问控制" class="headerlink" title="Apache的访问控制"></a>Apache的访问控制</h2><p>Apache可以基于源主机名、源IP地址或源主机上的浏览器特征等信息对网站上的资源进行访问控制.</p>
<p>它通过Allow指令允许某个主机访问服务器上的网站资源, 通过Deny指令实现禁止访问.</p>
<p>在允许或禁止访问网站资源时, 还会用到Order指令, 这个指令用来定义Allow或Deny指令起作用的顺序, 其匹配原则是按照顺序进行匹配, 若匹配成功则执行后面的默认指令.</p>
<p>第1步: 先在服务器上的网站数据目录中新建一个子目录, 并在这个子目录中创建一个包含Successful单词的首页文件.</p>
<pre>
 mkdir /var/www/html/server
 echo "Successful" > /var/www/html/server/index.html
</pre>

<p>第2步: 打开httpd服务的配置文件, 在第129行后面添加下述规则来限制源主机的访问. 这段规则的含义是允许使用Firefox浏览器的主机访问服务器上的首页文件, 除此之外的所有请求都将被拒绝. 然后重启httpd服务.</p>
<pre>
 vim /etc/httpd/conf/httpd.conf
 <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;Directory "/var/www/html/server"&gt;</span></span><br><span class="line">   <span class="attribute">SetEnvIf</span> User-Agent <span class="string">"Firefox"</span> ff=1</span><br><span class="line">   <span class="attribute"><span class="nomarkup">Order</span></span> allow,deny</span><br><span class="line">   <span class="attribute"><span class="nomarkup">Allow</span></span> from env=ff</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre></td></tr></table></figure>
 systemctl restart httpd
 左上角的Applications中打开firefox
 输入ip地址/server/
</pre>

<p>只允许IP地址为192.168.10.20的主机访问网站资源, 可以在httpd服务配置文件的第129行后面添加下述规则.<br> <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory <span class="string">"/var/www/html/server"</span>&gt;</span><br><span class="line">   Order allow,deny </span><br><span class="line">   Allow <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.20</span></span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="使用Vsftpd服务传输文件"><a href="#使用Vsftpd服务传输文件" class="headerlink" title="使用Vsftpd服务传输文件"></a>使用Vsftpd服务传输文件</h1><h2 id="文件传输协议"><a href="#文件传输协议" class="headerlink" title="文件传输协议"></a>文件传输协议</h2><p>FTP是一种在互联网中进行文件传输的协议, 基于客户端/服务器模式, 默认使用20、21号端口, FTP服务器普遍部署于内网中, 具有容易搭建、方便管理的特点. 而且有些FTP客户端工具还可以支持文件的多点下载以及断点续传技术.</p>
<p><img src="/post/cea46563/FTP%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B.png" alt="FTP连接过程"></p>
<table>
<tr><td>数据端口:20</td><td>用于进行数据传输</td></tr>
<tr><td>命令端口:21</td><td>用于接受客户端发出的相关FTP命令与参数</td></tr>
</table>

<p>FTP服务器是按照FTP协议在互联网上提供文件存储和访问服务的主机, FTP客户端则是向服务器发送连接请求, 以建立数据传输链路的主机. FTP协议有下面两种工作模式:</p>
<pre>
 主动模式: FTP服务器主动向客户端发起连接请求
 被动模式: FTP服务器等待客户端发起连接请求(FTP的默认工作模式)
</pre>

<p>vsftpd(very secure ftp daemon, 非常安全的FTP守护进程)是一款运行在Linux操作系统上的FTP服务程序, 不仅完全开源而且免费, 此外, 还具有很高的安全性、传输速度, 以及支持虚拟用户验证等其他FTP服务程序不具备的特点.</p>
<p>配置好Yum软件仓库后, 安装vsftpd服务程序.<br><code>yum install vsftpd</code></p>
<p>iptables防火墙管理工具默认禁止了FTP传输协议的端口号, 需要清空iptables防火墙的默认策略, 并把当前已经被清理的防火墙策略状态保存下来:</p>
<pre>
 iptables -F
 service iptables save
</pre>

<pre>
注:The service command supports only basic LSB actions (start, stop, restart, try-restart, reload, force-reload, status). For other actions, please try to use systemctl. 
执行下列代码:
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">yum -y install iptables-services</span><br><span class="line">systemctl <span class="builtin-name">enable</span> iptables</span><br><span class="line">systemctl start iptables</span><br><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>
</pre>


<p>将vsftpd服务程序的主配置文件(/etc/vsftpd/vsftpd.conf)进行备份后再进行注释行信息过滤, 并重定向到原始的主配置文件中.</p>
<pre>
 mv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf_bak
 grep -v "#" /etc/vsftpd/vsftpd.conf_bak > /etc/vsftpd/vsftpd.conf
</pre>

<table>
vsftpd服务程序主配置文件中常用的参数以及作用:
<tr><td>listen=[YES|NO]</td><td>是否以独立运行的方式监听服务</td></tr>
<tr><td>listen_address=IP地址</td><td>设置要监听的IP地址</td></tr>
<tr><td>listen_port=21</td><td>设置FTP服务的监听端口</td></tr>
<tr><td>download_enable＝[YES|NO]</td><td>是否允许下载文件</td></tr>
<tr><td>userlist_deny=[YES|NO]<br>userlist_enable=[YES|NO]</td><td>设置用户列表为"允许"还是"禁止"操作</td></tr>
<tr><td>max_clients=0</td><td>最大客户端连接数, 0为不限制.</td></tr>
<tr><td>max_per_ip=0</td><td>同一IP地址的最大连接数, 0为不限制.</td></tr>
<tr><td>anonymous_enable=[YES|NO]</td><td>是否允许匿名用户访问</td></tr>
<tr><td>anon_upload_enable=[YES|NO]</td><td>是否允许匿名用户上传文件</td></tr>
<tr><td>anon_umask=022</td><td>匿名用户上传文件的umask值</td></tr>
<tr><td>anon_root=/var/ftp</td><td>匿名用户的FTP根目录</td></tr>
<tr><td>anon_mkdir_write_enable=[YES|NO]</td><td>是否允许匿名用户创建目录</td></tr>
<tr><td>anon_other_write_enable=[YES|NO]</td><td>是否开放匿名用户的其他写入权限(包括重命名、删除等操作权限)</td></tr>
<tr><td>anon_max_rate=0</td><td>匿名用户的最大传输速率(字节/秒), 0为不限制.</td></tr>
<tr><td>local_enable=[YES|NO]</td><td>是否允许本地用户登录FTP</td></tr>
<tr><td>local_umask=022</td><td>本地用户上传文件的umask值</td></tr>
<tr><td>local_root=/var/ftp</td><td>本地用户的FTP根目录</td></tr>
<tr><td>chroot_local_user=[YES|NO]</td><td>是否将用户权限禁锢在FTP目录, 以确保安全.</td></tr>
<tr><td>local_max_rate=0</td><td>本地用户最大传输速率(字节/秒), 0为不限制.</td></tr>
</table>

<h2 id="Vsftpd服务程序"><a href="#Vsftpd服务程序" class="headerlink" title="Vsftpd服务程序"></a>Vsftpd服务程序</h2><p>vsftpd作为更加安全的文件传输的服务程序, 允许用户以三种认证模式登录到FTP服务器上.</p>
<p>匿名开放模式: 是一种最不安全的认证模式, 任何人都可以无需密码验证而直接登录到FTP服务器.</p>
<p>本地用户模式: 是通过Linux系统本地的账户密码信息进行认证的模式, 相较于匿名开放模式更安全, 而且配置起来也很简单.但是如果被黑客破解了账户的信息, 就可以畅通无阻地登录FTP服务器, 从而完全控制整台服务器.</p>
<p>虚拟用户模式: 是这三种模式中最安全的一种认证模式, 它需要为FTP服务单独建立用户数据库文件, 虚拟出用来进行口令验证的账户信息, 而这些账户信息在服务器系统中实际上是不存在的, 仅供FTP服务程序进行认证使用.</p>
<p>ftp是Linux系统中以命令行界面的方式来管理FTP传输服务的客户端工具, 手动安装ftp客户端工具.<br><code>yum install ftp</code></p>
<h3 id="匿名访问模式"><a href="#匿名访问模式" class="headerlink" title="匿名访问模式"></a>匿名访问模式</h3><p>这种模式一般用来访问不重要的公开文件(在生产环境中尽量不要存放重要文件)</p>
<p>vsftpd服务程序默认开启了匿名开放模式, 我们需要做的就是开放匿名用户的上传、下载文件的权限, 以及让匿名用户创建、删除、更名文件的权限. 需要注意的是, 不建议在生产环境中如此行事.</p>
<table>
可以向匿名用户开放的权限参数以及作用
<tr><td>anonymous_enable=YES</td><td>允许匿名访问模式</td></tr>
<tr><td>anon_umask=022</td><td>匿名用户上传文件的umask值</td></tr>
<tr><td>anon_upload_enable=YES</td><td>允许匿名用户上传文件</td></tr>
<tr><td>anon_mkdir_write_enable=YES</td><td>允许匿名用户创建目录</td></tr>
<tr><td>anon_other_write_enable=YES</td><td>允许匿名用户修改目录名称或删除目录</td></tr>
</table>
<pre>
 vim /etc/vsftpd/vsftpd.conf
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">anonymous_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">anon_umask</span>=<span class="number">022</span></span><br><span class="line"><span class="attr">anon_upload_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">anon_mkdir_write_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">anon_other_write_enable</span>=<span class="literal">YES</span></span><br></pre></td></tr></table></figure>
 systemctl restart vsftpd
 systemctl enable vsftpd
</pre>

<p>在vsftpd服务程序的匿名开放认证模式下, 默认访问的是/var/ftp目录. 查看该目录的权限得知, 只有root管理员才有写入权限. 将目录的所有者身份改成系统账户ftp(该账户在系统中已经存在).</p>
<pre>
 ls -ld /var/ftp/pub
 chown -Rf ftp /var/ftp/pub
</pre>

<p>使用getsebool命令查看与FTP相关的SELinux域策略</p>
<pre>
 getsebool -a | grep ftp
 ftpd_full_access --> off
</pre>

<p>修改策略规则, 并且在设置时使用-P参数让修改过的策略永久生效.<br><code>setsebool -P ftpd_full_access=on</code></p>
<p>在客户端执行ftp命令连接到远程的FTP服务器, 在vsftpd服务程序的匿名开放认证模式下, 其账户统一为anonymous, 密码为空. 而且在连接到FTP服务器后, 默认访问的是/var/ftp目录.</p>
<pre>
 Linux:
 ftp ip地址
 输入匿名账户名:anonymous
 按回车键

 Windows:
 Win + R
 ftp://ip地址
</pre>

<h3 id="本地用户模式"><a href="#本地用户模式" class="headerlink" title="本地用户模式"></a>本地用户模式</h3><p>相较于匿名开放模式, 本地用户模式要更安全, 而且配置起来也很简单.</p>
<table>
本地用户模式使用的权限参数以及作用
<tr><td>anonymous_enable=NO</td><td>禁止匿名访问模式</td></tr>
<tr><td>local_enable=YES</td><td>允许本地用户模式</td></tr>
<tr><td>write_enable=YES</td><td>设置可写权限</td></tr>
<tr><td>local_umask=022</td><td>本地用户模式创建文件的umask值</td></tr>
<tr><td>userlist_deny=YES</td><td>启用"禁止用户名单", 名单文件为ftpusers和user_list.</td></tr>
<tr><td>userlist_enable=YES</td><td>开启用户作用名单文件功能</td></tr>
</table>
<pre>
 vim /etc/vsftpd/vsftpd.conf
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">anonymous_enable</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">local_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">write_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">local_umask</span>=<span class="number">022</span></span><br></pre></td></tr></table></figure>
 systemctl restart vsftpd
 systemctl enable vsftpd
</pre>

<p>使用getsebool命令查看与FTP相关的SELinux域策略</p>
<pre>
 getsebool -a | grep ftp
 ftpd_full_access --> off
</pre>

<p>修改策略规则, 并且在设置时使用-P参数让修改过的策略永久生效.<br><code>setsebool -P ftpd_full_access=on</code></p>
<p>选择ftpusers和user_list文件中没有的一个普通用户尝试登录FTP服务器, 在采用本地用户模式登录FTP服务器后, 默认访问的是该用户的家目录, 也就是说, 访问的是/home/当前用户名目录. 而且该目录的默认所有者、所属组都是该用户自己, 因此不存在写入权限不足的情况.</p>
<pre>
 cat /etc/vsftpd/user_list
 cat /etc/vsftpd/ftpusers

 Linux:
 ftp 192.168.10.10
 输入用户名
 输入该用户名的密码

 Windons:
 Win + R
 ftp://ip地址
 输入用户名
 输入该用户名的密码
</pre>

<h3 id="虚拟用户模式"><a href="#虚拟用户模式" class="headerlink" title="虚拟用户模式"></a>虚拟用户模式</h3><p>虚拟用户模式是这三种模式中最安全的一种认证模式, 因为安全性较之于前面两种模式有了提升, 所以配置流程也会稍微复杂一些.</p>
<p>第1步: 创建用于进行FTP认证的用户数据库文件, 其中奇数行为账户名, 偶数行为密码.<br>例: 分别创建出zhangsan和lisi两个用户, 密码均为redhat:</p>
<pre>
 cd /etc/vsftpd/

 vim vuser.list
 <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">zhangsan</span></span><br><span class="line"><span class="attribute">redhat</span></span><br><span class="line"><span class="attribute">lisi</span></span><br><span class="line"><span class="attribute">redhat</span></span><br></pre></td></tr></table></figure>
</pre>

<p>使用db_load命令用哈希(hash)算法将原始的明文信息文件转换成数据库文件, 并且降低数据库文件的权限(避免其他人看到数据库文件的内容), 然后再把原始的明文信息文件删除.</p>
<pre>
 db_load -T -t hash -f vuser.list vuser.db
 file vuser.db
 chmod 600 vuser.db
 rm -f vuser.list
</pre>

<p>第2步: 创建vsftpd服务程序用于存储文件的根目录以及虚拟用户映射的系统本地用户. FTP服务用于存储文件的根目录指的是, 当虚拟用户登录后所访问的默认位置.</p>
<pre>
 useradd -d /var/ftproot -s /sbin/nologin virtual
 ls -ld /var/ftproot/
 chmod -Rf 755 /var/ftproot/
</pre>

<p>PAM(可插拔认证模块)是一种认证机制, 通过一些动态链接库和统一的API把系统提供的服务与认证方式分开, 使得系统管理员可以根据需求灵活调整服务程序的不同认证方式. 通俗来讲, PAM是一组安全机制的模块, 系统管理员可以用来轻易地调整服务程序的认证方式, 而不必对应用程序进行任何修改. PAM采取了分层设计的思想:<br><img src="/post/cea46563/PAM%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E7%9A%84%E4%BD%93%E7%B3%BB%E5%9B%BE.jpg" alt="PAM认证机制的体系图"></p>
<p>第3步: 新建一个用于虚拟用户认证的PAM文件vsftpd.vu, 其中PAM文件内的”db=”参数为使用db_load命令生成的账户密码数据库文件的路径, 但不用写数据库文件的后缀:</p>
<pre>
 vim /etc/pam.d/vsftpd.vu
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auth       required     pam_userdb.so <span class="attribute">db</span>=/etc/vsftpd/vuser</span><br><span class="line">account    required     pam_userdb.so <span class="attribute">db</span>=/etc/vsftpd/vuser</span><br></pre></td></tr></table></figure>
</pre>

<p>第4步: 在vsftpd服务程序的主配置文件中通过pam_service_name参数将PAM认证文件的名称修改为vsftpd.vu, PAM作为应用程序层与鉴别模块层的连接纽带, 可以让应用程序根据需求灵活地在自身插入所需的鉴别功能模块. 当应用程序需要PAM认证时, 则需要在应用程序中定义负责认证的PAM配置文件, 实现所需的认证功能.</p>
<table>
利用PAM文件进行认证时使用的参数以及作用
<tr><td>anonymous_enable=NO</td><td>禁止匿名开放模式</td></tr>
<tr><td>local_enable=YES</td><td>允许本地用户模式</td></tr>
<tr><td>guest_enable=YES</td><td>开启虚拟用户模式</td></tr>
<tr><td>guest_username=virtual</td><td>指定虚拟用户账户</td></tr>
<tr><td>pam_service_name=vsftpd.vu</td><td>指定PAM文件</td></tr>
<tr><td>allow_writeable_chroot=YES</td><td>允许对禁锢的FTP根目录执行写入操作, 而且不拒绝用户的登录请求.</td></tr>
</table>
<pre>
 vim /etc/vsftpd/vsftpd.conf
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">anonymous_enable</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">local_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">guest_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">guest_username</span>=virtual</span><br><span class="line"><span class="attr">allow_writeable_chroot</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">pam_service_name</span>=vsftpd.vu</span><br></pre></td></tr></table></figure>
</pre>

<p>第5步: 为虚拟用户设置不同的权限</p>
<pre>
 mkdir /etc/vsftpd/vusers_dir/
 cd /etc/vsftpd/vusers_dir/
 touch lisi
 vim zhangsan
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">anon_upload_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">anon_mkdir_write_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">anon_other_write_enable</span>=<span class="literal">YES</span></span><br></pre></td></tr></table></figure>
</pre>

<p>然后再次修改vsftpd主配置文件, 通过添加user_config_dir参数来定义这两个虚拟用户不同权限的配置文件所存放的路径. 为了让修改后的参数立即生效, 需要重启vsftpd服务程序并将该服务添加到开机启动项中:</p>
<pre>
 vim /etc/vsftpd/vsftpd.conf
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user_config_dir</span>=/etc/vsftpd/vusers_dir</span><br></pre></td></tr></table></figure>
 systemctl restart vsftpd
 systemctl enable vsftpd
</pre>

<p>第6步: 设置SELinux域允许策略, 然后使用虚拟用户模式登录FTP服务器.</p>
<pre>
 getsebool -a | grep ftp
 ftpd_full_access --> off
 setsebool -P ftpd_full_access=on
</pre>

<p>使用虚拟用户模式成功登录到FTP服务器</p>
<pre>
 Linux:
 ftp 192.168.10.10
 输入虚拟用户名
 输入该虚拟用户名的密码

 Windons:
 Win + R
 ftp://ip地址
 输入虚拟用户名
 输入该虚拟用户名的密码
</pre>

<h2 id="TFTP简单文件传输协议"><a href="#TFTP简单文件传输协议" class="headerlink" title="TFTP简单文件传输协议"></a>TFTP简单文件传输协议</h2><p>简单文件传输协议(Trivial File Transfer Protocol, TFTP)是一种基于UDP协议在客户端和服务器之间进行简单文件传输的协议.</p>
<p>TFTP在传输文件时采用的是UDP协议, 占用的端口号为69, 因此文件的传输过程也不像FTP协议那样可靠. 但是, 因为TFTP不需要客户端的权限认证, 也就减少了无谓的系统和网络带宽消耗, 因此在传输琐碎(trivial)不大的文件时, 效率更高.</p>
<p>安装TFTP的软件包</p>
<pre>
 yum install tftp-server tftp
</pre>

<p>TFTP服务是使用xinetd服务程序来管理的. xinetd服务可以用来管理多种轻量级的网络服务, 而且具有强大的日志功能. 简单来说, 在安装TFTP软件包后, 还需要在xinetd服务程序中将其开启, 把默认的禁用(disable)参数修改为no.</p>
<pre>
 vim /etc/xinetd.d/tftp
 disable                 = no
</pre>

<p>重启xinetd服务并将它添加到系统的开机启动项中, 以确保TFTP服务在系统重启后依然处于运行状态. 考虑到有些系统的防火墙默认没有允许UDP协议的69端口, 因此需要手动将该端口号加入到防火墙的允许策略中:</p>
<pre>
 systemctl restart xinetd
 systemctl enable xinetd

 firewall-cmd --permanent --add-port=69/udp
 firewall-cmd --reload 
</pre>
<p>提示: Failed to restart xinetd时, 安装xinetd包.</p>
<pre>
 yum -y install xinetd
</pre>

<table>
TFTP的根目录为/var/lib/tftpboot, tftp命令中可用的参数以及作用:
<tr><td>命令</td><td>作用</td></tr>
<tr><td>?</td><td>帮助信息</td></tr>
<tr><td>put</td><td>上传文件</td></tr>
<tr><td>get</td><td>下载文件</td></tr>
<tr><td>verbose</td><td>显示详细的处理信息</td></tr>
<tr><td>status</td><td>显示当前的状态信息</td></tr>
<tr><td>binary</td><td>使用二进制进行传输</td></tr>
<tr><td>ascii</td><td>使用ASCII码进行传输</td></tr>
<tr><td>timeout</td><td>设置重传的超时时间</td></tr>
<tr><td>quit</td><td>退出</td></tr>
</table>
<pre>
 echo "i love linux" > /var/lib/tftpboot/readme.txt
 tftp 192.168.10.10
 tftp> get readme.txt
 tftp> quit
 ls
 cat readme.txt 
</pre>

<h1 id="使用Samba或NFS实现文件共享"><a href="#使用Samba或NFS实现文件共享" class="headerlink" title="使用Samba或NFS实现文件共享"></a>使用Samba或NFS实现文件共享</h1><h2 id="SAMBA文件共享服务"><a href="#SAMBA文件共享服务" class="headerlink" title="SAMBA文件共享服务"></a>SAMBA文件共享服务</h2><p>SMBServer服务程序基于SMB(Server Messages Block, 服务器消息块)协议. 是一款开源的文件共享软件, 经过简单配置就能够实现Linux系统与Windows系统之间的文件共享工作, Samba服务程序现在已经成为在Linux系统与Windows系统之间共享文件的最佳选择.</p>
<p>首先通过Yum软件仓库来安装Samba服务程序<br><code>yum install samba</code></p>
<p>备份主配置文件, 然后过滤注释行重定向至原主配置文件, 最后用cat命令进行查看.</p>
<pre>
 mv /etc/samba/smb.conf /etc/samba/smb.conf.bak
 cat /etc/samba/smb.conf.bak | grep -v "#" | grep -v ";" | grep -v "^$" > /etc/samba/smb.conf
 cat /etc/samba/smb.conf
</pre>
<table style="text-align:center;">
Samba服务程序中的参数以及作用
<tr><td>[global]</td><td></td><td>#全局参数</td></tr>
<tr><td></td><td>workgroup = MYGROUP</td><td>#工作组名称</td></tr>
<tr><td></td><td>server string = Samba Server Version %v</td><td>#服务器介绍信息,参数%v为显示SMB版本号</td></tr>
<tr><td></td><td>log file = /var/log/samba/log.%m</td><td>#定义日志文件的存放位置与名称, 参数%m为来访的主机名</td></tr>
<tr><td></td><td>max log size = 50</td><td>#定义日志文件的最大容量为50KB</td></tr>
<tr><td></td><td>security = user</td><td>#安全验证的方式, 总共有4种.</td></tr>
<tr><td></td><td>#share:</td><td>来访主机无需验证口令; 比较方便, 但安全性很差.</td></tr>
<tr><td></td><td>#user:</td><td>需验证来访主机提供的口令后才可以访问; 提升了安全性.</td></tr>
<tr><td></td><td>#server:</td><td>使用独立的远程主机验证来访主机提供的口令(集中管理账户)</td></tr>
<tr><td></td><td>#domain:</td><td>使用域控制器进行身份验证</td></tr>
<tr><td></td><td>passdb backend = tdbsam</td><td>#定义用户后台的类型, 共有3种.</td></tr>
<tr><td></td><td>#smbpasswd:</td><td>使用smbpasswd命令为系统用户设置Samba服务程序的密码</td></tr>
<tr><td></td><td>#tdbsam:</td><td>创建数据库文件并使用pdbedit命令建立Samba服务程序的用户</td></tr>
<tr><td></td><td>#ldapsam:</td><td>基于LDAP服务进行账户验证</td></tr>
<tr><td></td><td>load printers = yes</td><td>#设置在Samba服务启动时是否共享打印机设备</td></tr>
<tr><td></td><td>cups options = raw</td><td>#打印机的选项</td></tr>
<tr><td>[homes]</td><td></td>#共享参数</tr>
<tr><td></td><td>comment = Home Directories</td><td>#描述信息</td></tr>
<tr><td></td><td>browseable = no</td><td>#指定共享信息是否在"网上邻居"中可见</td></tr>
<tr><td></td><td>writable = yes</td><td>#定义是否可以执行写入操作, 与"read only"相反.</td></tr>
<tr><td>[printers]</td><td></td>#打印机共享参数</tr>
<tr><td></td><td>comment = All Printers</td><td></td></tr>
<tr><td></td><td>path = /var/spool/samba</td><td>#共享文件的实际路径(重要)</td></tr>
<tr><td></td><td>browseable = no</td><td></td></tr>
<tr><td></td><td>guest ok = no</td><td>#是否所有人可见, 等同于"public"参数.</td></tr>
<tr><td></td><td>writable = no</td><td></td></tr>
<tr><td></td><td>printable = yes</td><td></td></tr>
</table>

<h3 id="配置共享资源"><a href="#配置共享资源" class="headerlink" title="配置共享资源"></a>配置共享资源</h3><p>Samba服务程序的主配置文件包括全局配置参数和区域配置参数.<br>全局配置参数用于设置整体的资源共享环境, 对里面的每一个独立的共享资源都有效.<br>区域配置参数则用于设置单独的共享资源, 且仅对该资源有效.<br>创建共享资源指定的参数写入到Samba服务程序的主配置文件中, 然后重启该服务即可.</p>
<table>
用于设置Samba服务程序的参数以及作用
<tr><td>[database]</td><td>共享名称为database</td></tr>
<tr><td>comment = Do not arbitrarily modify the database file</td><td>警告用户不要随意修改数据库</td></tr>
<tr><td>path = /home/database</td><td>共享目录为/home/database</td></tr>
<tr><td>public = no</td><td>关闭"所有人可见"</td></tr>
<tr><td>writable = yes</td><td>允许写入操作</td></tr>
</table>

<p>第1步:创建用于访问共享资源的账户信息</p>
<pre>
 id linuxprobe
 pdbedit -a -u linuxprobe
 输入该账户在Samba服务数据库中的密码
 再次输入密码进行确认
</pre>

<p>用户口令认证模式(user). 这种认证模式可以确保仅让有密码且受信任的用户访问共享资源, 而且验证过程也十分简单. 不过, 只有建立账户信息数据库之后, 才能使用用户口令认证模式.</p>
<p>另外, Samba服务程序的数据库要求账户必须在当前系统中已经存在, 否则日后创建文件时将导致文件的权限属性混乱不堪, 由此引发错误.</p>
<p>pdbedit命令用于管理SMB服务程序的账户信息数据库, 格式为<code>pdbedit [选项] 账户</code>. 在第一次把账户信息写入到数据库时需要使用-a参数.</p>
<table>
用于pdbedit命令的参数以及作用
<tr><td>-a 用户名</td><td>建立Samba用户</td></tr>
<tr><td>-x 用户名</td><td>删除Samba用户</td></tr>
<tr><td>-L</td><td>列出用户列表</td></tr>
<tr><td>-Lv</td><td>列出用户详细信息的列表</td></tr>
</table>

<p>第2步:创建用于共享资源的文件目录在创建时, 不仅要考虑到文件读写权限的问题, 而且由于/home目录是系统中普通用户的家目录, 因此还需要考虑应用于该目录的SELinux安全上下文所带来的限制.</p>
<pre>
 mkdir /home/database
 chown -Rf linuxprobe:linuxprobe /home/database
 semanage fcontext -a -t samba_share_t /home/database
 restorecon -Rv /home/database
</pre>

<p>第3步:设置SELinux服务与策略, 使其允许通过Samba服务程序访问普通用户家目录. 执行getsebool命令, 筛选出所有与Samba服务程序相关的SELinux域策略, 根据策略的名称选择出正确的策略条目进行开启即可.</p>
<pre>
 getsebool -a | grep samba
 samba_enable_home_dirs --> off

 setsebool -P samba_enable_home_dirs on
</pre>

<p>第4步:在Samba服务程序的主配置文件中, 根据指定格式写入共享信息. 在原始的配置文件中, [homes]参数为来访用户的家目录共享信息, [printers]参数为共享的打印机设备. 这两项如果不需要可以删除.</p>
<pre>
 vim /etc/samba/smb.conf 
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">  workgroup = MYGROUP</span><br><span class="line"> <span class="built_in"> server </span>string = Samba<span class="built_in"> Server </span>Version %v</span><br><span class="line">  log file = /var/log/samba/log.%m</span><br><span class="line">  max log size = 50</span><br><span class="line">  security = user</span><br><span class="line">  passdb backend = tdbsam</span><br><span class="line">  load printers = <span class="literal">yes</span></span><br><span class="line">  cups options = raw</span><br><span class="line">[database]</span><br><span class="line">  comment = <span class="keyword">Do</span> <span class="keyword">not</span> arbitrarily modify the database file</span><br><span class="line">  path = /home/database</span><br><span class="line">  public = <span class="literal">no</span></span><br><span class="line">  writable = <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
</pre>

<p>第5步:重启smb服务(Samba服务程序在Linux系统中的名字为smb)并清空iptables防火墙, 然后就检验配置效果.</p>
<pre>
 systemctl restart smb
 systemctl enable smb
 iptables -F
 service iptables save
</pre>

<table>
Samba服务器和Windows客户端使用的操作系统以及IP地址
<tr><td>主机名称</td><td>操作系统</td><td>IP地址</td></tr>
<tr><td>Samba共享服务器</td><td>RHEL 7</td><td>192.168.10.10</td></tr>
<tr><td>Linux客户端</td><td>RHEL 7</td><td>192.168.10.20</td></tr>
<tr><td>Windows客户端</td><td>Windows 7</td><td>192.168.10.30</td></tr>
</table>

<h3 id="Windows挂载共享"><a href="#Windows挂载共享" class="headerlink" title="Windows挂载共享"></a>Windows挂载共享</h3><p>在Windons系统中, 按<code>Win + R</code>后输入ip地址回车后输入用户名和密码进行访问.</p>
<pre>
 Win + R
 \\ip地址
 输入用户名
 输入密码
</pre>

<h3 id="Linux挂载共享"><a href="#Linux挂载共享" class="headerlink" title="Linux挂载共享"></a>Linux挂载共享</h3><p>Samba服务程序还可以实现Linux系统之间的文件共享, 在客户端安装支持文件共享服务的软件包(cifs-utils).<br><code>yum install cifs-utils</code></p>
<p>在Linux客户端, 按照Samba服务的用户名、密码、共享域的顺序将相关信息写入到一个认证文件中. 为了保证不被其他人随意看到, 最后把这个认证文件的权限修改为仅root管理员才能够读写:</p>
<pre>
 vim auth.smb
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span>=linuxprobe</span><br><span class="line"><span class="attr">password</span>=redhat</span><br><span class="line"><span class="attr">domain</span>=MYGROUP</span><br></pre></td></tr></table></figure>
 chmod -Rf 600 auth.smb
</pre>

<p>在Linux客户端上创建一个用于挂载Samba服务共享资源的目录, 并把挂载信息写入到/etc/fstab文件中, 以确保共享挂载信息在服务器重启后依然生效:</p>
<pre>
 mkdir /database
 echo "//ip地址/database /database cifs credentials=/root/auth.smb 0 0" >> /etc/fstab
 mount -a

 CentOS挂载:
 mount -t cifs -o username=linuxprobe,password=linux,sec=ntlmssp //ip地址/database /database
</pre>

<p>访问共享资源<br><code>ls /database/</code></p>
<h2 id="NFS网络文件系统"><a href="#NFS网络文件系统" class="headerlink" title="NFS网络文件系统"></a>NFS网络文件系统</h2><p>需要共享文件的主机都是Linux系统的话可以在客户端部署NFS服务来共享文件. NFS(网络文件系统)服务可以将远程Linux系统上的文件共享资源挂载到本地主机的目录上, 从而使得本地主机(Linux客户端)基于TCP/IP协议, 像使用本地主机上的资源那样读写远程Linux系统上的共享文件.</p>
<p>使用Yum软件仓库安装NFS软件包<br><code>yum install nfs-utils</code></p>
<p>第1步:为了检验NFS服务配置的效果, 我们需要使用两台Linux主机(一台充当NFS服务器, 一台充当NFS客户端).</p>
<table>
 两台Linux主机所使用的操作系统以及IP地址
<tr><td>主机名称</td><td>操作系统</td><td>IP地址</td></tr>
<tr><td>NFS服务端</td><td>RHEL 7</td><td>192.168.10.10</td></tr>
<tr><td>NFS客户端</td><td>RHEL 7</td><td>192.168.10.20</td></tr>
</table>

<p>第2步:在NFS服务器上建立用于NFS文件共享的目录, 并设置足够的权限确保其他人也有写入权限.</p>
<pre>
 mkdir /nfsfile
 chmod -Rf 777 /nfsfile
 echo "welcome to linuxprobe.com" > /nfsfile/readme
</pre>

<p>第3步:NFS服务程序的配置文件为/etc/exports, 默认情况下里面没有任何内容. 我们可以按照”共享目录的路径 允许访问的NFS客户端(共享权限参数)”的格式, 定义要共享的目录与相应的权限.</p>
<p>如果想要把/nfsfile目录共享给192.168.10.0/24网段内的所有主机, 让这些主机都拥有读写权限, 在将数据写入到NFS服务器的硬盘中后才会结束操作, 最大限度保证数据不丢失, 以及把来访客户端root管理员映射为本地的匿名用户等, 则可以按照下面命令中的格式:</p>
<pre>
 vim /etc/exports
 <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/nfsfile <span class="number">192.168</span><span class="number">.10</span>.*(rw,sync,root_squash)</span><br></pre></td></tr></table></figure>
</pre>

<table>
用于配置NFS服务程序配置文件的参数
<tr><td>参数</td><td>作用</td></tr>
<tr><td>ro</td><td>只读</td></tr>
<tr><td>rw</td><td>读写</td></tr>
<tr><td>root_squash</td><td>当NFS客户端以root管理员访问时, 映射为NFS服务器的匿名用户.</td></tr>
<tr><td>no_root_squash</td><td>当NFS客户端以root管理员访问时, 映射为NFS服务器的root管理员.</td></tr>
<tr><td>all_squash</td><td>无论NFS客户端使用什么账户访问, 均映射为NFS服务器的匿名用户.</td></tr>
<tr><td>sync</td><td>同时将数据写入到内存与硬盘中, 保证不丢失数据.</td></tr>
<tr><td>async</td><td>优先将数据保存到内存, 然后再写入硬盘; 这样效率更高, 但可能会丢失数据.</td></tr>
</table>

<p>第4步:启动和启用NFS服务程序. 由于在使用NFS服务进行文件共享之前, 需要使用RPC(Remote Procedure Call, 远程过程调用)服务将NFS服务器的IP地址和端口号等信息发送给客户端. 因此, 在启动NFS服务之前, 还需要顺带重启并启用rpcbind服务程序, 并将这两个服务一并加入开机启动项中.</p>
<pre>
 systemctl restart rpcbind
 systemctl enable rpcbind
 systemctl start nfs-server
 systemctl enable nfs-server
</pre>

<p>使用showmount命令查询NFS服务器的远程共享信息, 其输出格式为”共享的目录名称 允许使用客户端地址”.</p>
<pre>
 showmount -e 192.168.10.10

 Export list for 192.168.10.10:
 /nfsfile 192.168.10.*
</pre>
<table>
showmount命令中可用的参数以及作用
<tr><td>参数</td><td>作用</td></tr>
<tr><td>-e</td><td>显示NFS服务器的共享列表</td></tr>
<tr><td>-a</td><td>显示本机挂载的文件资源的情况NFS资源的情况</td></tr>
<tr><td>-v</td><td>显示版本号</td></tr>
</table>

<p>在NFS客户端创建一个挂载目录, 永久挂载写入fstab文件中.</p>
<pre>
 mkdir /nfsfile
 mount -t nfs 192.168.10.10:/nfsfile /nfsfile
 echo "192.168.10.10:/nfsfile /nfsfile nfs defaults 0 0" >> /etc/fstab
 cat /nfsfile/readme
</pre>

<h2 id="AutoFs自动挂载服务"><a href="#AutoFs自动挂载服务" class="headerlink" title="AutoFs自动挂载服务"></a>AutoFs自动挂载服务</h2><p>autofs服务程序是一种Linux系统守护进程, 当检测到用户试图访问一个尚未挂载的文件系统时, 将自动挂载该文件系统.</p>
<p>使用Yum软件仓库安装autofs服务程序<br><code>yum install autofs</code></p>
<p>在autofs服务程序的主配置文件中需要按照”挂载目录 子配置文件”的格式进行填写, 挂载目录是设备挂载位置的上一级目录. 对应的子配置文件则是对这个挂载目录内的挂载设备信息作进一步的说明. 子配置文件需要用户自行定义, 文件名字没有严格要求, 但后缀建议以.misc结束.<br>例: 光盘设备一般挂载到/media/cdrom目录中, 那么挂载目录写成/media即可.</p>
<pre>
 vim /etc/auto.master
 <figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/media</span>  <span class="string">/etc/iso.misc</span></span><br></pre></td></tr></table></figure>
</pre>

<p>在子配置文件中, 应按照”挂载目录 挂载文件类型及权限 :设备名称”的格式进行填写. 配置完成后再顺手将autofs服务程序启动并加入到系统启动项中:</p>
<pre>
 vim /etc/iso.misc
 <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iso   -fstype=iso9660,ro,nosuid,nodev <span class="symbol">:/dev/cdrom</span></span><br></pre></td></tr></table></figure>
 systemctl start autofs 
 systemctl enable autofs 
</pre>

<p>查看当前的光盘设备挂载情况, 确认光盘设备没有被挂载上. 使用cd命令切换到这个iso子目录中, 而且光盘设备会被立即自动挂载.</p>
<pre>
 df -h

 cd /media/iso
 df -h
</pre>

<h1 id="使用Bind提供域名解析服务"><a href="#使用Bind提供域名解析服务" class="headerlink" title="使用Bind提供域名解析服务"></a>使用Bind提供域名解析服务</h1><h2 id="DNS域名解析服务"><a href="#DNS域名解析服务" class="headerlink" title="DNS域名解析服务"></a>DNS域名解析服务</h2><p>为了降低用户访问网络资源的门槛, DNS(Domain Name System, 域名系统)技术是一项用于管理和解析域名与IP地址对应关系的技术.</p>
<p>简单来说, 就是能够接受用户输入的域名或IP地址, 然后自动查找与之匹配(或者说具有映射关系)的IP地址或域名, 即将域名解析为IP地址(正向解析), 或将IP地址解析为域名(反向解析).</p>
<p>DNS域名解析技术的正向解析也是我们最常使用的一种工作模式</p>
<p>鉴于互联网中的域名和IP地址对应关系数据库太过庞大, DNS域名解析服务采用了类似目录树的层次结构来记录域名与IP地址之间的对应关系, 从而形成了一个分布式的数据库系统.</p>
<p><img src="/post/cea46563/DNS%E7%BB%93%E6%9E%84%E6%A8%A1%E5%9E%8B.jpg" alt="DNS结构模型"></p>
<p>域名后缀一般分为国际域名和国内域名. 原则上来讲, 域名后缀都有严格的定义, 但在实际使用时可以不必严格遵守. </p>
<table>
目前最常见的域名后缀:
<tr><td>.com(商业组织)</td></tr>
<tr><td>.org(非营利组织)</td></tr>
<tr><td>.gov(政府部门)</td></tr>
<tr><td>.net(网络服务商)</td></tr>
<tr><td>.edu(教研机构)</td></tr>
<tr><td>.pub(公共大众)</td></tr>
<tr><td>.cn(中国国家顶级域名)</td></tr>
</table>

<p>DNS技术作为互联网基础设施中重要的一环, 为了为网民提供不间断、稳定且快速的域名查询服务, 保证互联网的正常运转, 提供了下面三种类型的服务器:</p>
<pre>
 主服务器: 在特定区域内具有唯一性, 负责维护该区域内的域名与IP地址之间的对应关系.
 从服务器: 从主服务器中获得域名与IP地址的对应关系并进行维护, 以防主服务器宕机等情况.
 缓存服务器: 通过向其他域名解析服务器查询获得域名与IP地址的对应关系, 并将经常查询的域名信息保存到服务器本地, 以此来提高重复查询时的效率.
</pre>

<p>在执行用户发起的域名查询请求时, 具有递归查询和迭代查询两种方式. </p>
<p>递归查询是指DNS服务器在收到用户发起的请求时, 必须向用户返回一个准确的查询结果. 如果DNS服务器本地没有存储与之对应的信息, 则该服务器需要询问其他服务器, 并将返回的查询结果提交给用户. </p>
<p>迭代查询则是指DNS服务器在收到用户发起的请求时, 并不直接回复查询结果, 而是告诉另一台DNS服务器的地址, 用户再向这台DNS服务器提交请求, 这样依次反复, 直到返回查询结果.</p>
<p>向DNS服务器发起域名查询请求的流程:<br><img src="/post/cea46563/DNS%E6%9F%A5%E8%AF%A2%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg" alt="DNS查询流程图"></p>
<table>
13台根DNS服务器的具体信息
<tr><td>名称</td><td>管理单位</td><td>地理位置</td><td>IP地址</td></tr>
<tr><td>A</td><td>INTERNIC.NET</td><td>美国-弗吉尼亚州</td><td>198.41.0.4</td></tr>
<tr><td>B</td><td>美国信息科学研究所</td><td>美国-加利弗尼亚州</td><td>128.9.0.107</td></tr>
<tr><td>C</td><td>PSINet公司</td><td>美国-弗吉尼亚州</td><td>192.33.4.12</td></tr>
<tr><td>D</td><td>马里兰大学</td><td>美国-马里兰州</td><td>128.8.10.90</td></tr>
<tr><td>E</td><td>美国航空航天管理局</td><td>美国加利弗尼亚州</td><td>192.203.230.10</td></tr>
<tr><td>F</td><td>因特网软件联盟</td><td>美国加利弗尼亚州</td><td>192.5.5.241</td></tr>
<tr><td>G</td><td>美国国防部网络信息中心</td><td>美国弗吉尼亚州</td><td>192.112.36.4</td></tr>
<tr><td>H</td><td>美国陆军研究所</td><td>美国-马里兰州</td><td>128.63.2.53</td></tr>
<tr><td>I</td><td>Autonomica公司</td><td>瑞典-斯德哥尔摩</td><td>192.36.148.17</td></tr>
<tr><td>J</td><td>VeriSign公司</td><td>美国-弗吉尼亚州</td><td>192.58.128.30</td></tr>
<tr><td>K</td><td>RIPE NCC</td><td>英国-伦敦</td><td>193.0.14.129</td></tr>
<tr><td>L</td><td>IANA</td><td>美国-弗吉尼亚州</td><td>199.7.83.42</td></tr>
<tr><td>M</td><td>WIDE Project</td><td>日本-东京</td><td>202.12.27.33</td></tr>
</table>

<h2 id="安装Bind服务程序"><a href="#安装Bind服务程序" class="headerlink" title="安装Bind服务程序"></a>安装Bind服务程序</h2><p>BIND(Berkeley Internet Name Domain, 伯克利因特网名称域)服务是全球范围内使用最广泛、最安全可靠且高效的域名解析服务程序. DNS域名解析服务作为互联网基础设施服务, 建议在生产环境中安装部署bind服务程序时加上chroot(俗称牢笼机制)扩展包, 以便有效地限制bind服务程序仅能对自身的配置文件进行操作, 以确保整个服务器的安全.<br><code>yum install bind-chroot</code></p>
<p>在bind服务程序中有下面这三个比较关键的文件:</p>
<pre>
 主配置文件(/etc/named.conf): 只有58行, 而且在去除注释信息和空行之后, 实际有效的参数仅有30行左右, 这些参数用来定义bind服务程序的运行.
 区域配置文件(/etc/named.rfc1912.zones): 用来保存域名和IP地址对应关系的所在位置. 类似于图书的目录, 对应着每个域和相应IP地址所在的具体位置, 当需要查看或修改时, 可根据这个位置找到相关文件.
 数据配置文件目录(/var/named): 该目录用来保存域名和IP地址真实对应关系的数据配置文件.
</pre>

<p>在Linux系统中, bind服务程序的名称为named. 首先需要在/etc目录中找到该服务程序的主配置文件, 然后把第11行和第17行的地址均修改为any, 分别表示服务器上的所有IP地址均可提供DNS域名解析服务, 以及允许所有人对本服务器发送DNS查询请求. 这两个地方一定要修改准确.</p>
<pre>
 vim /etc/named.conf
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">listen-on<span class="built_in"> port </span>53 &#123; any; &#125;;</span><br><span class="line">allow-query &#123; any; &#125;;</span><br></pre></td></tr></table></figure>
</pre>

<p>bind服务程序的区域配置文件(/etc/named.rfc1912.zones)用来保存域名和IP地址对应关系的所在位置. 在这个文件中, 定义了域名与IP地址解析规则保存的文件位置以及服务类型等内容, 而没有包含具体的域名、IP地址对应关系等信息.<br>服务类型有三种: hint(根区域)、master(主区域)、slave(辅助区域).<br>常用的master和slave指的就是主服务器和从服务器.</p>
<p>正向解析参数:</p>
<pre>
 zone "linuxprobe.com" IN {
   type master; #服务类型
   file "linuxprobe.com.zone"; #域名与IP地址解析规则保存的文件位置
   allow-update { none; }; #允许那些客户机动态更新解析信息
 };
</pre>

<p>反向解析参数</p>
<pre>
 zone "10.168.192.in-addr.arpa" IN { #表示为192.168.10.0/24网段的反向解析区域
   type master;
   file "192.168.10.arpa";
 };
</pre>

<h2 id="正向解析实验"><a href="#正向解析实验" class="headerlink" title="正向解析实验"></a>正向解析实验</h2><p>在DNS域名解析服务中, 正向解析是指根据域名(主机名)查找到对应的IP地址.</p>
<p>第1步: 编辑区域配置文件</p>
<pre>
 vim /etc/named.rfc1912.zones
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"linuxprobe.com"</span> <span class="keyword">IN</span> &#123;</span><br><span class="line"> <span class="built_in"> type </span>master;</span><br><span class="line">  file <span class="string">"linuxprobe.com.zone"</span>;</span><br><span class="line">  allow-update &#123;none;&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</pre>

<p>第2步: 编辑数据配置文件<br>从/var/named目录中复制一份正向解析的模板文件(named.localhost), 然后把域名和IP地址的对应数据填写数据配置文件中并保存.<br>复制时加-a参数, 可以保留原始文件的所有者、所属组、权限属性等信息.</p>
<pre>
 cd /var/named/
 ls -al named.localhost
 cp -a named.localhost linuxprobe.com.zone

 vim linuxprobe.com.zone
 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$TTL</span> <span class="string">1D</span>	<span class="comment">#生存周期为1天				</span></span><br><span class="line"><span class="string">@</span>    <span class="string">IN</span> <span class="string">SOA</span>           <span class="string">linuxprobe.com.</span>	  <span class="string">root.linuxprobe.com.</span>	<span class="string">(</span>	</span><br><span class="line">     <span class="comment">#授权信息开始:    #DNS区域的地址	  #域名管理员的邮箱(不要用@符号)	</span></span><br><span class="line">                                                                 <span class="number">0</span><span class="string">;serial</span>	<span class="comment">#更新序列号</span></span><br><span class="line">                                                                 <span class="string">1D;refresh</span>	<span class="comment">#更新时间</span></span><br><span class="line">                                                                 <span class="string">1H;retry</span>	<span class="comment">#重试延时</span></span><br><span class="line">                                                                 <span class="string">1W;expire</span>	<span class="comment">#失效时间</span></span><br><span class="line">                                                                 <span class="string">3H;)minimum</span>	<span class="comment">#无效解析记录的缓存时间</span></span><br><span class="line">     <span class="string">NS</span>               <span class="string">ns.linuxprobe.com.</span>	                 <span class="comment">#域名服务器记录</span></span><br><span class="line"><span class="string">ns</span>   <span class="string">IN</span> <span class="string">A</span>	      <span class="number">192.168</span><span class="number">.10</span><span class="number">.10</span>	                         <span class="comment">#地址记录(ns.linuxprobe.com.)</span></span><br><span class="line">     <span class="string">IN</span> <span class="string">MX</span> <span class="number">10</span>	      <span class="string">mail.linuxprobe.com.</span>	                 <span class="comment">#邮箱交换记录</span></span><br><span class="line"><span class="string">mail</span> <span class="string">IN</span> <span class="string">A</span>	      <span class="number">192.168</span><span class="number">.10</span><span class="number">.10</span>	                         <span class="comment">#地址记录(mail.linuxprobe.com.)</span></span><br><span class="line"><span class="string">www</span>  <span class="string">IN</span> <span class="string">A</span>	      <span class="number">192.168</span><span class="number">.10</span><span class="number">.10</span>	                         <span class="comment">#地址记录(www.linuxprobe.com.)</span></span><br><span class="line"><span class="string">bbs</span>  <span class="string">IN</span> <span class="string">A</span>	      <span class="number">192.168</span><span class="number">.10</span><span class="number">.20</span>	                         <span class="comment">#地址记录(bbs.linuxprobe.com.)</span></span><br></pre></td></tr></table></figure>
 systemctl restart named
</pre>

<p>第3步: 检验解析结果<br>nslookup命令用于检测能否从DNS服务器中查询到域名与IP地址的解析记录, 进而更准确地检验DNS服务器是否已经能够为用户提供服务.</p>
<pre>
 systemctl restart network
 nslookup
 www.linuxprobe.com
 bbs.linuxprobe.com
</pre>

<h2 id="反向解析实验"><a href="#反向解析实验" class="headerlink" title="反向解析实验"></a>反向解析实验</h2><p>在DNS域名解析服务中, 反向解析的作用是将用户提交的IP地址解析为对应的域名信息, 它一般用于对某个IP地址上绑定的所有域名进行整体屏蔽, 屏蔽由某些域名发送的垃圾邮件. 它也可以针对某个IP地址进行反向解析, 大致判断出有多少个网站运行在上面.</p>
<p>第1步: 编辑区域配置文件<br>反向解析是把IP地址解析成域名格式, 因此在定义zone(区域)时应该要把IP地址反写, 只需写出IP地址的网络位即可.</p>
<pre>
 vim /etc/named.rfc1912.zones
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"10.168.192.in-addr.arpa"</span> <span class="keyword">IN</span> &#123;</span><br><span class="line"> <span class="built_in"> type </span>master;</span><br><span class="line">  file <span class="string">"192.168.10.arpa"</span>;</span><br><span class="line">  allow-update &#123;none;&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</pre>

<p>第2步: 编辑数据配置文件<br>首先从/var/named目录中复制一份反向解析的模板文件(named.loopback), 然后把下面的参数填写到文件中. 其中, IP地址仅需要写主机位.</p>
<pre>
 cd /var/named/
 cp -a named.loopback 192.168.10.arpa
 vim 192.168.10.arpa
 <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$TTL <span class="number">1</span>D				</span><br><span class="line">@	IN SOA	linuxprobe.com.	root.linuxprobe.com. (</span><br><span class="line">                                                      <span class="number">0</span>;serial</span><br><span class="line">                                                      <span class="number">1</span>D;<span class="built_in">ref</span>resh</span><br><span class="line">                                                      <span class="number">1</span>H;retry</span><br><span class="line">                                                      <span class="number">1</span>W;expire</span><br><span class="line">                                                      <span class="number">3</span>H);minimum</span><br><span class="line">        NS      ns.linuxprobe.com.	</span><br><span class="line">ns	A       <span class="number">192.168</span><span class="number">.10</span><span class="number">.10</span>	</span><br><span class="line"><span class="number">10</span>	PTR	ns.linuxprobe.com.	#PTR为指针记录, 仅用于反向解析中.</span><br><span class="line"><span class="number">10</span>	PTR	mail.linuxprobe.com.	</span><br><span class="line"><span class="number">10</span>	PTR	www.linuxprobe.com.	</span><br><span class="line"><span class="number">20</span>	PTR	bbs.linuxprobe.com.</span><br></pre></td></tr></table></figure>
 systemctl restart named
</pre>

<p>第3步: 检验解析结果, 也要把把系统网卡中的DNS地址参数修改成了本机IP地址.</p>
<pre>
 nslookup
 192.168.10.10
 192.168.10.20
</pre>

<h2 id="部署从服务器"><a href="#部署从服务器" class="headerlink" title="部署从服务器"></a>部署从服务器</h2><p>在DNS域名解析服务中, 从服务器可以从主服务器上获取指定的区域数据文件, 从而起到备份解析记录与负载均衡的作用, 因此通过部署从服务器可以减轻主服务器的负载压力, 还可以提升用户的查询效率.</p>
<table>
主服务器与从服务器分别使用的操作系统与IP地址信息
<tr><td>主机名称</td><td>操作系统</td><td>IP地址</td>
</tr><tr><td>主服务器</td><td>RHEL 7</td><td>192.168.10.10</td>
</tr><tr><td>从服务器</td><td>RHEL 7</td><td>192.168.10.20</td>
</tr></table>

<p>第1步:在主服务器的区域配置文件中允许该从服务器的更新请求, 然后重启主服务器的DNS服务程序.</p>
<pre>
 vim /etc/named.rfc1912.zones
 <figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow-<span class="keyword">update</span> &#123; 从服务器的ip地址; &#125;;</span><br></pre></td></tr></table></figure>
 systemctl restart named
</pre>

<p>修改从服务器的配置文件</p>
<pre>
 vim /etc/named.conf

 listen-on port 53 { any; };
 allow-query { any; };
</pre>

<p>第2步: 在从服务器中填写主服务器的IP地址与要抓取的区域信息, 然后重启服务.</p>
<pre>
 vim /etc/named.rfc1912.zones
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"linuxprobe.com"</span> <span class="keyword">IN</span> &#123;</span><br><span class="line">type slave;</span><br><span class="line">masters &#123; 主服务器的ip地址; &#125;;</span><br><span class="line">file <span class="string">"slaves/linuxprobe.com.zone"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"10.168.192.in-addr.arpa"</span> <span class="keyword">IN</span> &#123;</span><br><span class="line">type slave;</span><br><span class="line">masters &#123; 主服务器的ip地址; &#125;;</span><br><span class="line">file <span class="string">"slaves/192.168.10.arpa"</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
 systemctl restart named
</pre>

<p>第3步: 主服务器查看防火墙, 如果没有指定端口则开启指定端口.</p>
<pre>
 firewall-cmd --list-port
 firewall-cmd --zone=public --add-port=53/tcp --permanent
 firewall-cmd --zone=public --add-port=53/udp --permanent
 firewall-cmd --reload
</pre>

<p>第4步: 检验解析结果</p>
<pre>
 cd /var/named/slaves
 ls
 nslookup
 www.linuxprobe.com
 192.168.10.10
</pre>

<h2 id="安全的加密传输"><a href="#安全的加密传输" class="headerlink" title="安全的加密传输"></a>安全的加密传输</h2><p>bind服务程序为了提供安全的解析服务, 已经对TSIG(RFC 2845)加密机制提供了支持. TSIG主要是利用了密码编码的方式来保护区域信息的传输(Zone Transfer), 即TSIG加密机制保证了DNS服务器之间传输域名区域信息的安全性.</p>
<p>删除所有获取到的数据配置文件</p>
<pre>
 rm -rf /var/named/slaves/*
</pre>

<p>第1步: 在主服务器中生成密钥, dnssec-keygen命令用于生成安全的DNS服务密钥.</p>
<pre>
 dnssec-keygen [参数]
 |__ -a 指定加密算法, 包括RSAMD5(RSA)、RSASHA1、DSA、NSEC3RSASHA1、NSEC3DSA等
 |__ -b 密钥长度(HMAC-MD5的密钥长度在1~512位之间)
 |__ -n 密钥的类型(HOST表示与主机相关)
</pre>

<p>使用命令生成一个主机名称为master-slave的128位HMAC-MD5算法的密钥文件. 在执行该命令后默认会在当前目录中生成公钥和私钥文件, 把私钥文件中Key参数后面的值记录下来, 一会儿要将其写入传输配置文件中.</p>
<pre>
 cd ~
 dnssec-keygen -a HMAC-MD5 -b 128 -n HOST master-slave
 ls -al Kmaster-slave.+157+46845.*
 cat Kmaster-slave.+157+46845.private
 <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Algorithm: <span class="number">157</span> (HMAC_MD5)</span><br><span class="line">Key: <span class="number">1</span>XEEL3tG5DNLOw+<span class="number">1</span>WHfE3Q==</span><br></pre></td></tr></table></figure>
</pre>

<p>第2步: 在主服务器中创建密钥验证文件. 进入bind服务程序用于保存配置文件的目录, 把刚刚生成的密钥名称、加密算法和私钥加密字符串按照下面格式写入到tansfer.key传输配置文件中. 为了安全起见, 将文件的所属组修改成named, 并将文件权限设置得要小一点, 然后把该文件做一个硬链接到/etc目录中.</p>
<pre>
 cd /var/named/chroot/etc/
 vim transfer.key
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">key <span class="string">"master-slave"</span> &#123;</span><br><span class="line">  algorithm hmac-md5;</span><br><span class="line"> <span class="built_in"> secret </span><span class="string">"1XEEL3tG5DNLOw+1WHfE3Q=="</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
 chown root:named transfer.key
 chmod 640 transfer.key
 ln transfer.key /etc/transfer.key
</pre>

<p>第3步:开启并加载Bind服务的密钥验证功能. 首先需要在主服务器的主配置文件中加载密钥验证文件, 然后进行设置, 使得只允许带有master-slave密钥认证的DNS服务器同步数据配置文件:</p>
<pre>
 vim /etc/named.conf
 <figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line">include <span class="string">"/etc/transfer.key"</span>;</span><br><span class="line"><span class="class">options </span>&#123;</span><br><span class="line"></span><br><span class="line">allow-<span class="class">query </span>&#123; any; &#125;;</span><br><span class="line">allow-<span class="class">transfer </span>&#123; key master-slave; &#125;;</span><br></pre></td></tr></table></figure>
 systemctl restart named
</pre>

<p>清空DNS从服务器同步目录中所有的数据配置文件, 然后再次重启bind服务程序, 这时就已经不能像刚才那样自动获取到数据配置文件.</p>
<pre>
 rm -rf /var/named/slaves/*
 systemctl restart named
 ls  /var/named/slaves/
</pre>

<p>第4步: 配置从服务器, 使其支持密钥验证. 配置DNS从服务器和主服务器的方法大致相同, 都需要在bind服务程序的配置文件目录中创建密钥认证文件, 并设置相应的权限, 然后把该文件做一个硬链接到/etc目录中.</p>
<pre>
 cd /var/named/chroot/etc
 vim transfer.key
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">key <span class="string">"master-slave"</span> &#123;</span><br><span class="line">  algorithm hmac-md5;</span><br><span class="line"> <span class="built_in"> secret </span><span class="string">"1XEEL3tG5DNLOw+1WHfE3Q=="</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
 chown root:named transfer.key
 chmod 640 transfer.key
 ln transfer.key /etc/transfer.key
</pre>

<p>第5步: 开启并加载从服务器的密钥验证功能. 这一步的操作步骤也同样是在主配置文件中加载密钥认证文件, 然后按照指定格式写上主服务器的IP地址和密钥名称. 注意, 密钥名称等参数位置不要太靠前, 大约在第43行比较合适, 否则bind服务程序会因为没有加载完预设参数而报错:</p>
<pre>
 vim /etc/named.conf
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">include <span class="string">"/etc/transfer.key"</span>;</span><br><span class="line">options &#123;</span><br><span class="line"></span><br><span class="line">allow-query &#123; any; &#125;;</span><br><span class="line">allow-transfer &#123; key master-slave; &#125;;</span><br><span class="line"></span><br><span class="line">server 192.168.10.10</span><br><span class="line">&#123;</span><br><span class="line">keys &#123; master-slave; &#125;;</span><br><span class="line">&#125;; </span><br><span class="line">logging &#123;</span><br></pre></td></tr></table></figure>
</pre>

<p>第6步: DNS从服务器同步域名区域数据</p>
<pre>
 systemctl restart named
 ls /var/named/slaves/
</pre>

<h2 id="部署缓存服务器"><a href="#部署缓存服务器" class="headerlink" title="部署缓存服务器"></a>部署缓存服务器</h2><p>DNS缓存服务器(Caching DNS Server)是一种不负责域名数据维护的DNS服务器. 简单来说, 缓存服务器就是把用户经常使用到的域名与IP地址的解析记录保存在主机本地, 从而提升下次解析的效率.</p>
<p>DNS缓存服务器一般用于经常访问某些固定站点而且对这些网站的访问速度有较高要求的企业内网中, 但实际的应用并不广泛. 而且, 缓存服务器是否可以成功解析还与指定的上级DNS服务器的允许策略有关, 因此当前仅需了解即可.</p>
<p>第1步: 配置系统的双网卡参数</p>
<table>
用于配置Linux虚拟机系统所需的参数信息
<tr><td>主机名称</td><td>操作系统</td><td>IP地址</td></tr>
<tr><td>缓存服务器</td><td>RHEL 7</td><td>网卡(外网): 根据物理设备的网络参数进行配置(通过DHCP或手动方式指定IP地址与网关等信息)</td></tr>
<tr><td></td><td></td><td>网卡(内网): 192.168.10.10</td></tr>
<tr><td>客户端</td><td>RHEL 7</td><td>192.168.10.20</td></tr>
</table>

<p>第2步: 在bind服务程序的主配置文件中添加缓存转发参数, 上级DNS服务器地址指的是获取数据配置文件的服务器.</p>
<pre>
 systemctl restart network
 vim /etc/named.conf
 <figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allow-query &#123; any<span class="comment">; &#125;;</span></span><br><span class="line">forwarders &#123; 上级DNS服务器地址<span class="comment">; &#125;;</span></span><br></pre></td></tr></table></figure>
 systemctl restart named
</pre>

<p>第3步: 重启DNS服务, 把客户端主机的DNS服务器地址参数修改为DNS缓存服务器的IP地址.<br><img src="/post/cea46563/%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E7%BD%91%E5%8D%A1%E4%BF%A1%E6%81%AF.jpg" alt="配置客户端的网卡信息"></p>
<pre>
 systemctl restart network
 nslookup

 www.linuxprobe.com
 8.8.8.8
</pre>

<h2 id="分离解析技术"><a href="#分离解析技术" class="headerlink" title="分离解析技术"></a>分离解析技术</h2><p>可以购买多台服务器并分别部署在全球各地, 使用DNS服务的分离解析功能, 即可让位于不同地理范围内的读者通过访问相同的网址, 而从不同的服务器获取到相同的数据.</p>
<table>
不同主机的操作系统与IP地址情况
<tr><td>主机名称</td><td>操作系统</td><td>IP地址</td></tr>
<tr><td>DNS服务器</td><td>RHEL 7</td><td>北京网络:122.71.115.10</td></tr>
<tr><td></td><td></td><td>美国网络:106.185.25.10</td></tr>
<tr><td>北京用户</td><td>Windows 7</td><td>122.71.115.1</td></tr>
<tr><td>海外用户</td><td>Windows 7</td><td>106.185.25.1</td></tr>
</table>

<p><img src="/post/cea46563/DNS%E5%88%86%E7%A6%BB%E8%A7%A3%E6%9E%90%E6%8B%93%E6%89%91%E5%9B%BE.png" alt="DNS分离解析拓扑图"></p>
<p>第1步: 修改bind服务程序的主配置文件, 把第11行的监听端口与第17行的允许查询主机修改为any. 由于配置的DNS分离解析功能与DNS根服务器配置参数有冲突, 所以需要把第51~54行的根域信息删除.</p>
<pre>
 vim /etc/named.conf

 <s>zone "." IN {</s>
 <s>type hint;</s>
 <s>file "named.ca";</s>
 <s>};</s>
</pre>

<p>第2步: 编辑区域配置文件. 把区域配置文件中原有的数据清空, 然后按照以下格式写入参数. 首先使用acl参数分别定义两个变量名称(china与american), 当下面需要匹配IP地址时只需写入变量名称即可, 这样不仅容易阅读识别, 而且也利于修改维护.</p>
<p>view参数的作用是通过判断用户的IP地址是中国的还是美国的, 然后去分别加载不同的数据配置文件.</p>
<pre>
 vim /etc/named.rfc1912.zones 
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">acl <span class="string">"china"</span> &#123; 122.71.115.0/24; &#125;;</span><br><span class="line">acl <span class="string">"american"</span> &#123; 106.185.25.0/24;&#125;; </span><br><span class="line"></span><br><span class="line">view <span class="string">"china"</span>&#123;</span><br><span class="line">match-clients &#123; <span class="string">"china"</span>; &#125;;</span><br><span class="line">zone <span class="string">"linuxprobe.com"</span> &#123;</span><br><span class="line">type master;</span><br><span class="line">file <span class="string">"linuxprobe.com.china"</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line">view <span class="string">"american"</span> &#123;</span><br><span class="line">match-clients &#123; <span class="string">"american"</span>; &#125;;</span><br><span class="line">zone <span class="string">"linuxprobe.com"</span> &#123;</span><br><span class="line">type master;</span><br><span class="line">file <span class="string">"linuxprobe.com.american"</span>;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</pre>

<p>第3步: 建立数据配置文件. 分别通过模板文件创建出两份不同名称的区域数据文件, 其名称应与上面区域配置文件中的参数相对应.</p>
<pre>
 cd /var/named
 cp -a named.localhost linuxprobe.com.china
 cp -a named.localhost linuxprobe.com.american

 vim linuxprobe.com.china
 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$TTL</span> <span class="string">1D</span>	<span class="comment">#生存周期为1天				</span></span><br><span class="line"><span class="string">@</span>    <span class="string">IN</span> <span class="string">SOA</span>           <span class="string">linuxprobe.com.</span>	  <span class="string">root.linuxprobe.com.</span>	<span class="string">(</span>	</span><br><span class="line">     <span class="comment">#授权信息开始:    #DNS区域的地址	  #域名管理员的邮箱(不要用@符号)	</span></span><br><span class="line">                                                                 <span class="number">0</span><span class="string">;serial</span>	<span class="comment">#更新序列号</span></span><br><span class="line">                                                                 <span class="string">1D;refresh</span>	<span class="comment">#更新时间</span></span><br><span class="line">                                                                 <span class="string">1H;retry</span>	<span class="comment">#重试延时</span></span><br><span class="line">                                                                 <span class="string">1W;expire</span>	<span class="comment">#失效时间</span></span><br><span class="line">                                                                 <span class="string">3H;)minimum</span>	<span class="comment">#无效解析记录的缓存时间</span></span><br><span class="line">     <span class="string">NS</span>               <span class="string">ns.linuxprobe.com.</span>	                 <span class="comment">#域名服务器记录</span></span><br><span class="line"><span class="string">ns</span>   <span class="string">IN</span> <span class="string">A</span>	      <span class="number">122.71</span><span class="number">.115</span><span class="number">.10</span>	                         <span class="comment">#地址记录(ns.linuxprobe.com.)</span></span><br><span class="line"><span class="string">www</span>  <span class="string">IN</span> <span class="string">A</span>	      <span class="number">122.71</span><span class="number">.115</span><span class="number">.15</span>	                         <span class="comment">#地址记录(www.linuxprobe.com.)</span></span><br></pre></td></tr></table></figure>

 vim linuxprobe.com.american
 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$TTL</span> <span class="string">1D</span>	<span class="comment">#生存周期为1天				</span></span><br><span class="line"><span class="string">@</span>    <span class="string">IN</span> <span class="string">SOA</span>           <span class="string">linuxprobe.com.</span>	  <span class="string">root.linuxprobe.com.</span>	<span class="string">(</span>	</span><br><span class="line">     <span class="comment">#授权信息开始:    #DNS区域的地址	  #域名管理员的邮箱(不要用@符号)	</span></span><br><span class="line">                                                                 <span class="number">0</span><span class="string">;serial</span>	<span class="comment">#更新序列号</span></span><br><span class="line">                                                                 <span class="string">1D;refresh</span>	<span class="comment">#更新时间</span></span><br><span class="line">                                                                 <span class="string">1H;retry</span>	<span class="comment">#重试延时</span></span><br><span class="line">                                                                 <span class="string">1W;expire</span>	<span class="comment">#失效时间</span></span><br><span class="line">                                                                 <span class="string">3H;)minimum</span>	<span class="comment">#无效解析记录的缓存时间</span></span><br><span class="line">     <span class="string">NS</span>               <span class="string">ns.linuxprobe.com.</span>	                 <span class="comment">#域名服务器记录</span></span><br><span class="line"><span class="string">ns</span>   <span class="string">IN</span> <span class="string">A</span>	      <span class="number">106.185</span><span class="number">.25</span><span class="number">.10</span>	                         <span class="comment">#地址记录(ns.linuxprobe.com.)</span></span><br><span class="line"><span class="string">www</span>  <span class="string">IN</span> <span class="string">A</span>	      <span class="number">106.185</span><span class="number">.25</span><span class="number">.15</span>	                         <span class="comment">#地址记录(www.linuxprobe.com.)</span></span><br></pre></td></tr></table></figure>
</pre>

<p>第4步: 重新启动named服务程序, 验证结果. 将客户端主机(Windows系统或Linux系统均可)的IP地址分别设置为122.71.115.1与106.185.25.1, 将DNS地址分别设置为服务器主机的两个IP地址.</p>
<pre>
 systemctl restart named

 windons7(1):
 ip地址:122.71.115.1
 子网掩码:255.255.255.0
 默认网关:122.71.115.10
 DNS服务器:122.71.115.10

 windons7(2):
 ip地址:106.185.25.1
 子网掩码:255.255.255.0
 默认网关:106.185.25.10
 DNS服务器:106.185.25.10
</pre>

<h1 id="使用DHCP动态管理主机地址"><a href="#使用DHCP动态管理主机地址" class="headerlink" title="使用DHCP动态管理主机地址"></a>使用DHCP动态管理主机地址</h1><h2 id="动态主机地址管理协议"><a href="#动态主机地址管理协议" class="headerlink" title="动态主机地址管理协议"></a>动态主机地址管理协议</h2><p>动态主机配置协议(DHCP)是一种基于UDP协议且仅限于在局域网内部使用的网络协议, 主要用于大型的局域网环境或者存在较多移动办公设备的局域网环境中, 其主要用途是为局域网内部的设备或网络供应商自动分配IP地址等参数.</p>
<p>简单来说, DHCP协议就是让局域网中的主机自动获得网络参数的服务.</p>
<p><img src="/post/cea46563/DHCP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png" alt="DHCP工作原理"></p>
<table>
DHCP涉及的常见术语
<tr><td>作用域</td><td>一个完整的IP地址段, DHCP协议根据作用域来管理网络的分布、分配IP地址及其他配置参数.</td></tr>
<tr><td>超级作用域</td><td>用于管理处于同一个物理网络中的多个逻辑子网段. 超级作用域中包含了可以统一管理的作用域列表.</td></tr>
<tr><td>排除范围</td><td>把作用域中的某些IP地址排除, 确保这些IP地址不会分配给DHCP客户端.</td></tr>
<tr><td>地址池</td><td>在定义了DHCP的作用域并应用了排除范围后, 剩余的用来动态分配给DHCP客户端的IP地址范围.</td></tr>
<tr><td>租约</td><td>DHCP客户端能够使用动态分配的IP地址的时间</td></tr>
<tr><td>预约</td><td>保证网络中的特定设备总是获取到相同的IP地址</td></tr>
</table>

<h2 id="部署dhcpd服务程序"><a href="#部署dhcpd服务程序" class="headerlink" title="部署dhcpd服务程序"></a>部署dhcpd服务程序</h2><p>dhcpd是Linux系统中用于提供DHCP协议的服务程序</p>
<p>在确认Yum软件仓库配置妥当之后, 安装dhcpd服务程序:<br><code>yum install dhcp</code></p>
<p>查看dhcpd服务程序的配置文件内容<br><code>cat /etc/dhcp/dhcpd.conf</code></p>
<p>一个标准的配置文件应该包括全局配置参数、子网网段声明、地址配置选项以及地址配置参数. 其中, 全局配置参数用于定义dhcpd服务程序的整体运行参数; 子网网段声明用于配置整个子网段的地址属性.<br><img src="/post/cea46563/dhcp%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="dhcp配置文件"></p>
<table style="text-align:center">
dhcpd服务程序配置文件中使用的常见参数以及作用
<tr><td>ddns-update-style 类型</td><td>定义DNS服务动态更新的类型, 类型包括:none(不支持动态更新)、interim(互动更新模式)与ad-hoc(特殊更新模式)</td></tr>
<tr><td>allow/ignore client-updates</td><td>允许/忽略客户端更新DNS记录</td></tr>
<tr><td>default-lease-time 21600</td><td>默认超时时间</td></tr>
<tr><td>max-lease-time 43200</td><td>最大超时时间</td></tr>
<tr><td>option domain-name-servers 8.8.8.8</td><td>定义DNS服务器地址</td></tr>
<tr><td>option domain-name "domain.org"</td><td>定义DNS域名</td></tr>
<tr><td>range</td><td>定义用于分配的IP地址池</td></tr>
<tr><td>option subnet-mask</td><td>定义客户端的子网掩码</td></tr>
<tr><td>option routers</td><td>定义客户端的网关地址</td></tr>
<tr><td>broadcast-address 广播地址</td><td>定义客户端的广播地址</td></tr>
<tr><td>ntp-server IP地址</td><td>定义客户端的网络时间服务器(NTP)</td></tr>
<tr><td>nis-servers IP地址</td><td>定义客户端的NIS域服务器的地址</td></tr>
<tr><td>hardware 硬件类型 MAC地址</td><td>指定网卡接口的类型与MAC地址</td></tr>
<tr><td>server-name 主机名</td><td>向DHCP客户端通知DHCP服务器的主机名</td></tr>
<tr><td>fixed-address IP地址</td><td>将某个固定的IP地址分配给指定主机</td></tr>
<tr><td>time-offset 偏移差</td><td>指定客户端与格林尼治时间的偏移差</td></tr>
</table>

<h2 id="自动管理IP地址"><a href="#自动管理IP地址" class="headerlink" title="自动管理IP地址"></a>自动管理IP地址</h2><p>DHCP服务器会自动把IP地址、子网掩码、网关、DNS地址等网络信息分配给有需要的客户端, 而且当客户端的租约时间到期后还可以自动回收所分配的IP地址, 以便交给新加入的客户端.</p>
<table>
测试所用的网络地址以及参数信息
<tr><td>参数名称</td><td>值</td></tr>
<tr><td>默认租约时间</td><td>21600秒</td></tr>
<tr><td>最大租约时间</td><td>43200秒</td></tr>
<tr><td>IP地址范围</td><td>192.168.10.50~192.168.10.150</td></tr>
<tr><td>子网掩码</td><td>255.255.255.0</td></tr>
<tr><td>网关地址</td><td>192.168.10.1</td></tr>
<tr><td>DNS服务器地址</td><td>192.168.10.1</td></tr>
<tr><td>搜索域</td><td>linuxprobe.com</td></tr>
</table>
<table>
DHCP服务器以及客户端的配置信息
<tr><td>主机类型</td><td>操作系统</td><td>IP地址</td></tr>
<tr><td>DHCP服务器</td><td>RHEL 7</td><td>192.168.10.1</td></tr>
<tr><td>DHCP客户机</td><td>RHEL 7</td><td>DHCP自动获取地址</td></tr>
</table>

<p>将虚拟机软件自带的DHCP功能关闭<br><img src="/post/cea46563/%E4%B8%8D%E4%BD%BF%E7%94%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84DHCP%E5%8A%9F%E8%83%BD.jpg" alt="不使用虚拟机的DHCP功能"></p>
<p>在配置dhcpd服务程序时, 配置文件中的每行参数后面都需要以分号(;)结尾:</p>
<pre>
 vim /etc/dhcp/dhcpd.conf
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ddns-update-style none;</span><br><span class="line">ignore client-updates;</span><br><span class="line">subnet <span class="number">192.168</span><span class="number">.10</span><span class="number">.0</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> &#123;</span><br><span class="line">range <span class="number">192.168</span><span class="number">.10</span><span class="number">.50</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.150</span>;</span><br><span class="line">option subnet-mask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>;</span><br><span class="line">option routers <span class="number">192.168</span><span class="number">.10</span><span class="number">.1</span>;</span><br><span class="line">option domain-name <span class="string">"linuxprobe.com"</span>;</span><br><span class="line">option domain-name-servers <span class="number">192.168</span><span class="number">.10</span><span class="number">.1</span>;</span><br><span class="line"><span class="section">default</span>-lease-time <span class="number">21600</span>;</span><br><span class="line">max-lease-time <span class="number">43200</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</pre>

<table>
dhcpd服务程序配置文件中使用的参数以及作用
<tr><td>参数</td><td>作用</td></tr>
<tr><td>ddns-update-style none;</td><td>设置DNS服务不自动进行动态更新</td></tr>
<tr><td>ignore client-updates;</td><td>忽略客户端更新DNS记录</td></tr>
<tr><td>subnet 192.168.10.0 netmask 255.255.255.0 {</td><td>作用域为192.168.10.0/24网段</td></tr>
<tr><td>range 192.168.10.50 192.168.10.150;</td><td>IP地址池为192.168.10.50-150(约100个IP地址)</td></tr>
<tr><td>option subnet-mask 255.255.255.0;</td><td>定义客户端默认的子网掩码</td></tr>
<tr><td>option routers 192.168.10.1;</td><td>定义客户端的网关地址</td></tr>
<tr><td>option domain-name "linuxprobe.com";</td><td>定义默认的搜索域</td></tr>
<tr><td>option domain-name-servers 192.168.10.1;</td><td>定义客户端的DNS地址</td></tr>
<tr><td>default-lease-time 21600;</td><td>定义默认租约时间(单位:秒)</td></tr>
<tr><td>max-lease-time 43200;</td><td>定义最大预约时间(单位:秒)</td></tr>
<tr><td>}</td><td>结束符</td></tr>
</table>

<p>把配置过的dhcpd服务加入到开机启动项中, 以确保当服务器下次开机后dhcpd服务依然能自动启动, 并顺利地为客户端分配IP地址等信息.</p>
<pre>
 systemctl start dhcpd
 systemctl enable dhcpd
 systemctl restart network
</pre>

<p>开启客户端来检验IP分配效果, 重启客户端的网卡服务后即可看到自动分配到的IP地址.</p>
<pre>
 systemctl restart network
</pre>

<h2 id="分配固定IP地址"><a href="#分配固定IP地址" class="headerlink" title="分配固定IP地址"></a>分配固定IP地址</h2><p>在DHCP协议中有个术语是”预约”, 它用来确保局域网中特定的设备总是获取到固定的IP地址.</p>
<p>要想把某个IP地址与某台主机进行绑定, 就需要用到这台主机的MAC地址. MAC地址是网卡上面的一串独立的标识符, 具备唯一性, 因此不会存在冲突的情况.<br><img src="/post/cea46563/%E7%BD%91%E5%8D%A1MAC%E5%9C%B0%E5%9D%80.png" alt="网卡MAC地址"></p>
<p>在dhcpd服务程序的配置文件中, 按照如下格式将IP地址与MAC地址进行绑定:<br> <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">host 主机名称 &#123;		</span><br><span class="line"> <span class="built_in"> hardware </span>     <span class="built_in"> ethernet	</span>   该主机的MAC地址;	</span><br><span class="line">  fixed-address  欲指定的IP地址;		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>另一种查看方式:先启动dhcpd服务程序, 为老板的主机分配一个IP地址, 这样就会在DHCP服务器本地的日志文件中保存这次的IP地址分配记录. 然后查看日志文件, 就可以获悉主机的MAC地址了</p>
<pre>
 tail -f /var/log/messages 
</pre>

<p>修改dhcpd服务程序配置文件后, 并重启dhcpd服务程序.</p>
<pre>
 vim /etc/dhcp/dhcpd.conf 
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">host linuxprobe &#123;</span><br><span class="line">hardware<span class="built_in"> ethernet </span>MAC地址;</span><br><span class="line">fixed-address 192.168.10.88;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
 systemctl restart dhcpd

 客户端:
 systemctl restart network
</pre>

<h1 id="使用Postfix与Dovecot部署邮件系统"><a href="#使用Postfix与Dovecot部署邮件系统" class="headerlink" title="使用Postfix与Dovecot部署邮件系统"></a>使用Postfix与Dovecot部署邮件系统</h1><h2 id="电子邮件系统"><a href="#电子邮件系统" class="headerlink" title="电子邮件系统"></a>电子邮件系统</h2><table>
电子邮件系统基于邮件协议来完成电子邮件的传输, 常见的邮件协议:
<tr><td>简单邮件传输协议(Simple Mail Transfer Protocol, SMTP)</td><td>用于发送和中转发出的电子邮件, 占用服务器的25/TCP端口.</td></tr>
<tr><td>邮局协议版本3(Post Office Protocol 3)</td><td>用于将电子邮件存储到本地主机, 占用服务器的110/TCP端口.</td></tr>
<tr><td>Internet消息访问协议版本4(Internet Message Access Protocol 4)</td><td>用于在本地主机上访问邮件, 占用服务器的143/TCP端口.</td></tr>
</table>

<p>在电子邮件系统中, 为用户收发邮件的服务器名为邮件用户代理(Mail User Agent, MUA).<br>用于保存用户邮件的”信箱”服务器, 这个服务器的名字为邮件投递代理(Mail Delivery Agent, MDA), 其工作职责是把来自于邮件传输代理(Mail Transfer Agent, MTA)的邮件保存到本地的收件箱中.<br>MTA的工作职责是转发处理不同电子邮件服务供应商之间的邮件, 把来自于MUA的邮件转发到合适的MTA服务器.<br><br><img src="/post/cea46563/%E9%82%AE%E4%BB%B6%E6%8A%95%E9%80%92%E5%B7%A5%E7%A8%8B.png" alt="邮件投递工程"></p>
<p>在生产环境中部署企业级的电子邮件系统时, 有4个注意事项请留意:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">添加反垃圾与反病毒模块: 它能够很有效地阻止垃圾邮件或病毒邮件对企业信箱的干扰</span></span><br><span class="line"><span class="section">对邮件加密: 可有效保护邮件内容不被黑客盗取和篡改</span></span><br><span class="line"><span class="section">添加邮件监控审核模块: 可有效地监控企业全体员工的邮件中是否有敏感词、是否有透露企业资料等违规行为</span></span><br><span class="line"><span class="section">保障稳定性: 电子邮件系统的稳定性至关重要, 运维人员应做到保证电子邮件系统的稳定运行, 并及时做好防范分布式拒绝服务(Distributed Denial of Service, DDoS)攻击的准备.</span></span><br></pre></td></tr></table></figure>

<h2 id="部署基础的电子邮件系统"><a href="#部署基础的电子邮件系统" class="headerlink" title="部署基础的电子邮件系统"></a>部署基础的电子邮件系统</h2><p>一个最基础的电子邮件系统肯定要能提供发件服务和收件服务, 为此需要使用基于SMTP协议的Postfix服务程序提供发件服务功能, 并使用基于POP3协议的Dovecot服务程序提供收件服务功能.<br><br><img src="/post/cea46563/%E9%82%AE%E5%B1%80%E7%B3%BB%E7%BB%9F%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="邮局系统流程图"></p>
<p>第1步: 配置服务器主机名称, 需要保证服务器主机名称与发信域名保持一致:</p>
<pre>
 vim /etc/hostname
 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">mail</span><span class="selector-class">.linuxprobe</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure>
 hostname
</pre>

<p>第2步: 清空iptables防火墙默认策略, 并保存策略状态, 避免因防火墙中默认存在的策略阻止了客户端DNS解析域名及收发邮件.</p>
<pre>
 iptables -F
 service iptables save
 <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">无法保存时安装iptables-services包</span><br><span class="line">yum <span class="keyword">install</span> iptables-services</span><br></pre></td></tr></table></figure>
</pre>

<p>第3步: 为电子邮件系统提供域名解析</p>
<pre>
 cat /etc/named.rfc1912.zones
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"linuxprobe.com"</span> <span class="keyword">IN</span> &#123;</span><br><span class="line">type master;</span><br><span class="line">file <span class="string">"linuxprobe.com.zone"</span>;</span><br><span class="line">allow-update &#123;none;&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
 cat /var/named/linuxprobe.com.zone
 <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$TTL <span class="number">1</span>D	#生存周期为<span class="number">1</span>天				</span><br><span class="line">@    IN SOA           linuxprobe.com.	  root.linuxprobe.com.	(	</span><br><span class="line">                                                                 <span class="number">0</span>;serial</span><br><span class="line">                                                                 <span class="number">1</span>D;<span class="built_in">ref</span>resh</span><br><span class="line">                                                                 <span class="number">1</span>H;retry</span><br><span class="line">                                                                 <span class="number">1</span>W;expire</span><br><span class="line">                                                                 <span class="number">3</span>H;)minimum</span><br><span class="line">     NS               ns.linuxprobe.com.</span><br><span class="line">ns   IN A	      <span class="number">192.168</span><span class="number">.10</span><span class="number">.10</span></span><br><span class="line">@    IN MX <span class="number">10</span>         mail.linuxprobe.com.</span><br><span class="line">www  IN A	      <span class="number">192.168</span><span class="number">.10</span><span class="number">.10</span></span><br></pre></td></tr></table></figure>
 systemctl restart named
 systemctl enable named
</pre>
<p>把服务器的DNS地址修改成本地IP地址</p>
<h2 id="配置Postfix服务程序"><a href="#配置Postfix服务程序" class="headerlink" title="配置Postfix服务程序"></a>配置Postfix服务程序</h2><p>Postfix是一款由IBM资助研发的免费开源电子邮件服务程序, 能够很好地兼容Sendmail服务程序, 可以方便Sendmail用户迁移到Postfix服务上.</p>
<p>Postfix服务程序的邮件收发能力强于Sendmail服务, 而且能自动增加、减少进程的数量来保证电子邮件系统的高性能与稳定性.</p>
<p>另外, Postfix服务程序由许多小模块组成, 每个小模块都可以完成特定的功能, 因此可在生产工作环境中根据需求灵活搭配它们.</p>
<p>第1步:安装Postfix服务程序, 禁用iptables防火墙, 否则外部用户无法访问电子邮件系统.</p>
<pre>
 yum install postfix
 systemctl disable iptables
</pre>

<table>
第2步:配置Postfix服务程序, Postfix服务程序主配置文件(/etc/postfix/main.cf).<br>
Postfix服务程序主配置文件中的重要参数
<tr><td>参数</td><td>作用</td></tr>
<tr><td>myhostname</td><td>邮局系统的主机名</td></tr>
<tr><td>mydomain</td><td>邮局系统的域名</td></tr>
<tr><td>myorigin</td><td>从本机发出邮件的域名名称</td></tr>
<tr><td>inet_interfaces</td><td>监听的网卡接口</td></tr>
<tr><td>mydestination</td><td>可接收邮件的主机名或域名</td></tr>
<tr><td>mynetworks</td><td>设置可转发哪些主机的邮件</td></tr>
<tr><td>relay_domains</td><td>设置可转发哪些网域的邮件</td></tr>
</table>

<p>在Postfix服务程序的主配置文件中, 总计需要修改5处:</p>
<pre>
 vim /etc/postfix/main.cf
 <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>在第<span class="number">76</span>行定义一个名为myhostname的变量, 用来保存服务器的主机名称.</span><br><span class="line"> myhostname = mail.linuxprobe.com</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>在第<span class="number">83</span>行定义一个名为mydomain的变量, 用来保存邮件域的名称.</span><br><span class="line"> mydomain = linuxprobe.com</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>在第<span class="number">99</span>行调用前面的mydomain变量, 用来定义发出邮件的域.</span><br><span class="line"> myorigin = $mydomain</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>在第<span class="number">116</span>行定义网卡监听地址, 可以指定要使用服务器的哪些IP地址对外提供电子邮件服务.</span><br><span class="line"> inet_interfaces = all</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>在第<span class="number">164</span>行定义可接收邮件的主机名或域名列表</span><br><span class="line"> mydestination = $myhostname , $mydomain</span><br></pre></td></tr></table></figure>
</pre>

<p>第3步:创建电子邮件系统的登录账户, 最后重启配置妥当的postfix服务程序, 并将其添加到开机启动项中.</p>
<pre>
 useradd boss
 echo "linuxprobe" | passwd --stdin boss
 systemctl restart postfix
 systemctl enable postfix
</pre>

<h2 id="配置Dovecot服务程序"><a href="#配置Dovecot服务程序" class="headerlink" title="配置Dovecot服务程序"></a>配置Dovecot服务程序</h2><p>Dovecot是一款能够为Linux系统提供IMAP和POP3电子邮件服务的开源服务程序, 安全性极高, 配置简单, 执行速度快, 而且占用的服务器硬件资源也较少.</p>
<p>第1步:安装Dovecot服务程序软件包<br><code>yum install dovecot</code></p>
<p>第2步:配置部署Dovecot服务程序, 第24行, 把Dovecot服务程序支持的电子邮件协议修改为imap、pop3和lmtp. 然后在这一行下面添加一行参数, 允许用户使用明文进行密码验证.</p>
<p>Dovecot服务程序为了保证电子邮件系统的安全而默认强制用户使用加密方式进行登录, 而由于当前还没有加密系统, 因此需要添加该参数来允许用户的明文登录.</p>
<pre>
 vim /etc/dovecot/dovecot.conf
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">protocols</span> = imap pop3 lmtp</span><br><span class="line"><span class="attr">disable_plaintext_auth</span> = <span class="literal">no</span></span><br></pre></td></tr></table></figure>
</pre>

<p>在主配置文件中的第48行, 设置允许登录的网段地址. 如果想允许所有人都能使用, 则不用修改本参数.</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_trusted_networks = <span class="number">192.168</span><span class="number">.10</span><span class="number">.0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<p>第3步：配置邮件格式与存储路径. 在Dovecot服务程序单独的子配置文件中, 定义一个路径, 用于指定要将收到的邮件存放到服务器本地的哪个位置.<br>这个路径默认已经定义好了, 将该配置文件中第24行前面的井号(#)删除即可.</p>
<pre>
 vim /etc/dovecot/conf.d/10-mail.conf
 <figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mail_location = <span class="string">mbox:</span><span class="regexp">~/mail:INBOX=/</span>var<span class="regexp">/mail/</span>%u</span><br></pre></td></tr></table></figure>
</pre>

<p>然后切换到配置Postfix服务程序时创建的boss账户, 并在家目录中建立用于保存邮件的目录. 记得要重启Dovecot服务并将其添加到开机启动项中.</p>
<pre>
 su - boss
 mkdir -p mail/.imap/INBOX
 exit
 systemctl restart dovecot 
 systemctl enable dovecot 
</pre>

<h2 id="客户使用电子邮件系统"><a href="#客户使用电子邮件系统" class="headerlink" title="客户使用电子邮件系统"></a>客户使用电子邮件系统</h2><p>使用Windows操作系统中自带的Outlook软件来进行测试(也可以使用其他电子邮件客户端来测试, 比如Foxmail)</p>
<table>
服务器与客户端的操作系统与IP地址
<tr><td>主机名称</td><td>操作系统</td><td>IP地址</td></tr>
<tr><td>电子邮件系统及DNS服务器</td><td>RHEL 7</td><td>192.168.10.10</td></tr>
<tr><td>客户端主机</td><td>Windows 7</td><td>192.168.10.30</td></tr>
</table>

<p><img src="/post/cea46563/%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E6%9C%BAIP%E5%9C%B0%E5%9D%80-1.png" alt="配置客户机IP地址-1"></p>
<p>第1步:在Windows 7系统中运行Outlook软件程序<br><img src="/post/cea46563/%E7%AC%AC1%E6%AD%A5%EF%BC%9A%E5%BC%80%E5%90%AFOutLook%E7%A8%8B%E5%BA%8F.jpg" alt="第1步：开启OutLook程序"></p>
<p>第2步:配置电子邮件账户<br><img src="/post/cea46563/%E7%AC%AC2%E6%AD%A5%EF%BC%9A%E9%80%89%E6%8B%A9%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E5%B8%90%E6%88%B7.jpg" alt="第2步：选择开始配置电子邮件帐户"></p>
<p>第3步:选择电子邮件服务的协议类型<br><img src="/post/cea46563/%E7%AC%AC3%E6%AD%A5%EF%BC%9A%E9%80%89%E6%8B%A9%E9%BB%98%E8%AE%A4%E7%9A%84%E9%82%AE%E5%B1%80%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B1%BB%E5%9E%8B.png" alt="第3步：选择默认的邮局服务器类型"></p>
<p>第4步:填写电子邮件账户信息<br><img src="/post/cea46563/%E7%AC%AC4%E6%AD%A5%EF%BC%9A%E5%A1%AB%E5%86%99%E5%88%9B%E5%BB%BA%E7%9A%84%E9%82%AE%E7%AE%B1%E5%B8%90%E5%8F%B7%E5%92%8C%E5%AF%86%E7%A0%81.jpg" alt="第4步：填写创建的邮箱帐号和密码"></p>
<p>第5步:进行电子邮件服务登录验证, Outlook软件默认会通过SSL加密协议尝试登录电子邮件服务, 超时后系统会出现登录失败的报错信息. 此时只需再次单击”下一步”按钮, 即可让Outlook软件通过非加密的方式验证登录.<br><img src="/post/cea46563/%E7%AC%AC5%E6%AD%A5%EF%BC%9A%E7%AD%89%E5%BE%85%E8%BF%9E%E6%8E%A5%E9%82%AE%E5%B1%80%E6%9C%8D%E5%8A%A1%E5%99%A8.jpg" alt="第5步：等待连接邮局服务器"><br><img src="/post/cea46563/%E7%AC%AC6%E6%AD%A5%EF%BC%9A%E9%80%89%E6%8B%A9%E9%9D%9E%E5%8A%A0%E5%AF%86%E7%9A%84%E9%93%BE%E6%8E%A5%E6%96%B9%E5%BC%8F.jpg" alt="第6步：选择非加密的链接方式"></p>
<p>第6步:向其他信箱发送邮件<br><img src="/post/cea46563/%E7%AC%AC7%E6%AD%A5%EF%BC%9A%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%8A%E9%82%AE%E4%BB%B6%EF%BC%8C%E9%80%89%E6%8B%A9%E2%80%9C%E6%96%B0%E9%82%AE%E4%BB%B6%E2%80%9D%E3%80%82.png" alt="第7步：在页面上邮件, 选择“新邮件”"><br><img src="/post/cea46563/%E7%AC%AC8%E6%AD%A5%EF%BC%9A%E5%A1%AB%E5%86%99%E6%94%B6%E4%BB%B6%E4%BA%BA%E4%B8%8E%E9%82%AE%E4%BB%B6%E5%86%85%E5%AE%B9%E5%90%8E%E5%8F%91%E9%80%81%E3%80%82.png" alt="第8步：填写收件人与邮件内容后发送"></p>
<p>当使用Outlook软件成功发送邮件后, 便可以在电子邮件服务器上使用mail命令查看到新邮件提醒了. 如果想查看邮件的完整内容, 只需输入收件人姓名前面的编号即可.</p>
<pre>
 mail
 <figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&amp;&gt; 编号</span></span><br><span class="line">&gt; quit</span><br></pre></td></tr></table></figure>
</pre>

<h2 id="设置用户别名邮箱"><a href="#设置用户别名邮箱" class="headerlink" title="设置用户别名邮箱"></a>设置用户别名邮箱</h2><p>用户别名功能是一项简单实用的邮件账户伪装技术, 可以用来设置多个虚拟信箱的账户以接受发送的邮件, 从而保证自身的邮件地址不被泄露, 还可以用来接收自己的多个信箱中的邮件.<br><img src="/post/cea46563/%E5%90%91%E7%94%A8%E6%88%B7bin%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6.png" alt="向用户bin发送邮件"></p>
<p>在aliases邮件别名服务的配置文件中可以看到, 里面定义了大量的用户别名, 这些用户别名大多数是Linux系统本地的系统账户, 而在冒号(:)间隔符后面的root账户则是用来接收这些账户邮件的人. 用户别名可以是Linux系统内的本地用户, 也可以是完全虚构的用户名字.<br><code>cat /etc/aliases</code></p>
<p>自行定义一些别名来接收邮件. 例如, 创建一个名为xxoo的账户, 而真正接收该账户邮件的应该是root账户.</p>
<pre>
 vim /etc/aliases
 <figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">xxoo:</span> root</span><br></pre></td></tr></table></figure>
</pre>
<p><img src="/post/cea46563/%E5%90%91%E7%94%A8%E6%88%B7xxoo%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6.png" alt="向用户xxoo发送邮件"></p>
<p>使用root账户在服务器上执行mail命令后, 就能看到这封原本要发送给xxoo账户的邮件.<br><code>mail</code></p>
<h1 id="使用PXE-Kickstart无人值守安装服务"><a href="#使用PXE-Kickstart无人值守安装服务" class="headerlink" title="使用PXE+Kickstart无人值守安装服务"></a>使用PXE+Kickstart无人值守安装服务</h1><h2 id="无人值守系统"><a href="#无人值守系统" class="headerlink" title="无人值守系统"></a>无人值守系统</h2><p>使用PXE + TFTP + FTP + DHCP + Kickstart服务搭建出一个无人值守安装系统. 这种无人值守安装系统可以自动地为数十台服务器安装系统.<br><br><img src="/post/cea46563/%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B-1.png" alt="无人值守安装流程-1"></p>
<p>PXE(Preboot eXecute Environment, 预启动执行环境)是由Intel公司开发的技术, 可以让计算机通过网络来启动操作系统(前提是计算机上安装的网卡支持PXE技术), 主要用于在无人值守安装系统中引导客户端主机安装Linux操作系统.</p>
<p>Kickstart是一种无人值守的安装方式, 其工作原理是预先把原本需要运维人员手工填写的参数保存成一个ks.cfg文件, 当安装过程中需要填写参数时则自动匹配Kickstart生成的文件. 所以只要Kickstart文件包含了安装过程中需要人工填写的所有参数, 那么从理论上来讲完全不需要运维人员的干预, 就可以自动完成安装工作.</p>
<p>由于当前的客户端主机并没有完整的操作系统, 也就不能完成FTP协议的验证了, 所以需要使用TFTP协议帮助客户端获取引导及驱动文件. vsftpd服务程序用于将完整的系统安装镜像通过网络传输给客户端. 当然, 只要能将系统安装镜像成功传输给客户端即可, 因此也可以使用httpd来替代vsftpd服务程序.</p>
<h2 id="部署相关服务程序"><a href="#部署相关服务程序" class="headerlink" title="部署相关服务程序"></a>部署相关服务程序</h2><h3 id="配置DHCP服务程序"><a href="#配置DHCP服务程序" class="headerlink" title="配置DHCP服务程序"></a>配置DHCP服务程序</h3><p>DHCP服务程序用于为客户端主机分配可用的IP地址, 而且这是服务器与客户端主机进行文件传输的基础. 在虚拟机的虚拟网络编辑器中关闭自身的DHCP服务.</p>
<table>
无人值守系统与客户端的设置
<tr><td>主机名称</td><td>操作系统</td><td>IP地址</td></tr>
<tr><td>无人值守系统</td><td>RHEL 7</td><td>192.168.10.10</td></tr>
<tr><td>客户端</td><td>未安装操作系统</td><td></td></tr>
</table>

<p>挂载好光盘镜像并把Yum仓库文件配置妥当后, 开始安装DHCP服务程序软件包.<br><code>yum install dhcp</code></p>
<p>允许BOOTP引导程序协议, 旨在让局域网内暂时没有操作系统的主机也能获取静态IP地址; 在配置文件的最下面加载了引导驱动文件pxelinux.0(这个文件会在下面的步骤中创建), 其目的是让客户端主机获取到IP地址后主动获取引导驱动文件, 自行进入下一步的安装过程.</p>
<pre>
 vim /etc/dhcp/dhcpd.conf

 <figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">allow booting;</span><br><span class="line">allow bootp;</span><br><span class="line">ddns-update-style interim;</span><br><span class="line">ignore client-updates;</span><br><span class="line">subnet <span class="number">192.168</span><span class="number">.10</span><span class="number">.0</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> &#123;</span><br><span class="line">       option subnet-mask      <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>;</span><br><span class="line">       option domain-name-servers  <span class="number">192.168</span><span class="number">.10</span><span class="number">.10</span>;</span><br><span class="line">       range dynamic-bootp <span class="number">192.168</span><span class="number">.10</span><span class="number">.100</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.200</span>;</span><br><span class="line">       <span class="section">default</span>-lease-time      <span class="number">21600</span>;</span><br><span class="line">       max-lease-time          <span class="number">43200</span>;</span><br><span class="line">       next-server             <span class="number">192.168</span><span class="number">.10</span><span class="number">.10</span>;</span><br><span class="line">       filename                <span class="string">"pxelinux.0"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</pre>

<p>重新启动该服务程序, 并将其添加到开机启动项中.</p>
<pre>
 systemctl restart dhcpd
 systemctl enable dhcpd
</pre>

<h3 id="配置TFTP服务程序"><a href="#配置TFTP服务程序" class="headerlink" title="配置TFTP服务程序"></a>配置TFTP服务程序</h3><p>TFTP作为一种基于UDP协议的简单文件传输协议, 不需要进行用户认证即可获取到所需的文件资源. 因此接下来配置TFTP服务程序, 为客户端主机提供引导及驱动文件. 当客户端主机有了基本的驱动程序之后, 再通过vsftpd服务程序将完整的光盘镜像文件传输过去.<br><code>yum install tftp-server</code></p>
<p>TFTP是一种非常精简的文件传输服务程序, 它的运行和关闭是由xinetd网络守护进程服务来管理的.</p>
<p>xinetd服务程序会同时监听系统的多个端口, 然后根据用户请求的端口号调取相应的服务程序来响应用户的请求. </p>
<p>需要开启TFTP服务程序, 只需在xinetd服务程序的配置文件中把disable参数改成no就可以了. 保存配置文件并退出, 然后重启xinetd服务程序, 并将其加入到开机启动项中.</p>
<pre>
 vim /etc/xinetd.d/tftp
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">disable</span>                 = <span class="literal">no</span></span><br></pre></td></tr></table></figure>
 yum -y install xinetd
 systemctl restart xinetd
 systemctl enable xinetd
</pre>

<p>TFTP服务程序默认使用的是UDP协议, 占用的端口号为69, 所以在生产环境中还需要在firewalld防火墙管理工具中写入使其永久生效的允许策略, 以便让客户端主机顺利获取到引导文件.</p>
<pre>
 firewall-cmd --permanent --add-port=69/udp
 firewall-cmd --reload
</pre>

<h3 id="配置SYSLinux服务程序"><a href="#配置SYSLinux服务程序" class="headerlink" title="配置SYSLinux服务程序"></a>配置SYSLinux服务程序</h3><p>SYSLinux是一个用于提供引导加载的服务程序. 与其说SYSLinux是一个服务程序, 不如说更需要里面的引导文件, 在安装好SYSLinux服务程序软件包后, /usr/share/syslinux目录中会出现很多引导文件.<br><code>yum install syslinux</code></p>
<p>首先需要把SYSLinux提供的引导文件复制到TFTP服务程序的默认目录中, 也就是前文提到的文件pxelinux.0, 这样客户端主机就能够顺利地获取到引导文件了.</p>
<p>另外在RHEL 7系统光盘镜像中也有一些需要调取的引导文件. 确认光盘镜像已经被挂载到/media/cdrom目录后, 使用复制命令将光盘镜像中自带的一些引导文件也复制到TFTP服务程序的默认目录中.</p>
<pre>
 cd /var/lib/tftpboot
 cp /usr/share/syslinux/pxelinux.0 .
 cp /media/cdrom/images/pxeboot/{vmlinuz,initrd.img} .
 cp /media/cdrom/isolinux/{vesamenu.c32,boot.msg} .
</pre>

<p>然后在TFTP服务程序的目录中新建pxelinux.cfg目录, 将系统光盘中的开机选项菜单复制到该目录中, 并命名为default.</p>
<pre>
 mkdir pxelinux.cfg
 cp /media/cdrom/isolinux/isolinux.cfg pxelinux.cfg/default
</pre>
<p>这个default文件就是开机时的选项菜单.<br><img src="/post/cea46563/%E7%AC%AC1%E6%AD%A5%EF%BC%9A%E5%BC%80%E6%9C%BA%E5%90%8E%E5%9C%A8%E5%86%85%E6%A0%B8%E4%B8%8A%E6%95%B2%E5%87%BB%E2%80%9Ce%E2%80%9D.png" alt="开机界面"></p>
<p>编辑这个default文件, 把第1行的default参数修改为linux, 这样系统在开机时就会默认执行那个名称为linux的选项了. 对应的linux选项大约在64行, 我们将默认的光盘镜像安装方式修改成FTP文件传输方式, 并指定好光盘镜像的获取网址以及Kickstart应答文件的获取路径:</p>
<pre>
 vim pxelinux.cfg/default
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">default linux</span><br><span class="line">prompt 1</span><br><span class="line">append <span class="attribute">initrd</span>=initrd.img inst.<span class="attribute">stage2</span>=ftp://ip地址 <span class="attribute">ks</span>=ftp://ip地址/pub/ks.cfg quiet # 64行</span><br></pre></td></tr></table></figure>
</pre>
<h3 id="配置VSFtpd服务程序"><a href="#配置VSFtpd服务程序" class="headerlink" title="配置VSFtpd服务程序"></a>配置VSFtpd服务程序</h3><p>在无人值守安装系统的服务中, 光盘镜像是通过FTP协议传输的, 因此势必要用到vsftpd服务程序. 当然, 也可以使用httpd服务程序来提供Web网站访问的方式, 只要能确保将光盘镜像顺利传输给客户端主机即可.<br><code>yum install vsftpd</code></p>
<p>在配置文件修改正确之后, 一定将相应的服务程序添加到开机启动项中.</p>
<pre>
 systemctl restart vsftpd
 systemctl enable vsftpd
</pre>

<p>在确认系统光盘镜像已经正常挂载到/media/cdrom目录后, 把目录中的光盘镜像文件全部复制到vsftpd服务程序的工作目录中.<br><code>cp -r /media/cdrom/* /var/ftp</code></p>
<p>在firewalld防火墙管理工具中写入使FTP协议永久生效的允许策略, 然后在SELinux中放行FTP传输:</p>
<pre>
 firewall-cmd --permanent --add-service=ftp
 firewall-cmd --reload 
 setsebool -P ftpd_connect_all_unreserved=on
</pre>

<h3 id="创建KickStart应答文件"><a href="#创建KickStart应答文件" class="headerlink" title="创建KickStart应答文件"></a>创建KickStart应答文件</h3><p>Kickstart应答文件中包含了系统安装过程中需要使用的选项和参数信息, 系统可以自动调取这个应答文件的内容, 从而彻底实现了无人值守安装系统.<br>在root管理员的家目录中有一个名为anaconda-ks.cfg的文件, 它就是应答文件. 下面将这个文件复制到vsftpd服务程序的工作目录中. 使用chmod命令设置该文件的权限, 确保所有人都有可读的权限, 以保证客户端主机可以顺利获取到应答文件及里面的内容:</p>
<pre>
 cp ~/anaconda-ks.cfg /var/ftp/pub/ks.cfg
 chmod +r /var/ftp/pub/ks.cfg
</pre>

<p>首先把第6行的光盘镜像安装方式修改成FTP协议, 仔细填写好FTP服务器的IP地址, 并用本地浏览器尝试打开下检查有没有报错. 然后把第21行的时区修改成上海(Asia/Shanghai), 最后再把29行的磁盘选项设置为清空所有磁盘内容并初始化磁盘:</p>
<pre>
 vim /var/ftp/pub/ks.cfg
 <figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url <span class="params">--url=ftp</span>:<span class="string">//ip</span>地址 <span class="comment"># 6行</span></span><br><span class="line">timezone Asia/Shanghai <span class="params">--isUtc</span> <span class="comment"># 21行</span></span><br><span class="line">clearpart <span class="params">--all</span> <span class="params">--initlabel</span> <span class="comment"># 29行</span></span><br></pre></td></tr></table></figure>
</pre>

<p>如果觉得系统默认自带的应答文件参数较少, 不能满足生产环境的需求, 则可以通过Yum软件仓库来安装system-config-kickstart软件包. 这是一款图形化的Kickstart应答文件生成工具, 可以根据自己的需求生成自定义的应答文件, 然后将生成的文件放到/var/ftp/pub目录中并将名字修改为ks.cfg即可.</p>
<pre>
 yum install system-config-kickstart
</pre>

<p>启动工具:<br><code>system-config-kickstart</code><br><img src="/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%B8%80.png" alt="Kickstart配置一"><br><img src="/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%BA%8C.png" alt="Kickstart配置二"><br><img src="/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%BA%8C.%E4%BA%94.png" alt="Kickstart配置二.五"><br><img src="/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%BA%8C.%E5%85%AD.png" alt="Kickstart配置二.六"><br><img src="/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%B8%89.png" alt="Kickstart配置三"><br><img src="/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E5%9B%9B.png" alt="Kickstart配置四"><br>注: 如果出现<code>由于下载软件包信息失败, 软件包选择被禁止</code>信息.<br>则: 修改yum源标志, 设置为development即可:</p>
<pre>
 vim /etc/yum.repos.d/---.repo
 [development]
</pre>
<p><img src="/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E4%BA%94.png" alt="Kickstart配置五"><br><img src="/post/cea46563/Kickstart%E9%85%8D%E7%BD%AE%E5%85%AD.png" alt="Kickstart配置六"></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rm</span> <span class="string">-r /etc/yum.repos.d/*</span></span><br><span class="line"><span class="attr">echo</span> <span class="string">'[base]</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">centos7</span></span><br><span class="line"><span class="attr">baseurl</span>=<span class="string">ftp://192.168.10.10</span></span><br><span class="line"><span class="attr">enabled</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">gpgkey</span>=<span class="string">file:///etc/pki/rpm-gpg/PRM-GPG-KEY-redhat-release' &gt; /etc/yum.repos.d/centos7.repo</span></span><br></pre></td></tr></table></figure>

<p>最后文件选项保存文件, 将文件放到/var/ftp/pub目录中.</p>
<pre>
 mv /ks.cfg /var/ftp/pub/
 chmod +r /var/ftp/pub/ks.cfg
 vim /var/ftp/pub/ks.cfg
 <figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url <span class="params">--url=ftp</span>:<span class="string">//ip</span>地址 <span class="comment"># 6行</span></span><br></pre></td></tr></table></figure>
</pre>

<h2 id="自动部署客户机"><a href="#自动部署客户机" class="headerlink" title="自动部署客户机"></a>自动部署客户机</h2><p>新建虚拟机并更改网络适配器的模式为仅主机模式<br><img src="/post/cea46563/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%89%E8%A3%85%E5%8A%A0%E8%BD%BD%E4%B8%AD.png" alt="自动化安装加载中"><br><img src="/post/cea46563/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%89%E8%A3%85%E5%8A%A0%E8%BD%BD%E4%B8%AD2.png" alt="自动化安装加载中2"></p>
<h1 id="使用LNMP架构部署动态网站环境"><a href="#使用LNMP架构部署动态网站环境" class="headerlink" title="使用LNMP架构部署动态网站环境"></a>使用LNMP架构部署动态网站环境</h1><h2 id="源码包程序"><a href="#源码包程序" class="headerlink" title="源码包程序"></a>源码包程序</h2><p>使用源码包来安装服务程序具有两个优势:<br>1.源码包的可移植性非常好, 几乎可以在任何Linux系统中安装使用, 而RPM软件包是针对特定系统和架构编写的指令集, 必须严格地符合执行环境才能顺利安装(即只会去”生硬地”安装服务程序).</p>
<p>2.使用源码包安装服务程序时会有一个编译过程, 因此可以更好地适应安装主机的系统环境, 运行效率和优化程度都会强于使用RPM软件包安装的服务程序.</p>
<p>源码包安装步骤:<br>第1步:下载及解压源码包文件</p>
<pre>
 tar xzvf 源码包文件名.tar.gz
 cd 源码包文件目录名
</pre>

<p>第2步:编译源码包代码<br><code>./configure --prefix=/usr/local/program</code></p>
<p>第3步:生成二进制安装程序并运行二进制的服务程序安装包<br><code>make && make install</code></p>
<p>第4步:清理源码包临时文件<br><code>make clean</code></p>
<h2 id="LNMP动态网站架构"><a href="#LNMP动态网站架构" class="headerlink" title="LNMP动态网站架构"></a>LNMP动态网站架构</h2><p>LNMP动态网站部署架构是一套由Linux + Nginx + MySQL + PHP组成的动态网站系统解决方案, 具有免费、高效、扩展性强且资源消耗低等优良特性.</p>
<p>在使用源码包安装服务程序之前，首先要让安装主机具备编译程序源码的环境, 他需要具备C语言、C++语言、Perl语言的编译器, 以及各种常见的编译支持函数库程序.</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y apr* autoconf automake bison bzip2 bzip2* compat* cpp curl curl-devel fontconfig fontconfig-devel freetype freetype* freetype-devel gcc gcc-c++ gd gettext gettext-devel glibc kernel kernel-headers keyutils keyutils-libs-devel krb5-devel libcom_err-devel libpng libpng-devel libjpeg* libsepol-devel libselinux-devel libstdc++-devel libtool* libgomp libxml2 libxml2-devel libXpm* libtiff libtiff* make mpfr ncurses*<span class="built_in"> ntp </span>openssl openssl-devel patch pcre-devel perl php-common php-gd policycoreutils telnet t1lib t1lib* nasm nasm* wget zlib-devel</span><br></pre></td></tr></table></figure>

<p>安装LNMP动态网站部署架构所需的16个软件源码包和1个用于检查效果的论坛网站系统软件包, 使用wget命令下载这些源码包文件. 根据FHS协议, 建议把要安装的软件包存放在/usr/local/src目录中:</p>
<pre>
 cd /usr/local/src
 <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>cmake-<span class="number">2.8</span>.<span class="number">11.2</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>Discuz_X3.<span class="number">2</span>_SC_GBK.zip</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>freetype-<span class="number">2.5</span>.<span class="number">3</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>jpegsrc.v9a.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>libgd-<span class="number">2.1</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>libmcrypt-<span class="number">2.5</span>.<span class="number">8</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>libpng-<span class="number">1.6</span>.<span class="number">12</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>libvpx-v1.<span class="number">3.0</span>.tar.bz2</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/my</span>sql-<span class="number">5.6</span>.<span class="number">19</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>nginx-<span class="number">1.6</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>openssl-<span class="number">1.0</span>.<span class="number">1</span>h.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>php-<span class="number">5.5</span>.<span class="number">14</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>pcre-<span class="number">8.35</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>tiff-<span class="number">4.0</span>.<span class="number">3</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/y</span>asm-<span class="number">1.2</span>.<span class="number">0</span>.tar.gz</span><br><span class="line">wget https:<span class="regexp">//</span>www.linuxprobe.com<span class="regexp">/Software/</span>zlib-<span class="number">1.2</span>.<span class="number">8</span>.tar.gz</span><br></pre></td></tr></table></figure>
 ls
</pre>

<p>CMake是Linux系统中一款常用的编译工具</p>
<pre>
 tar xzvf cmake-2.8.11.2.tar.gz
 cd cmake-2.8.11.2/
 ./configure
 make && make install
</pre>
<h3 id="配置Mysql服务"><a href="#配置Mysql服务" class="headerlink" title="配置Mysql服务"></a>配置Mysql服务</h3><p>在系统中创建一个名为mysql的用户, 专门用于负责运行MySQL数据库. 把这类账户的Bash终端设置成nologin解释器, 避免黑客通过该用户登录到服务器中, 从而提高系统安全性.</p>
<pre>
 cd ..
 useradd mysql -s /sbin/nologin
</pre>

<p>创建一个用于保存MySQL数据库程序和数据库文件的目录, 并把该目录的所有者和所属组身份修改为mysql.<br>/usr/local/mysql是用于保存MySQL数据库服务程序的目录, /usr/local/mysql/var则是用于保存真实数据库文件的目录.</p>
<pre>
 mkdir -p /usr/local/mysql/var
 chown -Rf mysql:mysql /usr/local/mysql
</pre>

<p>解压、编译、安装MySQL数据库服务程序, 在编译数据库时使用的是cmake命令<br>-DCMAKE_INSTALL_PREFIX参数用于定义数据库服务程序的保存目录<br>-DMYSQL_DATADIR参数用于定义真实数据库文件的目录<br>-DSYSCONFDIR则是定义MySQL数据库配置文件的保存目录</p>
<pre>
 tar xzvf mysql-5.6.19.tar.gz
 cd mysql-5.6.19/
 cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/usr/local/mysql/var -DSYSCONFDIR=/etc
 make && make install
</pre>

<p>为了让MySQL数据库程序正常运转起来, 需要先删除/etc目录中的默认配置文件, 然后在MySQL数据库程序的保存目录scripts内找到一个名为mysql_install_db的脚本程序, 执行这个脚本程序并使用:<br>–user参数指定MySQL服务的对应账号名称(在前面步骤已经创建),<br>使用–basedir参数指定MySQL服务程序的保存目录,<br>使用–datadir参数指定MySQL真实数据库的文件保存目录,<br>这样即可生成系统数据库文件, 也会生成出新的MySQL服务配置文件.</p>
<pre>
 rm -rf /etc/my.cnf
 cd /usr/local/mysql
 ./scripts/mysql_install_db --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/var
</pre>

<p>把系统新生成的MySQL数据库配置文件链接到/etc目录中, 然后把程序目录中的开机程序文件复制到/etc/rc.d/init.d目录中, 以便通过service命令来管理MySQL数据库服务程序. 记得把数据库脚本文件的权限修改成755以便于让用户有执行该脚本的权限:</p>
<pre>
 ln -s my.cnf /etc/my.cnf 
 cp ./support-files/mysql.server /etc/rc.d/init.d/mysqld
 chmod 755 /etc/rc.d/init.d/mysqld
</pre>

<p>编辑刚复制的MySQL数据库脚本文件, 把第46、47行的basedir与datadir参数分别修改为MySQL数据库程序的保存目录和真实数据库的文件内容.</p>
<pre>
 vim /etc/rc.d/init.d/mysqld
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">basedir</span>=/usr/local/mysql</span><br><span class="line"><span class="attr">datadir</span>=/usr/local/mysql/var</span><br></pre></td></tr></table></figure>
</pre>

<p>配置好脚本文件后便可以用service命令启动mysqld数据库服务了. mysqld是MySQL数据库程序的服务名称, 顺带再使用chkconfig命令把mysqld服务程序加入到开机启动项中.</p>
<pre>
 service mysqld start
 chkconfig mysqld on
</pre>

<p>把命令所保存的目录永久性地定义到PATH变量中, 需要编辑/etc/profile文件并写入追加的命令目录, 这样当物理设备在下一次重启时就会永久生效了. 也可以使用source命令加载一下/ect/profile文件.</p>
<pre>
 vim /etc/profile
 <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=<span class="variable">$PATH</span><span class="symbol">:/usr/local/mysql/bin</span> <span class="comment"># 74行</span></span><br></pre></td></tr></table></figure>
 source /etc/profile
</pre>

<p>MySQL数据库服务程序还会调用到一些程序文件和函数库文件. 由于当前是通过源码包方式安装MySQL数据库, 因此现在也必须以手动方式把这些文件链接过来.</p>
<pre>
 mkdir /var/lib/mysql
 ln -s /usr/local/mysql/lib/mysql /usr/lib/mysql
 ln -s /tmp/mysql.sock /var/lib/mysql/mysql.sock
 ln -s /usr/local/mysql/include/mysql /usr/include/mysql
</pre>

<p>对MySQL数据库进行初始化</p>
<pre>
 mysql_secure_installation
 Enter current password for root (enter for none): <font color="red">此处只需按下回车键</font>
 OK, successfully used password, moving on...

 Set root password? [Y/n] y （<font color="red">要为root管理员设置数据库的密码</font>）
 New password: <font color="red">输入要为root管理员设置的数据库密码</font>
 Re-enter new password: <font color="red">再输入一次密码</font>
 Password updated successfully!

 Remove anonymous users? [Y/n] y （<font color="red">删除匿名账户</font>）
 ... Success!

 Disallow root login remotely? [Y/n] y （<font color="red">禁止root管理员从远程登录</font>）
 ... Success!

 Remove test database and access to it? [Y/n] y （<font color="red">删除test数据库并取消对其的访问权限</font>）
 - Dropping test database...

 Reload privilege tables now? [Y/n] y （<font color="red">刷新授权表，让初始化后的设定立即生效</font>）
 ... Success!
</pre>
<h3 id="配置Nginx服务"><a href="#配置Nginx服务" class="headerlink" title="配置Nginx服务"></a>配置Nginx服务</h3><p>Nginx是一款相当优秀的用于部署动态网站的轻量级服务程序, 它最初是为俄罗斯门户站点而开发的, 因其稳定性、功能丰富、占用内存少且并发能力强而备受用户的信赖. 目前国内诸如新浪、网易、腾讯等门户站点均已使用了此服务。</p>
<p>Nginx服务程序的稳定性源自于采用了分阶段的资源分配技术, 降低了CPU与内存的占用率, 所以使用Nginx程序部署的动态网站环境不仅十分稳定、高效，而且消耗的系统资源也很少. 此外, Nginx具备的模块数量与Apache具备的模块数量几乎相同, 而且现在已经完全支持proxy、rewrite、mod_fcgi、ssl、vhosts等常用模块. 更重要的是, Nginx还支持热部署技术, 可以7×24不间断提供服务, 还可以在不暂停服务的情况下直接对Nginx服务程序进行升级.</p>
<p>解压、编译、生成、安装Nginx服务程序的源码文件:<br>用于提供Perl语言兼容的正则表达式库的软件包pcre</p>
<pre>
 cd /usr/local/src
 tar xzvf pcre-8.35.tar.gz 
 cd pcre-8.35
 ./configure --prefix=/usr/local/pcre
 make && make install 
</pre>

<p>openssl软件包是用于提供网站加密证书服务的程序文件, 在安装该程序时需要自定义服务程序的安装目录, 以便于稍后调用它们的时候更可控.</p>
<pre>
 cd /usr/local/src
 tar xzvf openssl-1.0.1h.tar.gz
 cd openssl-1.0.1h
 ./config --prefix=/usr/local/openssl
 make && make install
</pre>

<p>openssl软件包安装后默认会在/usr/local/openssl/bin目录中提供很多的可用命令, 像前面的操作那样, 将这个目录添加到PATH环境变量中, 并写入到配置文件中, 最后执行source命令以便让新的PATH环境变量内容可以立即生效.</p>
<pre>
 vim /etc/profile
 <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=<span class="variable">$PATH</span><span class="symbol">:/usr/local/mysql/bin</span><span class="symbol">:/usr/local/openssl/bin</span> <span class="comment"># 74行</span></span><br></pre></td></tr></table></figure>
 source /etc/profile
</pre>

<p>zlib软件包是用于提供压缩功能的函数库文件</p>
<pre>
 cd /usr/local/src
 tar xzvf zlib-1.2.8.tar.gz 
 cd zlib-1.2.8
 ./configure --prefix=/usr/local/zlib
 make && make install
</pre>

<p>在安装部署好具有依赖关系的软件包之后, 创建一个用于执行Nginx服务程序的账户. 账户名称可以自定义, 后续需要调用</p>
<pre>
 cd ..
 useradd www -s /sbin/nologin
</pre>

<p>在使用命令编译Nginx服务程序时, 需要设置特别多的参数, 其中,<br>–prefix参数用于定义服务程序稍后安装到的位置,<br>–user与–group参数用于指定执行Nginx服务程序的用户名和用户组.<br>在使用参数调用openssl、zlib、pcre软件包时, 请写出软件源码包的解压路径, 而不是程序的安装路径</p>
<pre>
 tar xzvf nginx-1.6.0.tar.gz
 cd nginx-1.6.0/
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure <span class="attribute">--prefix</span>=/usr/local/nginx --without-http_memcached_module <span class="attribute">--user</span>=www <span class="attribute">--group</span>=www --with-http_stub_status_module --with-http_ssl_module --with-http_gzip_static_module <span class="attribute">--with-openssl</span>=/usr/local/src/openssl-1.0.1h <span class="attribute">--with-zlib</span>=/usr/local/src/zlib-1.2.8 <span class="attribute">--with-pcre</span>=/usr/local/src/pcre-8.35</span><br></pre></td></tr></table></figure>
 make && make install
</pre>

<p>要想启动Nginx服务程序以及将其加入到开机启动项中, 也需要有脚本文件, 在/etc/rc.d/init.d目录中创建脚本文件并直接复制下面的脚本内容即可.</p>
<pre>
 vim /etc/rc.d/init.d/nginx
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># nginx - this script starts and stops the nginx daemon</span></span><br><span class="line"><span class="comment"># chkconfig: - 85 15</span></span><br><span class="line"><span class="comment"># description: Nginx is an HTTP(S) server, HTTP(S) reverse \</span></span><br><span class="line"><span class="comment"># proxy and IMAP/POP3 proxy server</span></span><br><span class="line"><span class="comment"># processname: nginx</span></span><br><span class="line"><span class="comment"># config: /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="comment"># config: /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="comment"># pidfile: /usr/local/nginx/logs/nginx.pid</span></span><br><span class="line"><span class="comment"># Source function library.</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"><span class="comment"># Source networking configuration.</span></span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"><span class="comment"># Check that networking is up.</span></span><br><span class="line">[ <span class="string">"<span class="variable">$NETWORKING</span>"</span> = <span class="string">"no"</span> ] &amp;&amp; <span class="built_in">exit</span> 0</span><br><span class="line">nginx=<span class="string">"/usr/local/nginx/sbin/nginx"</span></span><br><span class="line">prog=$(basename <span class="variable">$nginx</span>)</span><br><span class="line">NGINX_CONF_FILE=<span class="string">"/usr/local/nginx/conf/nginx.conf"</span></span><br><span class="line">[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx</span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line"><span class="function"><span class="title">make_dirs</span></span>() &#123;</span><br><span class="line"><span class="comment"># make required directories</span></span><br><span class="line">user=`<span class="variable">$nginx</span> -V 2&gt;&amp;1 | grep <span class="string">"configure arguments:"</span> | sed <span class="string">'s/[^*]*--user=\([^ ]*\).*/\1/g'</span> -`</span><br><span class="line">        <span class="keyword">if</span> [ -z <span class="string">"`grep <span class="variable">$user</span> /etc/passwd`"</span> ]; <span class="keyword">then</span></span><br><span class="line">                useradd -M -s /bin/nologin <span class="variable">$user</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">options=`<span class="variable">$nginx</span> -V 2&gt;&amp;1 | grep <span class="string">'configure arguments:'</span>`</span><br><span class="line"><span class="keyword">for</span> opt <span class="keyword">in</span> <span class="variable">$options</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ `<span class="built_in">echo</span> <span class="variable">$opt</span> | grep <span class="string">'.*-temp-path'</span>` ]; <span class="keyword">then</span></span><br><span class="line">                value=`<span class="built_in">echo</span> <span class="variable">$opt</span> | cut -d <span class="string">"="</span> -f 2`</span><br><span class="line">                <span class="keyword">if</span> [ ! -d <span class="string">"<span class="variable">$value</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                        <span class="comment"># echo "creating" $value</span></span><br><span class="line">                        mkdir -p <span class="variable">$value</span> &amp;&amp; chown -R <span class="variable">$user</span> <span class="variable">$value</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">[ -x <span class="variable">$nginx</span> ] || <span class="built_in">exit</span> 5</span><br><span class="line">[ -f <span class="variable">$NGINX_CONF_FILE</span> ] || <span class="built_in">exit</span> 6</span><br><span class="line">make_dirs</span><br><span class="line"><span class="built_in">echo</span> -n $<span class="string">"Starting <span class="variable">$prog</span>: "</span></span><br><span class="line">daemon <span class="variable">$nginx</span> -c <span class="variable">$NGINX_CONF_FILE</span></span><br><span class="line">retval=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">[ <span class="variable">$retval</span> -eq 0 ] &amp;&amp; touch <span class="variable">$lockfile</span></span><br><span class="line"><span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line"><span class="built_in">echo</span> -n $<span class="string">"Stopping <span class="variable">$prog</span>: "</span></span><br><span class="line">killproc <span class="variable">$prog</span> -QUIT</span><br><span class="line">retval=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">[ <span class="variable">$retval</span> -eq 0 ] &amp;&amp; rm -f <span class="variable">$lockfile</span></span><br><span class="line"><span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">restart</span></span>() &#123;</span><br><span class="line"><span class="comment">#configtest || return $?</span></span><br><span class="line">stop</span><br><span class="line">sleep 1</span><br><span class="line">start</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">reload</span></span>() &#123;</span><br><span class="line"><span class="comment">#configtest || return $?</span></span><br><span class="line"><span class="built_in">echo</span> -n $<span class="string">"Reloading <span class="variable">$prog</span>: "</span></span><br><span class="line">killproc <span class="variable">$nginx</span> -HUP</span><br><span class="line">RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">force_reload</span></span>() &#123;</span><br><span class="line">restart</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">configtest</span></span>() &#123;</span><br><span class="line"><span class="variable">$nginx</span> -t -c <span class="variable">$NGINX_CONF_FILE</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">rh_status</span></span>() &#123;</span><br><span class="line">status <span class="variable">$prog</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">rh_status_q</span></span>() &#123;</span><br><span class="line">rh_status &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">        rh_status_q &amp;&amp; <span class="built_in">exit</span> 0</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">stop)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> 0</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">restart|configtest)</span><br><span class="line"><span class="variable">$1</span></span><br><span class="line">;;</span><br><span class="line">reload)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> 7</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">condrestart|try-restart)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> 0</span><br><span class="line">        ;;</span><br><span class="line">*)</span><br><span class="line"><span class="built_in">echo</span> $<span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;"</span></span><br><span class="line"><span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
</pre>

<p>保存脚本文件后记得为其赋予755权限, 以便能够执行这个脚本. 然后以绝对路径的方式执行这个脚本, 通过restart参数重启Nginx服务程序, 最后再使用chkconfig命令将Nginx服务程序添加至开机启动项中.</p>
<pre>
 chmod 755 /etc/rc.d/init.d/nginx
 /etc/rc.d/init.d/nginx restart
 chkconfig nginx on
</pre>

<p>Nginx服务程序验证:在浏览器中输入本机的ip地址</p>
<h3 id="配置php服务"><a href="#配置php服务" class="headerlink" title="配置php服务"></a>配置php服务</h3><p>PHP(Hypertxt Preprocessor, 超文本预处理器)是一种通用的开源脚本语言, 发明于1995年, 它吸取了C语言、Java语言及Perl语言的很多优点, 具有开源、免费、快捷、跨平台性强、效率高等优良特性, 是目前Web开发领域最常用的语言之一.</p>
<p>yasm源码包是一款常见的开源汇编器</p>
<pre>
 cd ..
 tar zxvf yasm-1.2.0.tar.gz
 cd yasm-1.2.0
 ./configure
 make && make install
</pre>

<p>libmcrypt源码包是用于加密算法的扩展库程序</p>
<pre>
 cd ..
 tar zxvf libmcrypt-2.5.8.tar.gz
 cd libmcrypt-2.5.8
 ./configure
 make && make install
</pre>

<p>libvpx源码包是用于提供视频编码器的服务程序</p>
<pre>
 cd ..
 tar xjvf libvpx-v1.3.0.tar.bz2
 cd libvpx-v1.3.0
 ./configure --prefix=/usr/local/libvpx --enable-shared --enable-vp9
 make && make install
</pre>

<p>tiff源码包是用于提供标签图像文件格式的服务程序</p>
<pre>
 cd ..
 tar zxvf tiff-4.0.3.tar.gz
 cd tiff-4.0.3
 ./configure --prefix=/usr/local/tiff --enable-shared
 make && make install
</pre>

<p>libpng源码包是用于提供png图片格式支持函数库的服务程序</p>
<pre>
 cd ..
 tar zxvf libpng-1.6.12.tar.gz
 cd libpng-1.6.12
 ./configure --prefix=/usr/local/libpng --enable-shared
 make && make install
</pre>

<p>freetype源码包是用于提供字体支持引擎的服务程序</p>
<pre>
 cd ..
 tar zxvf freetype-2.5.3.tar.gz
 cd freetype-2.5.3
 ./configure --prefix=/usr/local/freetype --enable-shared
 make && make install
</pre>

<p>jpeg源码包是用于提供jpeg图片格式支持函数库的服务程序</p>
<pre>
 cd ..
 tar zxvf jpegsrc.v9a.tar.gz
 cd jpeg-9a
 ./configure --prefix=/usr/local/jpeg --enable-shared
 make && make install
</pre>

<p>libgd源码包是用于提供图形处理的服务程序,<br>在编译libgd源码包时, 请记得写入jpeg、libpng、freetype、tiff、libvpx等服务程序在系统中的安装路径.</p>
<pre>
 cd ..
 tar zxvf libgd-2.1.0.tar.gz
 cd libgd-2.1.0
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure <span class="attribute">--prefix</span>=/usr/local/libgd --enable-shared <span class="attribute">--with-jpeg</span>=/usr/local/jpeg <span class="attribute">--with-png</span>=/usr/local/libpng <span class="attribute">--with-freetype</span>=/usr/local/freetype <span class="attribute">--with-fontconfig</span>=/usr/local/freetype <span class="attribute">--with-xpm</span>=/usr/ <span class="attribute">--with-tiff</span>=/usr/local/tiff <span class="attribute">--with-vpx</span>=/usr/local/libvpx</span><br></pre></td></tr></table></figure>
 make && make install
</pre>

<p>先定义一个名为LD_LIBRARY_PATH的全局环境变量, 该环境变量的作用是帮助系统找到指定的动态链接库文件, 这些文件是编译php服务源码包的必须元素之一. 编译php服务源码包时, 除了定义要安装到的目录以外, 还需要依次定义配置php服务程序配置文件的保存目录、MySQL数据库服务程序所在目录、MySQL数据库服务程序配置文件所在目录，以及libpng、jpeg、freetype、libvpx、zlib等服务程序的安装目录路径, 并通过参数启动php服务程序的诸多默认功能.</p>
<pre>
 cd ..
 tar zvxf php-5.5.14.tar.gz
 cd php-5.5.14
 export LD_LIBRARY_PATH=/usr/local/libgd/lib
 <figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/php</span> <span class="params">--with-config-file-path=/usr/local/php/etc</span> <span class="params">--with-mysql=/usr/local/mysql</span> <span class="params">--with-mysqli=/usr/local/mysql/bin/mysql_config</span> <span class="params">--with-mysql-sock=/tmp/mysql</span>.sock <span class="params">--with-pdo-mysql=/usr/local/mysql</span> <span class="params">--with-gd</span> <span class="params">--with-png-dir=/usr/local/libpng</span> <span class="params">--with-jpeg-dir=/usr/local/jpeg</span> <span class="params">--with-freetype-dir=/usr/local/freetype</span> <span class="params">--with-xpm-dir=/usr/</span> <span class="params">--with-vpx-dir=/usr/local/libvpx/</span> <span class="params">--with-zlib-dir=/usr/local/zlib</span> <span class="params">--with-iconv</span> <span class="params">--enable-libxml</span> <span class="params">--enable-xml</span> <span class="params">--enable-bcmath</span> <span class="params">--enable-shmop</span> <span class="params">--enable-sysvsem</span> <span class="params">--enable-inline-optimization</span> <span class="params">--enable-opcache</span> <span class="params">--enable-mbregex</span> <span class="params">--enable-fpm</span> <span class="params">--enable-mbstring</span> <span class="params">--enable-ftp</span> <span class="params">--enable-gd-native-ttf</span> <span class="params">--with-openssl</span> <span class="params">--enable-pcntl</span> <span class="params">--enable-sockets</span> <span class="params">--with-xmlrpc</span> <span class="params">--enable-zip</span> <span class="params">--enable-soap</span> <span class="params">--without-pear</span> <span class="params">--with-gettext</span> <span class="params">--enable-session</span> <span class="params">--with-mcrypt</span> <span class="params">--with-curl</span> <span class="params">--enable-ctype</span></span><br></pre></td></tr></table></figure>
 make && make install
</pre>

<p>在php源码包程序安装完成后, 需要删除当前默认的配置文件, 然后将php服务程序目录中相应的配置文件复制过来.</p>
<pre>
 rm -rf /etc/php.ini
 ln -s /usr/local/php/etc/php.ini /etc/php.ini
 cp php.ini-production /usr/local/php/etc/php.ini
 cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf
 ln -s /usr/local/php/etc/php-fpm.conf /etc/php-fpm.conf
</pre>

<p>php-fpm.conf是php服务程序重要的配置文件之一, 我们需要启用该配置文件中第25行左右的pid文件保存目录, 然后分别将第148和149行的user与group参数分别修改为www账户和用户组名称.</p>
<pre>
 vim /usr/local/php/etc/php-fpm.conf
 <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pid = run/php-fpm.pid</span><br><span class="line">user = www</span><br><span class="line">group = www</span><br></pre></td></tr></table></figure>
</pre>

<p>配置妥当后便可把用于管理php服务的脚本文件复制到/etc/rc.d/init.d中了. 为了能够执行脚本, 请记得为脚本赋予755权限. 最后把php-fpm服务程序加入到开机启动项中.</p>
<pre>
 cp sapi/fpm/init.d.php-fpm /etc/rc.d/init.d/php-fpm
 chmod 755 /etc/rc.d/init.d/php-fpm
 chkconfig php-fpm on
</pre>

<p>编辑php.ini配置文件, 在305行的disable_functions参数后面追加上要禁止的功能.</p>
<pre>
 vim /usr/local/php/etc/php.ini
 <figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">disable_functions = passthru,<span class="keyword">exec</span>,<span class="keyword">system</span>,<span class="keyword">chroot</span>,scandir,chgrp,<span class="keyword">chown</span>,shell_exec,proc_open,proc_get_status,ini_alter,ini_alter,ini_restor e,dl,openlog,syslog,<span class="keyword">readlink</span>,<span class="keyword">symlink</span>,popepassthru,stream_socket_server,escapeshellcmd,dll,popen,disk_free_space,checkdnsrr,checkdnsrr,g etservbyname,<span class="keyword">getservbyport</span>,disk_total_space,posix_ctermid,posix_get_last_error,posix_getcwd,posix_getegid,posix_geteuid,posix_getgid,po six_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,posix_getppid,posix_getpwnam,posix<span class="number">_</span> <span class="keyword">getpwuid</span>,posix_getrlimit,posix_getsid,posix_getuid,posix_isatty,posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid,posix<span class="number">_</span> setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname</span><br></pre></td></tr></table></figure>
</pre>

<p>编辑Nginx服务程序的主配置文件,<br>把第2行的井号(#)删除, 然后在后面写上负责运行Nginx服务程序的账户名称和用户组名称;<br>在第45行的index参数后面写上网站的首页名称.<br>最后是将第65～71行参数前的井号(#)删除来启用参数, 主要是修改第69行的脚本名称路径参数.<br>其中$document_root变量即为网站信息存储的根目录路径, 若没有设置该变量, 则Nginx服务程序无法找到网站信息, 因此会提示”404页面未找到”的报错信息,<br>重启Nginx服务与php-fpm服务.</p>
<pre>
 vim /usr/local/nginx/conf/nginx.conf
 <figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user www www; <span class="meta"># 2行</span></span><br><span class="line"><span class="keyword">index</span> <span class="keyword">index</span>.html <span class="keyword">index</span>.htm <span class="keyword">index</span>.php; <span class="meta"># 45行</span></span><br><span class="line">$document_root$fastcgi_script_name; <span class="meta"># 69行</span></span><br></pre></td></tr></table></figure>
 systemctl restart nginx
 systemctl restart php-fpm
</pre>


<h2 id="搭建Discuz论坛"><a href="#搭建Discuz论坛" class="headerlink" title="搭建Discuz论坛"></a>搭建Discuz论坛</h2><p>Discuz! X3.2软件包的后缀是.zip格式, 因此应当使用专用的unzip命令来进行解压. 解压后会在当前目录中出现一个名为upload的文件目录, 这里面保存的就是Discuz!论坛的系统程序. 把Nginx服务程序网站根目录的内容清空后, 把这些这个目录中的文件都复制进去了. 记得把Nginx服务程序的网站根目录的所有者和所属组修改为本地的www用户, 并为其赋予755权限以便于能够读、写、执行该论坛系统内的文件.</p>
<pre>
 cd /usr/local/src/
 unzip Discuz_X3.2_SC_GBK.zip
 rm -rf /usr/local/nginx/html/{index.html,50x.html}*
 mv upload/* /usr/local/nginx/html/
 chown -Rf www:www /usr/local/nginx/html
 chmod -Rf 755 /usr/local/nginx/html
</pre>

<p>第1步:接受Discuz!安装向导的许可协议</p>
<p>第2步:检查Discuz! X3.2论坛系统的安装环境及目录权限<br><img src="/post/cea46563/Discuz%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC1.png" alt="Discuz安装向导图1"></p>
<p>第3步:选择”全新安装Discuz! X(含UCenter Server)<br><img src="/post/cea46563/Discuz%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC2.png" alt="Discuz安装向导图2"></p>
<p>第4步:填写服务器的数据库信息与论坛系统管理员信息<br><img src="/post/cea46563/Discuz%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC3.png" alt="Discuz安装向导图3"></p>
<p>第5步:等待Discuz! X3.2论坛系统安装完毕<br><img src="/post/cea46563/Discuz%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC4.png" alt="Discuz安装向导图4"><br><img src="/post/cea46563/Discuz%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC5.png" alt="Discuz安装向导图5"></p>
<table style="text-align:center;"><tr><td>转载(原文链接):</td><td><a href="https://www.linuxprobe.com/chapter-09.html" target="_blank" rel="noopener">https://www.linuxprobe.com/chapter-09.html</a></td></tr></table>>
    </div>

    
    
    

	<div>
	
		<div>
    
        <div style="text-align:center;color:white;font-size:14px;">-------------------本文结束 <i class="fa fa-heart"></i> 感谢阅读-------------------</div>
    
</div>
	
	</div>

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>云
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://www.mengyun.club/post/cea46563/" title="使用各种服务和部署">http://www.mengyun.club/post/cea46563/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
              <a href="/tags/Apache/" rel="tag"><i class="fa fa-tag"></i> Apache</a>
              <a href="/tags/NFS/" rel="tag"><i class="fa fa-tag"></i> NFS</a>
              <a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag"></i> MySQL</a>
              <a href="/tags/Nginx/" rel="tag"><i class="fa fa-tag"></i> Nginx</a>
              <a href="/tags/SSH/" rel="tag"><i class="fa fa-tag"></i> SSH</a>
              <a href="/tags/SELinux/" rel="tag"><i class="fa fa-tag"></i> SELinux</a>
              <a href="/tags/FTP/" rel="tag"><i class="fa fa-tag"></i> FTP</a>
              <a href="/tags/TFTP/" rel="tag"><i class="fa fa-tag"></i> TFTP</a>
              <a href="/tags/Samba/" rel="tag"><i class="fa fa-tag"></i> Samba</a>
              <a href="/tags/AutoFs/" rel="tag"><i class="fa fa-tag"></i> AutoFs</a>
              <a href="/tags/Bind/" rel="tag"><i class="fa fa-tag"></i> Bind</a>
              <a href="/tags/DHCP/" rel="tag"><i class="fa fa-tag"></i> DHCP</a>
              <a href="/tags/Postfix/" rel="tag"><i class="fa fa-tag"></i> Postfix</a>
              <a href="/tags/Dovecot/" rel="tag"><i class="fa fa-tag"></i> Dovecot</a>
              <a href="/tags/SYSLinux/" rel="tag"><i class="fa fa-tag"></i> SYSLinux</a>
              <a href="/tags/KickStart/" rel="tag"><i class="fa fa-tag"></i> KickStart</a>
              <a href="/tags/PXE/" rel="tag"><i class="fa fa-tag"></i> PXE</a>
              <a href="/tags/PHP/" rel="tag"><i class="fa fa-tag"></i> PHP</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/df41aea9/" rel="prev" title="Linux基础知识">
                  <i class="fa fa-chevron-left"></i> Linux基础知识
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/d8982727/" rel="next" title="linux系统重置root用户密码">
                  linux系统重置root用户密码 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">云</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">250k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">3:47</span>
  </span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/local-search.js"></script>












  








  

  

  
</body>
</html>
